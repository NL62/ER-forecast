2025-10-17 12:39:10,578 - __main__ - INFO - ======================================================================
2025-10-17 12:39:10,578 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 12:39:10,579 - __main__ - INFO - ======================================================================
2025-10-17 12:39:10,579 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 12:39:10,580 - __main__ - INFO - Output path: data/predictions/
2025-10-17 12:39:10,580 - __main__ - INFO - 
======================================================================
2025-10-17 12:39:10,580 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 12:39:10,580 - __main__ - INFO - ======================================================================
2025-10-17 12:39:10,581 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 12:39:12,427 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 12:39:12,429 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 12:39:12,528 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 12:39:12,543 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 12:39:12,547 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 12:39:12,586 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 12:39:12,588 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 12:39:12,589 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 12:39:12,589 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 12:39:12,589 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 12:39:12,592 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 12:39:12,608 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 12:39:12,626 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 12:39:12,629 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 12:39:12,632 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 12:39:12,632 - __main__ - INFO - 
======================================================================
2025-10-17 12:39:12,633 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 12:39:12,633 - __main__ - INFO - ======================================================================
2025-10-17 12:39:12,636 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 12:39:12,636 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 12:39:13,125 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 12:39:13,135 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 12:39:13,204 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 12:39:13,206 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 12:39:13,226 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 12:39:13,230 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 12:39:13,232 - __main__ - INFO - 
======================================================================
2025-10-17 12:39:13,234 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 12:39:13,234 - __main__ - INFO - ======================================================================
2025-10-17 12:39:13,234 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 12:39:13,242 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 12:39:13,279 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 12:44:24,073 - __main__ - INFO - ======================================================================
2025-10-17 12:44:24,073 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 12:44:24,073 - __main__ - INFO - ======================================================================
2025-10-17 12:44:24,074 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 12:44:24,074 - __main__ - INFO - Output path: data/predictions/
2025-10-17 12:44:24,074 - __main__ - INFO - 
======================================================================
2025-10-17 12:44:24,074 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 12:44:24,074 - __main__ - INFO - ======================================================================
2025-10-17 12:44:24,075 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 12:44:24,755 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 12:44:24,755 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 12:44:24,858 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 12:44:24,873 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 12:44:24,876 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 12:44:24,921 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 12:44:24,922 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 12:44:24,923 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 12:44:24,923 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 12:44:24,924 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 12:44:24,927 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 12:44:24,936 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 12:44:24,941 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 12:44:24,942 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 12:44:24,944 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 12:44:24,944 - __main__ - INFO - 
======================================================================
2025-10-17 12:44:24,946 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 12:44:24,946 - __main__ - INFO - ======================================================================
2025-10-17 12:44:24,948 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 12:44:24,950 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 12:44:25,243 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 12:44:25,245 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 12:44:25,248 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 12:44:25,248 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 12:44:25,251 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 12:44:25,253 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 12:44:25,253 - __main__ - INFO - 
======================================================================
2025-10-17 12:44:25,253 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 12:44:25,254 - __main__ - INFO - ======================================================================
2025-10-17 12:44:25,254 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 12:44:25,256 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 12:44:25,257 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 12:49:17,269 - __main__ - INFO - ======================================================================
2025-10-17 12:49:17,270 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 12:49:17,271 - __main__ - INFO - ======================================================================
2025-10-17 12:49:17,271 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 12:49:17,271 - __main__ - INFO - Output path: data/predictions/
2025-10-17 12:49:17,273 - __main__ - INFO - 
======================================================================
2025-10-17 12:49:17,273 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 12:49:17,274 - __main__ - INFO - ======================================================================
2025-10-17 12:49:17,275 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 12:49:17,838 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 12:49:17,838 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 12:49:17,895 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 12:49:17,908 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 12:49:17,911 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 12:49:17,961 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 12:49:17,963 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 12:49:17,966 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 12:49:17,967 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 12:49:17,968 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 12:49:17,970 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 12:49:17,973 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 12:49:17,975 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 12:49:17,976 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 12:49:17,977 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 12:49:17,977 - __main__ - INFO - 
======================================================================
2025-10-17 12:49:17,977 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 12:49:17,978 - __main__ - INFO - ======================================================================
2025-10-17 12:49:17,978 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 12:49:17,979 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 12:49:19,258 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 12:49:19,265 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 12:49:19,273 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 12:49:19,274 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 12:49:19,280 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 12:49:19,282 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 12:49:19,282 - __main__ - INFO - 
======================================================================
2025-10-17 12:49:19,282 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 12:49:19,283 - __main__ - INFO - ======================================================================
2025-10-17 12:49:19,284 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 12:49:19,285 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 12:49:19,289 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 12:51:39,101 - __main__ - INFO - ======================================================================
2025-10-17 12:51:39,102 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 12:51:39,102 - __main__ - INFO - ======================================================================
2025-10-17 12:51:39,102 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 12:51:39,103 - __main__ - INFO - Output path: data/predictions/
2025-10-17 12:51:39,103 - __main__ - INFO - 
======================================================================
2025-10-17 12:51:39,103 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 12:51:39,103 - __main__ - INFO - ======================================================================
2025-10-17 12:51:39,103 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 12:51:39,616 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 12:51:39,617 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 12:51:39,664 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 12:51:39,670 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 12:51:39,672 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 12:51:39,700 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 12:51:39,704 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 12:51:39,704 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 12:51:39,704 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 12:51:39,704 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 12:51:39,706 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 12:51:39,709 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 12:51:39,711 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 12:51:39,712 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 12:51:39,712 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 12:51:39,712 - __main__ - INFO - 
======================================================================
2025-10-17 12:51:39,713 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 12:51:39,713 - __main__ - INFO - ======================================================================
2025-10-17 12:51:39,713 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 12:51:39,713 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 12:51:40,134 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 12:51:40,139 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 12:51:40,154 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 12:51:40,154 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 12:51:40,162 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 12:51:40,163 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 12:51:40,164 - __main__ - INFO - 
======================================================================
2025-10-17 12:51:40,165 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 12:51:40,167 - __main__ - INFO - ======================================================================
2025-10-17 12:51:40,169 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 12:51:40,172 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 12:51:40,181 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 12:55:12,702 - __main__ - INFO - ======================================================================
2025-10-17 12:55:12,703 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 12:55:12,703 - __main__ - INFO - ======================================================================
2025-10-17 12:55:12,703 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 12:55:12,704 - __main__ - INFO - Output path: data/predictions/
2025-10-17 12:55:12,704 - __main__ - INFO - 
======================================================================
2025-10-17 12:55:12,704 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 12:55:12,704 - __main__ - INFO - ======================================================================
2025-10-17 12:55:12,704 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 12:55:14,267 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 12:55:14,271 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 12:55:14,358 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 12:55:14,375 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 12:55:14,379 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 12:55:14,439 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 12:55:14,440 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 12:55:14,441 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 12:55:14,441 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 12:55:14,442 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 12:55:14,447 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 12:55:14,464 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 12:55:14,473 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 12:55:14,476 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 12:55:14,477 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 12:55:14,477 - __main__ - INFO - 
======================================================================
2025-10-17 12:55:14,478 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 12:55:14,478 - __main__ - INFO - ======================================================================
2025-10-17 12:55:14,479 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 12:55:14,479 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 12:55:14,903 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 12:55:14,904 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 12:55:14,908 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 12:55:14,908 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 12:55:14,913 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 12:55:14,914 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 12:55:14,914 - __main__ - INFO - 
======================================================================
2025-10-17 12:55:14,915 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 12:55:14,915 - __main__ - INFO - ======================================================================
2025-10-17 12:55:14,915 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 12:55:14,915 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 12:55:14,916 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 12:55:19,512 - __main__ - INFO - ======================================================================
2025-10-17 12:55:19,512 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 12:55:19,512 - __main__ - INFO - ======================================================================
2025-10-17 12:55:19,513 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 12:55:19,513 - __main__ - INFO - Output path: data/predictions/
2025-10-17 12:55:19,513 - __main__ - INFO - 
======================================================================
2025-10-17 12:55:19,514 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 12:55:19,515 - __main__ - INFO - ======================================================================
2025-10-17 12:55:19,516 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 12:55:20,029 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 12:55:20,030 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 12:55:20,091 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 12:55:20,100 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 12:55:20,103 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 12:55:20,131 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 12:55:20,131 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 12:55:20,132 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 12:55:20,132 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 12:55:20,132 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 12:55:20,134 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 12:55:20,140 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 12:55:20,143 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 12:55:20,143 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 12:55:20,144 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 12:55:20,144 - __main__ - INFO - 
======================================================================
2025-10-17 12:55:20,144 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 12:55:20,144 - __main__ - INFO - ======================================================================
2025-10-17 12:55:20,145 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 12:55:20,146 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 12:55:21,707 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 12:55:21,708 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 12:55:21,712 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 12:55:21,714 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 12:55:21,716 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 12:55:21,718 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 12:55:21,718 - __main__ - INFO - 
======================================================================
2025-10-17 12:55:21,718 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 12:55:21,718 - __main__ - INFO - ======================================================================
2025-10-17 12:55:21,718 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 12:55:21,719 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 12:55:21,720 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 12:58:45,673 - __main__ - INFO - ======================================================================
2025-10-17 12:58:45,673 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 12:58:45,674 - __main__ - INFO - ======================================================================
2025-10-17 12:58:45,674 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 12:58:45,674 - __main__ - INFO - Output path: data/predictions/
2025-10-17 12:58:45,675 - __main__ - INFO - 
======================================================================
2025-10-17 12:58:45,675 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 12:58:45,675 - __main__ - INFO - ======================================================================
2025-10-17 12:58:45,676 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 12:58:46,552 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 12:58:46,553 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 12:58:46,628 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 12:58:46,639 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 12:58:46,642 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 12:58:46,680 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 12:58:46,683 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 12:58:46,684 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 12:58:46,684 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 12:58:46,685 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 12:58:46,689 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 12:58:46,697 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 12:58:46,701 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 12:58:46,703 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 12:58:46,705 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 12:58:46,706 - __main__ - INFO - 
======================================================================
2025-10-17 12:58:46,706 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 12:58:46,707 - __main__ - INFO - ======================================================================
2025-10-17 12:58:46,708 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 12:58:46,708 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 12:58:47,929 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 12:58:47,931 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 12:58:47,938 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 12:58:47,940 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 12:58:47,949 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 12:58:47,951 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 12:58:47,952 - __main__ - INFO - 
======================================================================
2025-10-17 12:58:47,953 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 12:58:47,953 - __main__ - INFO - ======================================================================
2025-10-17 12:58:47,953 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 12:58:47,954 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 12:58:47,958 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:04:16,619 - __main__ - INFO - ======================================================================
2025-10-17 13:04:16,619 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:04:16,620 - __main__ - INFO - ======================================================================
2025-10-17 13:04:16,620 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:04:16,620 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:04:16,621 - __main__ - INFO - 
======================================================================
2025-10-17 13:04:16,621 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:04:16,621 - __main__ - INFO - ======================================================================
2025-10-17 13:04:16,622 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:04:17,247 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:04:17,247 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:04:17,330 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:04:17,343 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:04:17,347 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:04:17,427 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:04:17,429 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:04:17,433 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:04:17,439 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:04:17,441 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:04:17,447 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:04:17,462 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:04:17,476 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:04:17,477 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:04:17,489 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:04:17,489 - __main__ - INFO - 
======================================================================
2025-10-17 13:04:17,489 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:04:17,489 - __main__ - INFO - ======================================================================
2025-10-17 13:04:17,499 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:04:17,505 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:04:18,749 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:04:18,755 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:04:18,760 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:04:18,761 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:04:18,766 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:04:18,767 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:04:18,767 - __main__ - INFO - 
======================================================================
2025-10-17 13:04:18,767 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:04:18,767 - __main__ - INFO - ======================================================================
2025-10-17 13:04:18,767 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:04:18,769 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:04:18,770 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:07:31,824 - __main__ - INFO - ======================================================================
2025-10-17 13:07:31,826 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:07:31,826 - __main__ - INFO - ======================================================================
2025-10-17 13:07:31,826 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:07:31,827 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:07:31,827 - __main__ - INFO - 
======================================================================
2025-10-17 13:07:31,827 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:07:31,827 - __main__ - INFO - ======================================================================
2025-10-17 13:07:31,828 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:07:32,344 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:07:32,344 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:07:32,392 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:07:32,399 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:07:32,401 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:07:32,437 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:07:32,437 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:07:32,437 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:07:32,437 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:07:32,437 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:07:32,439 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:07:32,443 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:07:32,445 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:07:32,446 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:07:32,446 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:07:32,446 - __main__ - INFO - 
======================================================================
2025-10-17 13:07:32,446 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:07:32,446 - __main__ - INFO - ======================================================================
2025-10-17 13:07:32,447 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:07:32,447 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:07:33,059 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:07:33,061 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:07:33,064 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:07:33,064 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:07:33,066 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:07:33,066 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:07:33,066 - __main__ - INFO - 
======================================================================
2025-10-17 13:07:33,067 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:07:33,067 - __main__ - INFO - ======================================================================
2025-10-17 13:07:33,067 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:07:33,067 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:07:33,068 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:08:32,112 - __main__ - INFO - ======================================================================
2025-10-17 13:08:32,112 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:08:32,113 - __main__ - INFO - ======================================================================
2025-10-17 13:08:32,113 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:08:32,113 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:08:32,113 - __main__ - INFO - 
======================================================================
2025-10-17 13:08:32,113 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:08:32,113 - __main__ - INFO - ======================================================================
2025-10-17 13:08:32,113 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:08:33,093 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:08:33,095 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:08:33,161 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:08:33,170 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:08:33,172 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:08:33,201 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:08:33,202 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:08:33,205 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:08:33,205 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:08:33,205 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:08:33,207 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:08:33,213 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:08:33,216 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:08:33,217 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:08:33,217 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:08:33,217 - __main__ - INFO - 
======================================================================
2025-10-17 13:08:33,217 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:08:33,217 - __main__ - INFO - ======================================================================
2025-10-17 13:08:33,218 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:08:33,218 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:08:33,502 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:08:33,503 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:08:33,505 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:08:33,505 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:08:33,507 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:08:33,507 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:08:33,507 - __main__ - INFO - 
======================================================================
2025-10-17 13:08:33,508 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:08:33,508 - __main__ - INFO - ======================================================================
2025-10-17 13:08:33,508 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:08:33,508 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:08:33,509 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:09:17,359 - __main__ - INFO - ======================================================================
2025-10-17 13:09:17,359 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:09:17,359 - __main__ - INFO - ======================================================================
2025-10-17 13:09:17,360 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:09:17,360 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:09:17,360 - __main__ - INFO - 
======================================================================
2025-10-17 13:09:17,361 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:09:17,361 - __main__ - INFO - ======================================================================
2025-10-17 13:09:17,362 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:09:18,317 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:09:18,318 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:09:18,383 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:09:18,392 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:09:18,395 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:09:18,436 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:09:18,439 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:09:18,440 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:09:18,441 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:09:18,441 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:09:18,447 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:09:18,457 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:09:18,466 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:09:18,468 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:09:18,469 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:09:18,470 - __main__ - INFO - 
======================================================================
2025-10-17 13:09:18,471 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:09:18,471 - __main__ - INFO - ======================================================================
2025-10-17 13:09:18,472 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:09:18,473 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:09:19,095 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:09:19,097 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:09:19,100 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:09:19,100 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:09:19,104 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:09:19,105 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:09:19,105 - __main__ - INFO - 
======================================================================
2025-10-17 13:09:19,105 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:09:19,106 - __main__ - INFO - ======================================================================
2025-10-17 13:09:19,106 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:09:19,107 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:09:19,108 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:11:18,508 - __main__ - INFO - ======================================================================
2025-10-17 13:11:18,509 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:11:18,509 - __main__ - INFO - ======================================================================
2025-10-17 13:11:18,509 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:11:18,509 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:11:18,509 - __main__ - INFO - 
======================================================================
2025-10-17 13:11:18,510 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:11:18,510 - __main__ - INFO - ======================================================================
2025-10-17 13:11:18,510 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:11:19,152 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:11:19,153 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:11:19,200 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:11:19,208 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:11:19,211 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:11:19,251 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:11:19,251 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:11:19,252 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:11:19,252 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:11:19,252 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:11:19,254 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:11:19,257 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:11:19,259 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:11:19,260 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:11:19,260 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:11:19,260 - __main__ - INFO - 
======================================================================
2025-10-17 13:11:19,260 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:11:19,260 - __main__ - INFO - ======================================================================
2025-10-17 13:11:19,261 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:11:19,261 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:11:19,815 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:11:19,817 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:11:19,819 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:11:19,819 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:11:19,823 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:11:19,823 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:11:19,823 - __main__ - INFO - 
======================================================================
2025-10-17 13:11:19,823 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:11:19,824 - __main__ - INFO - ======================================================================
2025-10-17 13:11:19,824 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:11:19,824 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:11:19,825 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:11:58,574 - __main__ - INFO - ======================================================================
2025-10-17 13:11:58,578 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:11:58,579 - __main__ - INFO - ======================================================================
2025-10-17 13:11:58,579 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:11:58,579 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:11:58,580 - __main__ - INFO - 
======================================================================
2025-10-17 13:11:58,580 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:11:58,580 - __main__ - INFO - ======================================================================
2025-10-17 13:11:58,580 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:11:59,112 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:11:59,113 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:11:59,163 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:11:59,170 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:11:59,175 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:11:59,202 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:11:59,203 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:11:59,203 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:11:59,203 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:11:59,204 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:11:59,206 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:11:59,209 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:11:59,211 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:11:59,211 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:11:59,212 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:11:59,212 - __main__ - INFO - 
======================================================================
2025-10-17 13:11:59,212 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:11:59,212 - __main__ - INFO - ======================================================================
2025-10-17 13:11:59,212 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:11:59,212 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:11:59,906 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:11:59,909 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:11:59,915 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:11:59,915 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:11:59,919 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:11:59,919 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:11:59,919 - __main__ - INFO - 
======================================================================
2025-10-17 13:11:59,919 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:11:59,920 - __main__ - INFO - ======================================================================
2025-10-17 13:11:59,921 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:11:59,921 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:11:59,922 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:15:11,608 - __main__ - INFO - ======================================================================
2025-10-17 13:15:11,608 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:15:11,609 - __main__ - INFO - ======================================================================
2025-10-17 13:15:11,609 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:15:11,609 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:15:11,609 - __main__ - INFO - 
======================================================================
2025-10-17 13:15:11,609 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:15:11,610 - __main__ - INFO - ======================================================================
2025-10-17 13:15:11,610 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:15:12,531 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:15:12,532 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:15:12,586 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:15:12,592 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:15:12,593 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:15:12,622 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:15:12,622 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:15:12,623 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:15:12,623 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:15:12,623 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:15:12,625 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:15:12,630 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:15:12,645 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:15:12,646 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:15:12,647 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:15:12,648 - __main__ - INFO - 
======================================================================
2025-10-17 13:15:12,648 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:15:12,649 - __main__ - INFO - ======================================================================
2025-10-17 13:15:12,650 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:15:12,650 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:15:13,502 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:15:13,590 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:15:13,602 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:15:13,604 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:15:13,625 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:15:13,627 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:15:13,629 - __main__ - INFO - 
======================================================================
2025-10-17 13:15:13,630 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:15:13,630 - __main__ - INFO - ======================================================================
2025-10-17 13:15:13,632 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:15:13,642 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:15:13,649 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:15:28,683 - __main__ - INFO - ======================================================================
2025-10-17 13:15:28,684 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:15:28,684 - __main__ - INFO - ======================================================================
2025-10-17 13:15:28,684 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:15:28,684 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:15:28,684 - __main__ - INFO - 
======================================================================
2025-10-17 13:15:28,684 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:15:28,684 - __main__ - INFO - ======================================================================
2025-10-17 13:15:28,684 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:15:29,152 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:15:29,153 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:15:29,201 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:15:29,209 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:15:29,211 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:15:29,235 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:15:29,237 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:15:29,238 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:15:29,238 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:15:29,239 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:15:29,241 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:15:29,243 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:15:29,245 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:15:29,245 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:15:29,246 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:15:29,246 - __main__ - INFO - 
======================================================================
2025-10-17 13:15:29,247 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:15:29,247 - __main__ - INFO - ======================================================================
2025-10-17 13:15:29,247 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:15:29,248 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:15:29,522 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:15:29,523 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:15:29,526 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:15:29,526 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:15:29,527 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:15:29,528 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:15:29,528 - __main__ - INFO - 
======================================================================
2025-10-17 13:15:29,528 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:15:29,528 - __main__ - INFO - ======================================================================
2025-10-17 13:15:29,528 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:15:29,528 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:15:29,529 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:16:17,333 - __main__ - INFO - ======================================================================
2025-10-17 13:16:17,334 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:16:17,335 - __main__ - INFO - ======================================================================
2025-10-17 13:16:17,335 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:16:17,335 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:16:17,335 - __main__ - INFO - 
======================================================================
2025-10-17 13:16:17,335 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:16:17,335 - __main__ - INFO - ======================================================================
2025-10-17 13:16:17,335 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:16:17,965 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:16:17,965 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:16:18,038 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:16:18,054 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:16:18,057 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:16:18,100 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:16:18,101 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:16:18,101 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:16:18,101 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:16:18,102 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:16:18,103 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:16:18,106 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:16:18,109 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:16:18,109 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:16:18,110 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:16:18,110 - __main__ - INFO - 
======================================================================
2025-10-17 13:16:18,111 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:16:18,111 - __main__ - INFO - ======================================================================
2025-10-17 13:16:18,112 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:16:18,112 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:16:19,032 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:16:19,040 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:16:19,054 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:16:19,054 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:16:19,060 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:16:19,061 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:16:19,061 - __main__ - INFO - 
======================================================================
2025-10-17 13:16:19,061 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:16:19,062 - __main__ - INFO - ======================================================================
2025-10-17 13:16:19,062 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:16:19,063 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:16:19,065 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:17:26,239 - __main__ - INFO - ======================================================================
2025-10-17 13:17:26,241 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:17:26,241 - __main__ - INFO - ======================================================================
2025-10-17 13:17:26,241 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:17:26,241 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:17:26,241 - __main__ - INFO - 
======================================================================
2025-10-17 13:17:26,241 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:17:26,242 - __main__ - INFO - ======================================================================
2025-10-17 13:17:26,242 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:17:27,151 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:17:27,151 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:17:27,209 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:17:27,224 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:17:27,228 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:17:27,268 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:17:27,269 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:17:27,269 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:17:27,269 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:17:27,270 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:17:27,272 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:17:27,277 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:17:27,280 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:17:27,280 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:17:27,281 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:17:27,281 - __main__ - INFO - 
======================================================================
2025-10-17 13:17:27,281 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:17:27,282 - __main__ - INFO - ======================================================================
2025-10-17 13:17:27,283 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:17:27,283 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:17:28,080 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:17:28,090 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:17:28,109 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:17:28,111 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:17:28,116 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:17:28,117 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:17:28,117 - __main__ - INFO - 
======================================================================
2025-10-17 13:17:28,117 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:17:28,118 - __main__ - INFO - ======================================================================
2025-10-17 13:17:28,119 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:17:28,119 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:17:28,121 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:17:36,157 - __main__ - INFO - ======================================================================
2025-10-17 13:17:36,157 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:17:36,157 - __main__ - INFO - ======================================================================
2025-10-17 13:17:36,157 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:17:36,157 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:17:36,157 - __main__ - INFO - 
======================================================================
2025-10-17 13:17:36,157 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:17:36,158 - __main__ - INFO - ======================================================================
2025-10-17 13:17:36,158 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:17:36,641 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:17:36,641 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:17:36,692 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:17:36,700 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:17:36,703 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:17:36,737 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:17:36,738 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:17:36,738 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:17:36,739 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:17:36,739 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:17:36,743 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:17:36,745 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:17:36,748 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:17:36,750 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:17:36,751 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:17:36,751 - __main__ - INFO - 
======================================================================
2025-10-17 13:17:36,751 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:17:36,751 - __main__ - INFO - ======================================================================
2025-10-17 13:17:36,752 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:17:36,752 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:17:37,045 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:17:37,046 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:17:37,050 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:17:37,051 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:17:37,060 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:17:37,060 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:17:37,061 - __main__ - INFO - 
======================================================================
2025-10-17 13:17:37,061 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:17:37,061 - __main__ - INFO - ======================================================================
2025-10-17 13:17:37,062 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:17:37,062 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:17:37,063 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:21:57,215 - __main__ - INFO - ======================================================================
2025-10-17 13:21:57,215 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:21:57,216 - __main__ - INFO - ======================================================================
2025-10-17 13:21:57,216 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:21:57,216 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:21:57,216 - __main__ - INFO - 
======================================================================
2025-10-17 13:21:57,216 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:21:57,216 - __main__ - INFO - ======================================================================
2025-10-17 13:21:57,216 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:21:57,813 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:21:57,814 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:21:57,866 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:21:57,871 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:21:57,872 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:21:57,897 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:21:57,898 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:21:57,898 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:21:57,898 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:21:57,898 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:21:57,900 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:21:57,903 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:21:57,905 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:21:57,906 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:21:57,906 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:21:57,906 - __main__ - INFO - 
======================================================================
2025-10-17 13:21:57,907 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:21:57,907 - __main__ - INFO - ======================================================================
2025-10-17 13:21:57,907 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:21:57,907 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:21:58,500 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:21:58,503 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:21:58,510 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:21:58,511 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:21:58,514 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:21:58,514 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:21:58,515 - __main__ - INFO - 
======================================================================
2025-10-17 13:21:58,515 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:21:58,516 - __main__ - INFO - ======================================================================
2025-10-17 13:21:58,516 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:21:58,516 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:21:58,518 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:23:41,852 - __main__ - INFO - ======================================================================
2025-10-17 13:23:41,852 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:23:41,852 - __main__ - INFO - ======================================================================
2025-10-17 13:23:41,853 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:23:41,853 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:23:41,853 - __main__ - INFO - 
======================================================================
2025-10-17 13:23:41,854 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:23:41,854 - __main__ - INFO - ======================================================================
2025-10-17 13:23:41,854 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:23:43,753 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:23:43,754 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:23:43,809 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:23:43,818 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:23:43,820 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:23:43,848 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:23:43,851 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:23:43,852 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:23:43,852 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:23:43,853 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:23:43,855 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:23:43,859 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:23:43,861 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:23:43,861 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:23:43,861 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:23:43,862 - __main__ - INFO - 
======================================================================
2025-10-17 13:23:43,862 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:23:43,862 - __main__ - INFO - ======================================================================
2025-10-17 13:23:43,862 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:23:43,862 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:23:44,321 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:23:44,326 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:23:44,334 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:23:44,334 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:23:44,341 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:23:44,342 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:23:44,343 - __main__ - INFO - 
======================================================================
2025-10-17 13:23:44,343 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:23:44,343 - __main__ - INFO - ======================================================================
2025-10-17 13:23:44,343 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:23:44,343 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:23:44,345 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:27:24,694 - __main__ - INFO - ======================================================================
2025-10-17 13:27:24,694 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:27:24,694 - __main__ - INFO - ======================================================================
2025-10-17 13:27:24,694 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:27:24,695 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:27:24,695 - __main__ - INFO - 
======================================================================
2025-10-17 13:27:24,695 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:27:24,695 - __main__ - INFO - ======================================================================
2025-10-17 13:27:24,696 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:27:26,060 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:27:26,062 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:27:26,120 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:27:26,128 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:27:26,130 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:27:26,184 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:27:26,185 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:27:26,187 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:27:26,187 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:27:26,188 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:27:26,192 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:27:26,200 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:27:26,204 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:27:26,205 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:27:26,207 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:27:26,207 - __main__ - INFO - 
======================================================================
2025-10-17 13:27:26,207 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:27:26,207 - __main__ - INFO - ======================================================================
2025-10-17 13:27:26,208 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:27:26,208 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:27:26,749 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:27:26,753 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:27:26,759 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:27:26,760 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:27:26,764 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:27:26,764 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:27:26,765 - __main__ - INFO - 
======================================================================
2025-10-17 13:27:26,766 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:27:26,772 - __main__ - INFO - ======================================================================
2025-10-17 13:27:26,773 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:27:26,774 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:27:26,777 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:30:26,074 - __main__ - INFO - ======================================================================
2025-10-17 13:30:26,075 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:30:26,075 - __main__ - INFO - ======================================================================
2025-10-17 13:30:26,075 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:30:26,076 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:30:26,076 - __main__ - INFO - 
======================================================================
2025-10-17 13:30:26,076 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:30:26,077 - __main__ - INFO - ======================================================================
2025-10-17 13:30:26,078 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:30:27,121 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:30:27,124 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:30:27,238 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:30:27,263 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:30:27,267 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:30:27,325 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:30:27,328 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:30:27,329 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:30:27,331 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:30:27,331 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:30:27,336 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:30:27,344 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:30:27,357 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:30:27,363 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:30:27,367 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:30:27,369 - __main__ - INFO - 
======================================================================
2025-10-17 13:30:27,370 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:30:27,370 - __main__ - INFO - ======================================================================
2025-10-17 13:30:27,372 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:30:27,373 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:30:28,022 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:30:28,024 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:30:28,027 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:30:28,027 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:30:28,029 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:30:28,029 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:30:28,029 - __main__ - INFO - 
======================================================================
2025-10-17 13:30:28,030 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:30:28,030 - __main__ - INFO - ======================================================================
2025-10-17 13:30:28,030 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:30:28,030 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:30:28,031 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:35:16,133 - __main__ - INFO - ======================================================================
2025-10-17 13:35:16,133 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:35:16,135 - __main__ - INFO - ======================================================================
2025-10-17 13:35:16,135 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:35:16,135 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:35:16,135 - __main__ - INFO - 
======================================================================
2025-10-17 13:35:16,135 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:35:16,135 - __main__ - INFO - ======================================================================
2025-10-17 13:35:16,135 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:35:16,594 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:35:16,595 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:35:16,644 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:35:16,650 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:35:16,653 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:35:16,679 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:35:16,679 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:35:16,679 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:35:16,680 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:35:16,680 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:35:16,683 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:35:16,689 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:35:16,692 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:35:16,692 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:35:16,693 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:35:16,693 - __main__ - INFO - 
======================================================================
2025-10-17 13:35:16,693 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:35:16,693 - __main__ - INFO - ======================================================================
2025-10-17 13:35:16,694 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:35:16,694 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:35:17,192 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:35:17,193 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:35:17,196 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:35:17,196 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:35:17,197 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:35:17,198 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:35:17,198 - __main__ - INFO - 
======================================================================
2025-10-17 13:35:17,198 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:35:17,198 - __main__ - INFO - ======================================================================
2025-10-17 13:35:17,198 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:35:17,198 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:35:17,199 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:43:35,838 - __main__ - INFO - ======================================================================
2025-10-17 13:43:35,843 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:43:35,844 - __main__ - INFO - ======================================================================
2025-10-17 13:43:35,845 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:43:35,846 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:43:35,846 - __main__ - INFO - 
======================================================================
2025-10-17 13:43:35,847 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:43:35,848 - __main__ - INFO - ======================================================================
2025-10-17 13:43:35,849 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:43:37,576 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:43:37,579 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:43:37,831 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:43:37,851 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:43:37,857 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:43:37,954 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:43:37,959 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:43:37,967 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:43:37,968 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:43:37,969 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:43:37,974 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:43:38,046 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:43:38,142 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:43:38,153 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:43:38,157 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:43:38,158 - __main__ - INFO - 
======================================================================
2025-10-17 13:43:38,158 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:43:38,160 - __main__ - INFO - ======================================================================
2025-10-17 13:43:38,167 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:43:38,167 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:43:38,889 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:43:38,909 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:43:38,920 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:43:38,921 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:43:38,956 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:43:38,970 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:43:38,970 - __main__ - INFO - 
======================================================================
2025-10-17 13:43:38,970 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:43:38,970 - __main__ - INFO - ======================================================================
2025-10-17 13:43:38,978 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:43:38,987 - __main__ - ERROR - Prediction flow failed: 'function' object has no attribute 'fn'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 153, in prediction_flow
    df = engineer_features(df)
         ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/data/feature_engineering.py", line 245, in engineer_features
    df = add_date_features.fn(df)
         ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'fn'
2025-10-17 13:43:39,045 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 13:47:01,168 - __main__ - INFO - ======================================================================
2025-10-17 13:47:01,169 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 13:47:01,169 - __main__ - INFO - ======================================================================
2025-10-17 13:47:01,169 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 13:47:01,169 - __main__ - INFO - Output path: data/predictions/
2025-10-17 13:47:01,169 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:01,169 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 13:47:01,170 - __main__ - INFO - ======================================================================
2025-10-17 13:47:01,170 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 13:47:01,638 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 13:47:01,638 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 13:47:01,697 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 13:47:01,703 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 13:47:01,706 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 13:47:01,732 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 13:47:01,732 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 13:47:01,732 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 13:47:01,733 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 13:47:01,733 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 13:47:01,735 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 13:47:01,741 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 13:47:01,744 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 13:47:01,745 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 13:47:01,746 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 13:47:01,747 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:01,747 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 13:47:01,747 - __main__ - INFO - ======================================================================
2025-10-17 13:47:01,749 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 13:47:01,750 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 13:47:02,004 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 13:47:02,006 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 13:47:02,011 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 13:47:02,011 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 13:47:02,016 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 13:47:02,018 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 13:47:02,018 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:02,018 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 13:47:02,018 - __main__ - INFO - ======================================================================
2025-10-17 13:47:02,019 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 13:47:02,020 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-17 13:47:02,030 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-17 13:47:02,030 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-17 13:47:02,035 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-17 13:47:02,036 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-17 13:47:02,044 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-17 13:47:02,044 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-17 13:47:02,057 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-17 13:47:02,058 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-17 13:47:02,061 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-17 13:47:02,062 - src.data.feature_engineering - INFO - Adding change features
2025-10-17 13:47:02,068 - src.data.feature_engineering - INFO - Added change features
2025-10-17 13:47:02,068 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-17 13:47:02,069 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-17 13:47:02,069 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-17 13:47:02,070 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-17 13:47:02,073 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-17 13:47:02,075 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-17 13:47:02,076 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-17 13:47:02,076 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-17 13:47:02,076 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:02,077 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-17 13:47:02,077 - __main__ - INFO - ======================================================================
2025-10-17 13:47:02,077 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-17 13:47:02,077 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-17 13:47:02,114 - src.utils.mlflow_utils - ERROR - Failed to load production model: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,118 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 1: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,119 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_1.pkl
2025-10-17 13:47:02,119 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_1.pkl
2025-10-17 13:47:02,145 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-17 13:47:02,147 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=1)
2025-10-17 13:47:02,148 - src.models.predict - INFO - Loaded model for horizon 1 from local file
2025-10-17 13:47:02,148 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-17 13:47:02,154 - src.utils.mlflow_utils - ERROR - Failed to load production model: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,154 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 2: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,154 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_2.pkl
2025-10-17 13:47:02,155 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_2.pkl
2025-10-17 13:47:02,165 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-17 13:47:02,166 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=2)
2025-10-17 13:47:02,166 - src.models.predict - INFO - Loaded model for horizon 2 from local file
2025-10-17 13:47:02,167 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-17 13:47:02,170 - src.utils.mlflow_utils - ERROR - Failed to load production model: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,172 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 3: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,173 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_3.pkl
2025-10-17 13:47:02,174 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_3.pkl
2025-10-17 13:47:02,185 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-17 13:47:02,187 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=3)
2025-10-17 13:47:02,187 - src.models.predict - INFO - Loaded model for horizon 3 from local file
2025-10-17 13:47:02,188 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-17 13:47:02,191 - src.utils.mlflow_utils - ERROR - Failed to load production model: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,191 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 4: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,192 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_4.pkl
2025-10-17 13:47:02,192 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_4.pkl
2025-10-17 13:47:02,208 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-17 13:47:02,208 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=4)
2025-10-17 13:47:02,209 - src.models.predict - INFO - Loaded model for horizon 4 from local file
2025-10-17 13:47:02,210 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-17 13:47:02,218 - src.utils.mlflow_utils - ERROR - Failed to load production model: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,219 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 5: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,223 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_5.pkl
2025-10-17 13:47:02,224 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_5.pkl
2025-10-17 13:47:02,247 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-17 13:47:02,248 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=5)
2025-10-17 13:47:02,248 - src.models.predict - INFO - Loaded model for horizon 5 from local file
2025-10-17 13:47:02,249 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-17 13:47:02,264 - src.utils.mlflow_utils - ERROR - Failed to load production model: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,265 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 6: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,269 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_6.pkl
2025-10-17 13:47:02,269 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_6.pkl
2025-10-17 13:47:02,284 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-17 13:47:02,284 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=6)
2025-10-17 13:47:02,284 - src.models.predict - INFO - Loaded model for horizon 6 from local file
2025-10-17 13:47:02,284 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-17 13:47:02,288 - src.utils.mlflow_utils - ERROR - Failed to load production model: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,288 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 7: API request to endpoint /api/2.0/mlflow/registered-models/get failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,288 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_7.pkl
2025-10-17 13:47:02,288 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_7.pkl
2025-10-17 13:47:02,309 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-17 13:47:02,309 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=7)
2025-10-17 13:47:02,309 - src.models.predict - INFO - Loaded model for horizon 7 from local file
2025-10-17 13:47:02,309 - src.models.predict - WARNING - Used local file fallback for model loading (running in local/test mode)
2025-10-17 13:47:02,310 - __main__ - INFO - Loaded 7 production models
2025-10-17 13:47:02,310 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:02,310 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-17 13:47:02,310 - __main__ - INFO - ======================================================================
2025-10-17 13:47:02,310 - src.models.predict - INFO - Preparing features for prediction
2025-10-17 13:47:02,311 - src.models.predict - INFO - Base date for predictions: 2025-10-17
2025-10-17 13:47:02,337 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-17 13:47:02,338 - src.models.predict - INFO - Prediction date range: 2025-10-18 to 2025-10-24
2025-10-17 13:47:02,339 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-17 13:47:02,339 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-17 13:47:02,339 - __main__ - INFO - Features prepared for next 7 days
2025-10-17 13:47:02,339 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:02,340 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-17 13:47:02,340 - __main__ - INFO - ======================================================================
2025-10-17 13:47:02,340 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-17 13:47:02,340 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-17 13:47:02,340 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-17 13:47:02,341 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-17 13:47:02,406 - src.models.predict - INFO - Generated 7 predictions
2025-10-17 13:47:02,407 - src.models.predict - INFO - Prediction range: 52.1 to 67.0 patients
2025-10-17 13:47:02,409 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.07s
2025-10-17 13:47:02,409 - __main__ - INFO - Generated 7 predictions in 0.07s
2025-10-17 13:47:02,409 - __main__ - INFO -    Prediction range: 52.1 to 67.0 patients
2025-10-17 13:47:02,410 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:02,410 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-17 13:47:02,410 - __main__ - INFO - ======================================================================
2025-10-17 13:47:02,411 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-17 13:47:02,423 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251017_134702.csv
2025-10-17 13:47:02,423 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-17 13:47:02,423 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251017_134702.csv
2025-10-17 13:47:02,424 - __main__ - INFO - 
======================================================================
2025-10-17 13:47:02,424 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-17 13:47:02,424 - __main__ - INFO - ======================================================================
2025-10-17 13:47:02,425 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-17 13:47:02,428 - src.models.prediction_output - ERROR - Failed to log prediction metadata to MLflow: API request to endpoint /api/2.0/mlflow/experiments/get-by-name failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,430 - __main__ - ERROR - Prediction flow failed: API request to endpoint /api/2.0/mlflow/experiments/get-by-name failed with error code 403 != 200. Response body: ''
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 244, in prediction_flow
    mlflow_run_id = log_prediction_metadata_to_mlflow(predictions)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/models/prediction_output.py", line 118, in log_prediction_metadata_to_mlflow
    mlflow.set_experiment("ER_Patient_Predictions")
  File "/app/.venv/lib/python3.11/site-packages/mlflow/tracking/fluent.py", line 185, in set_experiment
    experiment = client.get_experiment_by_name(experiment_name)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/mlflow/tracking/_tracking_service/client.py", line 279, in get_experiment_by_name
    return self.store.get_experiment_by_name(name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/mlflow/store/tracking/rest_store.py", line 855, in get_experiment_by_name
    response_proto = self._call_endpoint(GetExperimentByName, req_body)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/mlflow/store/tracking/rest_store.py", line 200, in _call_endpoint
    return call_endpoint(
           ^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/mlflow/utils/rest_utils.py", line 554, in call_endpoint
    response = verify_rest_response(response, endpoint)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/mlflow/utils/rest_utils.py", line 314, in verify_rest_response
    raise MlflowException(
mlflow.exceptions.MlflowException: API request to endpoint /api/2.0/mlflow/experiments/get-by-name failed with error code 403 != 200. Response body: ''
2025-10-17 13:47:02,434 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-17 14:03:47,870 - __main__ - INFO - ======================================================================
2025-10-17 14:03:47,870 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 14:03:47,870 - __main__ - INFO - ======================================================================
2025-10-17 14:03:47,871 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 14:03:47,871 - __main__ - INFO - Output path: data/predictions/
2025-10-17 14:03:47,871 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:47,871 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 14:03:47,871 - __main__ - INFO - ======================================================================
2025-10-17 14:03:47,871 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 14:03:48,759 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 14:03:48,759 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 14:03:48,809 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 14:03:48,814 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 14:03:48,815 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 14:03:48,839 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 14:03:48,840 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 14:03:48,840 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 14:03:48,840 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 14:03:48,840 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 14:03:48,843 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 14:03:48,847 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 14:03:48,849 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 14:03:48,850 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 14:03:48,850 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 14:03:48,850 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:48,850 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 14:03:48,850 - __main__ - INFO - ======================================================================
2025-10-17 14:03:48,851 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 14:03:48,851 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 14:03:49,122 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 14:03:49,125 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 14:03:49,130 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 14:03:49,131 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 14:03:49,135 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 14:03:49,136 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 14:03:49,136 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:49,136 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 14:03:49,136 - __main__ - INFO - ======================================================================
2025-10-17 14:03:49,137 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 14:03:49,137 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-17 14:03:49,144 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-17 14:03:49,145 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-17 14:03:49,147 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-17 14:03:49,147 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-17 14:03:49,150 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-17 14:03:49,151 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-17 14:03:49,158 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-17 14:03:49,158 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-17 14:03:49,161 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-17 14:03:49,162 - src.data.feature_engineering - INFO - Adding change features
2025-10-17 14:03:49,164 - src.data.feature_engineering - INFO - Added change features
2025-10-17 14:03:49,164 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-17 14:03:49,164 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-17 14:03:49,164 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-17 14:03:49,166 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-17 14:03:49,167 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-17 14:03:49,169 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-17 14:03:49,169 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-17 14:03:49,169 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-17 14:03:49,169 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:49,169 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-17 14:03:49,170 - __main__ - INFO - ======================================================================
2025-10-17 14:03:49,170 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-17 14:03:49,170 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-17 14:03:49,225 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_1'. Please promote a model to Production stage first.
2025-10-17 14:03:49,225 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 1: No production model found for 'er_forecast_horizon_1'. Please promote a model to Production stage first.
2025-10-17 14:03:49,225 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_1.pkl
2025-10-17 14:03:49,226 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_1.pkl
2025-10-17 14:03:49,229 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-17 14:03:49,230 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=1)
2025-10-17 14:03:49,230 - src.models.predict - INFO - Loaded model for horizon 1 from local file
2025-10-17 14:03:49,230 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-17 14:03:49,240 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_2'. Please promote a model to Production stage first.
2025-10-17 14:03:49,240 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 2: No production model found for 'er_forecast_horizon_2'. Please promote a model to Production stage first.
2025-10-17 14:03:49,240 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_2.pkl
2025-10-17 14:03:49,241 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_2.pkl
2025-10-17 14:03:49,245 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-17 14:03:49,245 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=2)
2025-10-17 14:03:49,245 - src.models.predict - INFO - Loaded model for horizon 2 from local file
2025-10-17 14:03:49,245 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-17 14:03:49,280 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_3'. Please promote a model to Production stage first.
2025-10-17 14:03:49,280 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 3: No production model found for 'er_forecast_horizon_3'. Please promote a model to Production stage first.
2025-10-17 14:03:49,281 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_3.pkl
2025-10-17 14:03:49,281 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_3.pkl
2025-10-17 14:03:49,284 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-17 14:03:49,284 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=3)
2025-10-17 14:03:49,284 - src.models.predict - INFO - Loaded model for horizon 3 from local file
2025-10-17 14:03:49,284 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-17 14:03:49,294 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_4'. Please promote a model to Production stage first.
2025-10-17 14:03:49,295 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 4: No production model found for 'er_forecast_horizon_4'. Please promote a model to Production stage first.
2025-10-17 14:03:49,295 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_4.pkl
2025-10-17 14:03:49,295 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_4.pkl
2025-10-17 14:03:49,302 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-17 14:03:49,302 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=4)
2025-10-17 14:03:49,302 - src.models.predict - INFO - Loaded model for horizon 4 from local file
2025-10-17 14:03:49,302 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-17 14:03:49,319 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_5'. Please promote a model to Production stage first.
2025-10-17 14:03:49,319 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 5: No production model found for 'er_forecast_horizon_5'. Please promote a model to Production stage first.
2025-10-17 14:03:49,320 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_5.pkl
2025-10-17 14:03:49,320 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_5.pkl
2025-10-17 14:03:49,323 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-17 14:03:49,323 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=5)
2025-10-17 14:03:49,323 - src.models.predict - INFO - Loaded model for horizon 5 from local file
2025-10-17 14:03:49,323 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-17 14:03:49,365 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_6'. Please promote a model to Production stage first.
2025-10-17 14:03:49,366 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 6: No production model found for 'er_forecast_horizon_6'. Please promote a model to Production stage first.
2025-10-17 14:03:49,368 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_6.pkl
2025-10-17 14:03:49,368 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_6.pkl
2025-10-17 14:03:49,373 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-17 14:03:49,373 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=6)
2025-10-17 14:03:49,373 - src.models.predict - INFO - Loaded model for horizon 6 from local file
2025-10-17 14:03:49,373 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-17 14:03:49,420 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_7'. Please promote a model to Production stage first.
2025-10-17 14:03:49,421 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 7: No production model found for 'er_forecast_horizon_7'. Please promote a model to Production stage first.
2025-10-17 14:03:49,421 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_7.pkl
2025-10-17 14:03:49,422 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_7.pkl
2025-10-17 14:03:49,432 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-17 14:03:49,432 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=7)
2025-10-17 14:03:49,433 - src.models.predict - INFO - Loaded model for horizon 7 from local file
2025-10-17 14:03:49,433 - src.models.predict - WARNING - Used local file fallback for model loading (running in local/test mode)
2025-10-17 14:03:49,433 - __main__ - INFO - Loaded 7 production models
2025-10-17 14:03:49,433 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:49,433 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-17 14:03:49,433 - __main__ - INFO - ======================================================================
2025-10-17 14:03:49,434 - src.models.predict - INFO - Preparing features for prediction
2025-10-17 14:03:49,434 - src.models.predict - INFO - Base date for predictions: 2025-10-17
2025-10-17 14:03:49,438 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-17 14:03:49,439 - src.models.predict - INFO - Prediction date range: 2025-10-18 to 2025-10-24
2025-10-17 14:03:49,439 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-17 14:03:49,439 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-17 14:03:49,439 - __main__ - INFO - Features prepared for next 7 days
2025-10-17 14:03:49,439 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:49,439 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-17 14:03:49,439 - __main__ - INFO - ======================================================================
2025-10-17 14:03:49,440 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-17 14:03:49,440 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-17 14:03:49,440 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-17 14:03:49,440 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-17 14:03:49,464 - src.models.predict - INFO - Generated 7 predictions
2025-10-17 14:03:49,464 - src.models.predict - INFO - Prediction range: 52.1 to 68.7 patients
2025-10-17 14:03:49,465 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-17 14:03:49,465 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-17 14:03:49,465 - __main__ - INFO -    Prediction range: 52.1 to 68.7 patients
2025-10-17 14:03:49,465 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:49,465 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-17 14:03:49,466 - __main__ - INFO - ======================================================================
2025-10-17 14:03:49,466 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-17 14:03:49,469 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251017_140349.csv
2025-10-17 14:03:49,469 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-17 14:03:49,469 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251017_140349.csv
2025-10-17 14:03:49,470 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:49,470 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-17 14:03:49,470 - __main__ - INFO - ======================================================================
2025-10-17 14:03:49,470 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-17 14:03:49,743 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: d8117e14a65246a5abd30a8fac322b63
2025-10-17 14:03:49,756 - __main__ - INFO - Logged to MLflow run: d8117e14a65246a5abd30a8fac322b63
2025-10-17 14:03:49,756 - __main__ - INFO - 
======================================================================
2025-10-17 14:03:49,757 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-17 14:03:49,757 - __main__ - INFO - ======================================================================
2025-10-17 14:03:49,757 - __main__ - INFO - Average prediction: 62.3 patients
2025-10-17 14:03:49,757 - __main__ - INFO - Average interval width: 39.28565339935789
2025-10-17 14:03:49,757 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-17 14:03:49,758 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-17 14:25:32,450 - __main__ - INFO - ======================================================================
2025-10-17 14:25:32,450 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-17 14:25:32,450 - __main__ - INFO - ======================================================================
2025-10-17 14:25:32,451 - __main__ - INFO - Prediction base date: 2025-10-17
2025-10-17 14:25:32,451 - __main__ - INFO - Output path: data/predictions/
2025-10-17 14:25:32,451 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:32,451 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-17 14:25:32,451 - __main__ - INFO - ======================================================================
2025-10-17 14:25:32,451 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-17 14:25:33,040 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-17 14:25:33,040 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-17 14:25:33,087 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-17 14:25:33,094 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-17 14:25:33,096 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-17 14:25:33,120 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-17 14:25:33,121 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-17 14:25:33,121 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-17 14:25:33,122 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-17 14:25:33,122 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-17 14:25:33,124 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-17 14:25:33,128 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-17 14:25:33,130 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-17 14:25:33,130 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-17 14:25:33,131 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-17 14:25:33,131 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:33,131 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-17 14:25:33,131 - __main__ - INFO - ======================================================================
2025-10-17 14:25:33,132 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-17
2025-10-17 14:25:33,132 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-17 14:25:34,680 - src.data.weather_integration - INFO - Successfully fetched weather data: 1243 days
2025-10-17 14:25:34,684 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-17 14:25:34,689 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-17 14:25:34,689 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-17
2025-10-17 14:25:34,693 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-17 14:25:34,693 - __main__ - INFO - Weather data updated: 1243 days
2025-10-17 14:25:34,694 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:34,694 - __main__ - INFO - STEP 3: Engineering Features
2025-10-17 14:25:34,694 - __main__ - INFO - ======================================================================
2025-10-17 14:25:34,695 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-17 14:25:34,696 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-17 14:25:34,702 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-17 14:25:34,702 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-17 14:25:34,705 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-17 14:25:34,705 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-17 14:25:34,710 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-17 14:25:34,710 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-17 14:25:34,715 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-17 14:25:34,715 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-17 14:25:34,719 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-17 14:25:34,719 - src.data.feature_engineering - INFO - Adding change features
2025-10-17 14:25:34,721 - src.data.feature_engineering - INFO - Added change features
2025-10-17 14:25:34,721 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-17 14:25:34,721 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-17 14:25:34,721 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-17 14:25:34,723 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-17 14:25:34,725 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-17 14:25:34,727 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-17 14:25:34,727 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-17 14:25:34,728 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-17 14:25:34,728 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:34,728 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-17 14:25:34,729 - __main__ - INFO - ======================================================================
2025-10-17 14:25:34,729 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-17 14:25:34,729 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-17 14:25:34,788 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_1'. Please promote a model to Production stage first.
2025-10-17 14:25:34,788 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 1: No production model found for 'er_forecast_horizon_1'. Please promote a model to Production stage first.
2025-10-17 14:25:34,789 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_1.pkl
2025-10-17 14:25:34,790 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_1.pkl
2025-10-17 14:25:34,797 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-17 14:25:34,798 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=1)
2025-10-17 14:25:34,798 - src.models.predict - INFO - Loaded model for horizon 1 from local file
2025-10-17 14:25:34,798 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-17 14:25:34,843 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_2'. Please promote a model to Production stage first.
2025-10-17 14:25:34,843 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 2: No production model found for 'er_forecast_horizon_2'. Please promote a model to Production stage first.
2025-10-17 14:25:34,844 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_2.pkl
2025-10-17 14:25:34,844 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_2.pkl
2025-10-17 14:25:34,849 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-17 14:25:34,850 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=2)
2025-10-17 14:25:34,850 - src.models.predict - INFO - Loaded model for horizon 2 from local file
2025-10-17 14:25:34,850 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-17 14:25:34,874 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_3'. Please promote a model to Production stage first.
2025-10-17 14:25:34,874 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 3: No production model found for 'er_forecast_horizon_3'. Please promote a model to Production stage first.
2025-10-17 14:25:34,874 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_3.pkl
2025-10-17 14:25:34,874 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_3.pkl
2025-10-17 14:25:34,879 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-17 14:25:34,879 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=3)
2025-10-17 14:25:34,879 - src.models.predict - INFO - Loaded model for horizon 3 from local file
2025-10-17 14:25:34,879 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-17 14:25:34,893 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_4'. Please promote a model to Production stage first.
2025-10-17 14:25:34,894 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 4: No production model found for 'er_forecast_horizon_4'. Please promote a model to Production stage first.
2025-10-17 14:25:34,894 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_4.pkl
2025-10-17 14:25:34,894 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_4.pkl
2025-10-17 14:25:34,903 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-17 14:25:34,904 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=4)
2025-10-17 14:25:34,904 - src.models.predict - INFO - Loaded model for horizon 4 from local file
2025-10-17 14:25:34,904 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-17 14:25:34,927 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_5'. Please promote a model to Production stage first.
2025-10-17 14:25:34,927 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 5: No production model found for 'er_forecast_horizon_5'. Please promote a model to Production stage first.
2025-10-17 14:25:34,928 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_5.pkl
2025-10-17 14:25:34,928 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_5.pkl
2025-10-17 14:25:34,934 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-17 14:25:34,934 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=5)
2025-10-17 14:25:34,934 - src.models.predict - INFO - Loaded model for horizon 5 from local file
2025-10-17 14:25:34,934 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-17 14:25:34,982 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_6'. Please promote a model to Production stage first.
2025-10-17 14:25:34,982 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 6: No production model found for 'er_forecast_horizon_6'. Please promote a model to Production stage first.
2025-10-17 14:25:34,983 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_6.pkl
2025-10-17 14:25:34,983 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_6.pkl
2025-10-17 14:25:34,988 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-17 14:25:34,988 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=6)
2025-10-17 14:25:34,988 - src.models.predict - INFO - Loaded model for horizon 6 from local file
2025-10-17 14:25:34,988 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-17 14:25:35,001 - src.utils.mlflow_utils - ERROR - Failed to load production model: No production model found for 'er_forecast_horizon_7'. Please promote a model to Production stage first.
2025-10-17 14:25:35,001 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 7: No production model found for 'er_forecast_horizon_7'. Please promote a model to Production stage first.
2025-10-17 14:25:35,001 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_7.pkl
2025-10-17 14:25:35,001 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_7.pkl
2025-10-17 14:25:35,010 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-17 14:25:35,010 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=7)
2025-10-17 14:25:35,010 - src.models.predict - INFO - Loaded model for horizon 7 from local file
2025-10-17 14:25:35,010 - src.models.predict - WARNING - Used local file fallback for model loading (running in local/test mode)
2025-10-17 14:25:35,010 - __main__ - INFO - Loaded 7 production models
2025-10-17 14:25:35,010 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:35,011 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-17 14:25:35,011 - __main__ - INFO - ======================================================================
2025-10-17 14:25:35,011 - src.models.predict - INFO - Preparing features for prediction
2025-10-17 14:25:35,011 - src.models.predict - INFO - Base date for predictions: 2025-10-17
2025-10-17 14:25:35,017 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-17 14:25:35,017 - src.models.predict - INFO - Prediction date range: 2025-10-18 to 2025-10-24
2025-10-17 14:25:35,017 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-17 14:25:35,018 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-17 14:25:35,018 - __main__ - INFO - Features prepared for next 7 days
2025-10-17 14:25:35,018 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:35,018 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-17 14:25:35,018 - __main__ - INFO - ======================================================================
2025-10-17 14:25:35,018 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-17 14:25:35,018 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-17 14:25:35,018 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-17 14:25:35,019 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-17 14:25:35,044 - src.models.predict - INFO - Generated 7 predictions
2025-10-17 14:25:35,044 - src.models.predict - INFO - Prediction range: 52.1 to 68.7 patients
2025-10-17 14:25:35,045 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.03s
2025-10-17 14:25:35,045 - __main__ - INFO - Generated 7 predictions in 0.03s
2025-10-17 14:25:35,046 - __main__ - INFO -    Prediction range: 52.1 to 68.7 patients
2025-10-17 14:25:35,046 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:35,046 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-17 14:25:35,046 - __main__ - INFO - ======================================================================
2025-10-17 14:25:35,046 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-17 14:25:35,052 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251017_142535.csv
2025-10-17 14:25:35,052 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-17 14:25:35,052 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251017_142535.csv
2025-10-17 14:25:35,053 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:35,053 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-17 14:25:35,053 - __main__ - INFO - ======================================================================
2025-10-17 14:25:35,053 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-17 14:25:35,368 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 4445c3a817984d98b4861c7a5285e19f
2025-10-17 14:25:35,383 - __main__ - INFO - Logged to MLflow run: 4445c3a817984d98b4861c7a5285e19f
2025-10-17 14:25:35,384 - __main__ - INFO - 
======================================================================
2025-10-17 14:25:35,384 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-17 14:25:35,384 - __main__ - INFO - ======================================================================
2025-10-17 14:25:35,384 - __main__ - INFO - Average prediction: 62.3 patients
2025-10-17 14:25:35,384 - __main__ - INFO - Average interval width: 39.28565339935789
2025-10-17 14:25:35,384 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-17 14:25:35,385 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-28 14:52:21,367 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 14:52:21,368 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 14:52:21,368 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 14:52:21,368 - __main__ - INFO - ======================================================================
2025-10-28 14:52:21,368 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 14:52:21,368 - __main__ - INFO - ======================================================================
2025-10-28 14:52:21,368 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 14:52:21,368 - __main__ - INFO - Output path: data/predictions/
2025-10-28 14:52:21,368 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:21,369 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 14:52:21,369 - __main__ - INFO - ======================================================================
2025-10-28 14:52:21,369 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 14:52:21,861 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 14:52:21,862 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 14:52:21,912 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 14:52:21,919 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 14:52:21,921 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 14:52:21,945 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 14:52:21,945 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 14:52:21,945 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 14:52:21,946 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 14:52:21,946 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 14:52:21,948 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 14:52:21,951 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 14:52:21,953 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 14:52:21,953 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 14:52:21,953 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 14:52:21,953 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:21,953 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 14:52:21,954 - __main__ - INFO - ======================================================================
2025-10-28 14:52:21,954 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 14:52:21,954 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 14:52:22,774 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 14:52:22,777 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 14:52:22,782 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 14:52:22,782 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 14:52:22,786 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 14:52:22,786 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 14:52:22,786 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:22,787 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 14:52:22,787 - __main__ - INFO - ======================================================================
2025-10-28 14:52:22,787 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 14:52:22,788 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 14:52:22,800 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 14:52:22,801 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 14:52:22,804 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 14:52:22,805 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 14:52:22,808 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 14:52:22,808 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 14:52:22,816 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 14:52:22,816 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 14:52:22,819 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 14:52:22,819 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 14:52:22,820 - src.data.feature_engineering - INFO - Added change features
2025-10-28 14:52:22,820 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 14:52:22,821 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 14:52:22,821 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 14:52:22,822 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 14:52:22,823 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 14:52:22,824 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 14:52:22,824 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 14:52:22,824 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 14:52:22,824 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:22,825 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 14:52:22,825 - __main__ - INFO - ======================================================================
2025-10-28 14:52:22,825 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 14:52:22,825 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 14:52:22,882 - src.utils.mlflow_utils - INFO - Loading model version 25 from Production stage
2025-10-28 14:52:23,141 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 1: No such file or directory: '/mlflow/1/models/m-02d0528039f9443a804585a79f1c696b/artifacts/.'
2025-10-28 14:52:23,141 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_1.pkl
2025-10-28 14:52:23,141 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_1.pkl
2025-10-28 14:52:23,145 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-28 14:52:23,145 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=1)
2025-10-28 14:52:23,145 - src.models.predict - INFO - Loaded model for horizon 1 from local file
2025-10-28 14:52:23,145 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 14:52:23,159 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 14:52:23,177 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 2: No such file or directory: '/mlflow/1/models/m-77e7599c1f854565b7df4ac591e1c4b6/artifacts/.'
2025-10-28 14:52:23,177 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_2.pkl
2025-10-28 14:52:23,178 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_2.pkl
2025-10-28 14:52:23,182 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-28 14:52:23,182 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=2)
2025-10-28 14:52:23,182 - src.models.predict - INFO - Loaded model for horizon 2 from local file
2025-10-28 14:52:23,183 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 14:52:23,196 - src.utils.mlflow_utils - INFO - Loading model version 22 from Production stage
2025-10-28 14:52:23,213 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 3: No such file or directory: '/mlflow/1/models/m-0b075c8ba0b94973b72fb62be3368477/artifacts/.'
2025-10-28 14:52:23,214 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_3.pkl
2025-10-28 14:52:23,214 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_3.pkl
2025-10-28 14:52:23,217 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-28 14:52:23,218 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=3)
2025-10-28 14:52:23,218 - src.models.predict - INFO - Loaded model for horizon 3 from local file
2025-10-28 14:52:23,218 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 14:52:23,232 - src.utils.mlflow_utils - INFO - Loading model version 22 from Production stage
2025-10-28 14:52:23,247 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 4: No such file or directory: '/mlflow/1/models/m-655b6237e91e43b4b97f9e450a582c7a/artifacts/.'
2025-10-28 14:52:23,248 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_4.pkl
2025-10-28 14:52:23,248 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_4.pkl
2025-10-28 14:52:23,251 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-28 14:52:23,251 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=4)
2025-10-28 14:52:23,251 - src.models.predict - INFO - Loaded model for horizon 4 from local file
2025-10-28 14:52:23,251 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 14:52:23,263 - src.utils.mlflow_utils - INFO - Loading model version 22 from Production stage
2025-10-28 14:52:23,279 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 5: No such file or directory: '/mlflow/1/models/m-7cdb49e93a654acf96da54a73b561763/artifacts/.'
2025-10-28 14:52:23,279 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_5.pkl
2025-10-28 14:52:23,279 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_5.pkl
2025-10-28 14:52:23,282 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-28 14:52:23,282 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=5)
2025-10-28 14:52:23,282 - src.models.predict - INFO - Loaded model for horizon 5 from local file
2025-10-28 14:52:23,282 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 14:52:23,295 - src.utils.mlflow_utils - INFO - Loading model version 22 from Production stage
2025-10-28 14:52:23,311 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 6: No such file or directory: '/mlflow/1/models/m-a99b84e8d2024a1d881aae05ccd8aa09/artifacts/.'
2025-10-28 14:52:23,311 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_6.pkl
2025-10-28 14:52:23,311 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_6.pkl
2025-10-28 14:52:23,315 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-28 14:52:23,315 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=6)
2025-10-28 14:52:23,315 - src.models.predict - INFO - Loaded model for horizon 6 from local file
2025-10-28 14:52:23,316 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 14:52:23,328 - src.utils.mlflow_utils - INFO - Loading model version 22 from Production stage
2025-10-28 14:52:23,343 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 7: No such file or directory: '/mlflow/1/models/m-5b81a930e36446ed9941d766ae2f66fd/artifacts/.'
2025-10-28 14:52:23,344 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_7.pkl
2025-10-28 14:52:23,344 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_7.pkl
2025-10-28 14:52:23,350 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-28 14:52:23,350 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=7)
2025-10-28 14:52:23,350 - src.models.predict - INFO - Loaded model for horizon 7 from local file
2025-10-28 14:52:23,350 - src.models.predict - WARNING - Used local file fallback for model loading (running in local/test mode)
2025-10-28 14:52:23,350 - __main__ - INFO - Loaded 7 production models
2025-10-28 14:52:23,350 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:23,350 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 14:52:23,350 - __main__ - INFO - ======================================================================
2025-10-28 14:52:23,351 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 14:52:23,351 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 14:52:23,355 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 14:52:23,356 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 14:52:23,356 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 14:52:23,356 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 14:52:23,356 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 14:52:23,356 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:23,356 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 14:52:23,357 - __main__ - INFO - ======================================================================
2025-10-28 14:52:23,357 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 14:52:23,357 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 14:52:23,357 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 14:52:23,357 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 14:52:23,375 - src.models.predict - INFO - Generated 7 predictions
2025-10-28 14:52:23,375 - src.models.predict - INFO - Prediction range: 53.7 to 68.7 patients
2025-10-28 14:52:23,377 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-28 14:52:23,377 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-28 14:52:23,377 - __main__ - INFO -    Prediction range: 53.7 to 68.7 patients
2025-10-28 14:52:23,377 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:23,377 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-28 14:52:23,377 - __main__ - INFO - ======================================================================
2025-10-28 14:52:23,377 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-28 14:52:23,380 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251028_145223.csv
2025-10-28 14:52:23,380 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-28 14:52:23,380 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251028_145223.csv
2025-10-28 14:52:23,380 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:23,381 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-28 14:52:23,381 - __main__ - INFO - ======================================================================
2025-10-28 14:52:23,381 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-28 14:52:23,519 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 21e8713c1706464cb3964c6d754ef2a3
2025-10-28 14:52:23,531 - __main__ - INFO - Logged to MLflow run: 21e8713c1706464cb3964c6d754ef2a3
2025-10-28 14:52:23,532 - __main__ - INFO - 
======================================================================
2025-10-28 14:52:23,532 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-28 14:52:23,532 - __main__ - INFO - ======================================================================
2025-10-28 14:52:23,532 - __main__ - INFO - Average prediction: 63.1 patients
2025-10-28 14:52:23,532 - __main__ - INFO - Average interval width: 38.61169731138222
2025-10-28 14:52:23,532 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-28 14:52:23,533 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-28 15:12:47,546 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 15:12:47,546 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 15:12:47,546 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 15:12:47,547 - __main__ - INFO - ======================================================================
2025-10-28 15:12:47,547 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 15:12:47,547 - __main__ - INFO - ======================================================================
2025-10-28 15:12:47,547 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 15:12:47,547 - __main__ - INFO - Output path: data/predictions/
2025-10-28 15:12:47,547 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:47,547 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 15:12:47,548 - __main__ - INFO - ======================================================================
2025-10-28 15:12:47,548 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 15:12:48,029 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 15:12:48,029 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 15:12:48,077 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 15:12:48,084 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 15:12:48,086 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 15:12:48,112 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 15:12:48,112 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 15:12:48,112 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 15:12:48,113 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 15:12:48,113 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 15:12:48,115 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 15:12:48,119 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 15:12:48,121 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 15:12:48,122 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 15:12:48,122 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 15:12:48,122 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:48,122 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 15:12:48,123 - __main__ - INFO - ======================================================================
2025-10-28 15:12:48,123 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 15:12:48,123 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 15:12:48,386 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 15:12:48,388 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 15:12:48,391 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 15:12:48,392 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 15:12:48,394 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 15:12:48,395 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 15:12:48,395 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:48,395 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 15:12:48,395 - __main__ - INFO - ======================================================================
2025-10-28 15:12:48,395 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 15:12:48,396 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 15:12:48,402 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 15:12:48,402 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 15:12:48,404 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 15:12:48,404 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 15:12:48,406 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 15:12:48,407 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 15:12:48,413 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 15:12:48,413 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 15:12:48,415 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 15:12:48,415 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 15:12:48,417 - src.data.feature_engineering - INFO - Added change features
2025-10-28 15:12:48,418 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 15:12:48,418 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 15:12:48,418 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 15:12:48,419 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 15:12:48,420 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 15:12:48,422 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 15:12:48,423 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 15:12:48,424 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 15:12:48,424 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:48,425 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 15:12:48,425 - __main__ - INFO - ======================================================================
2025-10-28 15:12:48,426 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 15:12:48,427 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 15:12:48,691 - src.utils.mlflow_utils - INFO - Loading model version 26 from Production stage
2025-10-28 15:12:49,234 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 1: No such file or directory: '/mlflow/1/models/m-90af0f45e6c94733b44e9f1ecc57de6e/artifacts/.'
2025-10-28 15:12:49,234 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_1.pkl
2025-10-28 15:12:49,234 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_1.pkl
2025-10-28 15:12:49,238 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-28 15:12:49,238 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=1)
2025-10-28 15:12:49,238 - src.models.predict - INFO - Loaded model for horizon 1 from local file
2025-10-28 15:12:49,238 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 15:12:49,254 - src.utils.mlflow_utils - INFO - Loading model version 24 from Production stage
2025-10-28 15:12:49,277 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 2: No such file or directory: '/mlflow/1/models/m-8740f73db3d24369b46fa806482f8f5d/artifacts/.'
2025-10-28 15:12:49,277 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_2.pkl
2025-10-28 15:12:49,277 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_2.pkl
2025-10-28 15:12:49,282 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-28 15:12:49,282 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=2)
2025-10-28 15:12:49,282 - src.models.predict - INFO - Loaded model for horizon 2 from local file
2025-10-28 15:12:49,282 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 15:12:49,297 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:12:49,314 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 3: No such file or directory: '/mlflow/1/models/m-5c2a3da18da84216938e13e12e287067/artifacts/.'
2025-10-28 15:12:49,314 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_3.pkl
2025-10-28 15:12:49,314 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_3.pkl
2025-10-28 15:12:49,318 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-28 15:12:49,318 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=3)
2025-10-28 15:12:49,318 - src.models.predict - INFO - Loaded model for horizon 3 from local file
2025-10-28 15:12:49,319 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 15:12:49,333 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:12:49,351 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 4: No such file or directory: '/mlflow/1/models/m-9d94506a2fc54172823668113a754f91/artifacts/.'
2025-10-28 15:12:49,351 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_4.pkl
2025-10-28 15:12:49,352 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_4.pkl
2025-10-28 15:12:49,355 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-28 15:12:49,355 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=4)
2025-10-28 15:12:49,355 - src.models.predict - INFO - Loaded model for horizon 4 from local file
2025-10-28 15:12:49,355 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 15:12:49,368 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:12:49,388 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 5: No such file or directory: '/mlflow/1/models/m-82c5e80b01964e56ac770efb5215f9b5/artifacts/.'
2025-10-28 15:12:49,388 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_5.pkl
2025-10-28 15:12:49,388 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_5.pkl
2025-10-28 15:12:49,391 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-28 15:12:49,392 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=5)
2025-10-28 15:12:49,392 - src.models.predict - INFO - Loaded model for horizon 5 from local file
2025-10-28 15:12:49,392 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 15:12:49,404 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:12:49,420 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 6: No such file or directory: '/mlflow/1/models/m-1db6723931c047cbbfffd3b2966d524a/artifacts/.'
2025-10-28 15:12:49,421 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_6.pkl
2025-10-28 15:12:49,421 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_6.pkl
2025-10-28 15:12:49,425 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-28 15:12:49,425 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=6)
2025-10-28 15:12:49,425 - src.models.predict - INFO - Loaded model for horizon 6 from local file
2025-10-28 15:12:49,425 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 15:12:49,441 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:12:49,457 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 7: No such file or directory: '/mlflow/1/models/m-ea400bf4e67541d88377d53273b86e14/artifacts/.'
2025-10-28 15:12:49,457 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_7.pkl
2025-10-28 15:12:49,457 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_7.pkl
2025-10-28 15:12:49,463 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-28 15:12:49,463 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=7)
2025-10-28 15:12:49,464 - src.models.predict - INFO - Loaded model for horizon 7 from local file
2025-10-28 15:12:49,464 - src.models.predict - WARNING - Used local file fallback for model loading (running in local/test mode)
2025-10-28 15:12:49,464 - __main__ - INFO - Loaded 7 production models
2025-10-28 15:12:49,464 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:49,464 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 15:12:49,464 - __main__ - INFO - ======================================================================
2025-10-28 15:12:49,464 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 15:12:49,465 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 15:12:49,471 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 15:12:49,472 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 15:12:49,472 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 15:12:49,472 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:12:49,472 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 15:12:49,472 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:49,472 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 15:12:49,473 - __main__ - INFO - ======================================================================
2025-10-28 15:12:49,473 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 15:12:49,473 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 15:12:49,473 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:12:49,473 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 15:12:49,496 - src.models.predict - INFO - Generated 7 predictions
2025-10-28 15:12:49,496 - src.models.predict - INFO - Prediction range: 53.7 to 68.7 patients
2025-10-28 15:12:49,498 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-28 15:12:49,499 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-28 15:12:49,499 - __main__ - INFO -    Prediction range: 53.7 to 68.7 patients
2025-10-28 15:12:49,499 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:49,499 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-28 15:12:49,499 - __main__ - INFO - ======================================================================
2025-10-28 15:12:49,500 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-28 15:12:49,504 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251028_151249.csv
2025-10-28 15:12:49,504 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-28 15:12:49,505 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251028_151249.csv
2025-10-28 15:12:49,505 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:49,505 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-28 15:12:49,506 - __main__ - INFO - ======================================================================
2025-10-28 15:12:49,506 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-28 15:12:49,660 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 71fb5736781f49b2a2e204a2f10600b0
2025-10-28 15:12:49,676 - __main__ - INFO - Logged to MLflow run: 71fb5736781f49b2a2e204a2f10600b0
2025-10-28 15:12:49,677 - __main__ - INFO - 
======================================================================
2025-10-28 15:12:49,677 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-28 15:12:49,677 - __main__ - INFO - ======================================================================
2025-10-28 15:12:49,678 - __main__ - INFO - Average prediction: 63.1 patients
2025-10-28 15:12:49,678 - __main__ - INFO - Average interval width: 38.61169731138222
2025-10-28 15:12:49,678 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-28 15:12:49,679 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-28 15:25:23,781 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 15:25:23,781 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 15:25:23,781 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 15:25:23,781 - __main__ - INFO - ======================================================================
2025-10-28 15:25:23,782 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 15:25:23,782 - __main__ - INFO - ======================================================================
2025-10-28 15:25:23,782 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 15:25:23,782 - __main__ - INFO - Output path: data/predictions/
2025-10-28 15:25:23,782 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:23,782 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 15:25:23,782 - __main__ - INFO - ======================================================================
2025-10-28 15:25:23,783 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 15:25:24,280 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 15:25:24,280 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 15:25:24,331 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 15:25:24,338 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 15:25:24,341 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 15:25:24,367 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 15:25:24,368 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 15:25:24,368 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 15:25:24,368 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 15:25:24,368 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 15:25:24,370 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 15:25:24,375 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 15:25:24,378 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 15:25:24,379 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 15:25:24,379 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 15:25:24,379 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:24,379 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 15:25:24,379 - __main__ - INFO - ======================================================================
2025-10-28 15:25:24,380 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 15:25:24,380 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 15:25:24,670 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 15:25:24,672 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 15:25:24,676 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 15:25:24,676 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 15:25:24,679 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 15:25:24,679 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 15:25:24,680 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:24,680 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 15:25:24,680 - __main__ - INFO - ======================================================================
2025-10-28 15:25:24,681 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 15:25:24,681 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 15:25:24,691 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 15:25:24,691 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 15:25:24,693 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 15:25:24,694 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 15:25:24,697 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 15:25:24,697 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 15:25:24,705 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 15:25:24,705 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 15:25:24,707 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 15:25:24,707 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 15:25:24,709 - src.data.feature_engineering - INFO - Added change features
2025-10-28 15:25:24,709 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 15:25:24,709 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 15:25:24,710 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 15:25:24,711 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 15:25:24,713 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 15:25:24,714 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 15:25:24,715 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 15:25:24,715 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 15:25:24,715 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:24,715 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 15:25:24,716 - __main__ - INFO - ======================================================================
2025-10-28 15:25:24,716 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 15:25:24,716 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 15:25:24,877 - src.utils.mlflow_utils - INFO - Loading model version 26 from Production stage
2025-10-28 15:25:25,171 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 1: No such file or directory: '/mlflow/1/models/m-90af0f45e6c94733b44e9f1ecc57de6e/artifacts/.'
2025-10-28 15:25:25,172 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_1.pkl
2025-10-28 15:25:25,172 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_1.pkl
2025-10-28 15:25:25,177 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-28 15:25:25,177 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=1)
2025-10-28 15:25:25,177 - src.models.predict - INFO - Loaded model for horizon 1 from local file
2025-10-28 15:25:25,178 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 15:25:25,195 - src.utils.mlflow_utils - INFO - Loading model version 24 from Production stage
2025-10-28 15:25:25,218 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 2: No such file or directory: '/mlflow/1/models/m-8740f73db3d24369b46fa806482f8f5d/artifacts/.'
2025-10-28 15:25:25,218 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_2.pkl
2025-10-28 15:25:25,218 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_2.pkl
2025-10-28 15:25:25,224 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-28 15:25:25,224 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=2)
2025-10-28 15:25:25,224 - src.models.predict - INFO - Loaded model for horizon 2 from local file
2025-10-28 15:25:25,224 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 15:25:25,239 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:25:25,265 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 3: No such file or directory: '/mlflow/1/models/m-5c2a3da18da84216938e13e12e287067/artifacts/.'
2025-10-28 15:25:25,266 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_3.pkl
2025-10-28 15:25:25,266 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_3.pkl
2025-10-28 15:25:25,272 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-28 15:25:25,272 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=3)
2025-10-28 15:25:25,273 - src.models.predict - INFO - Loaded model for horizon 3 from local file
2025-10-28 15:25:25,273 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 15:25:25,287 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:25:25,316 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 4: No such file or directory: '/mlflow/1/models/m-9d94506a2fc54172823668113a754f91/artifacts/.'
2025-10-28 15:25:25,316 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_4.pkl
2025-10-28 15:25:25,317 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_4.pkl
2025-10-28 15:25:25,322 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-28 15:25:25,322 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=4)
2025-10-28 15:25:25,322 - src.models.predict - INFO - Loaded model for horizon 4 from local file
2025-10-28 15:25:25,322 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 15:25:25,343 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:25:25,365 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 5: No such file or directory: '/mlflow/1/models/m-82c5e80b01964e56ac770efb5215f9b5/artifacts/.'
2025-10-28 15:25:25,366 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_5.pkl
2025-10-28 15:25:25,366 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_5.pkl
2025-10-28 15:25:25,371 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-28 15:25:25,371 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=5)
2025-10-28 15:25:25,371 - src.models.predict - INFO - Loaded model for horizon 5 from local file
2025-10-28 15:25:25,371 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 15:25:25,385 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:25:25,402 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 6: No such file or directory: '/mlflow/1/models/m-1db6723931c047cbbfffd3b2966d524a/artifacts/.'
2025-10-28 15:25:25,402 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_6.pkl
2025-10-28 15:25:25,402 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_6.pkl
2025-10-28 15:25:25,407 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-28 15:25:25,407 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=6)
2025-10-28 15:25:25,407 - src.models.predict - INFO - Loaded model for horizon 6 from local file
2025-10-28 15:25:25,407 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 15:25:25,420 - src.utils.mlflow_utils - INFO - Loading model version 23 from Production stage
2025-10-28 15:25:25,438 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 7: No such file or directory: '/mlflow/1/models/m-ea400bf4e67541d88377d53273b86e14/artifacts/.'
2025-10-28 15:25:25,438 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_7.pkl
2025-10-28 15:25:25,439 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_7.pkl
2025-10-28 15:25:25,445 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-28 15:25:25,445 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=7)
2025-10-28 15:25:25,445 - src.models.predict - INFO - Loaded model for horizon 7 from local file
2025-10-28 15:25:25,446 - src.models.predict - WARNING - Used local file fallback for model loading (running in local/test mode)
2025-10-28 15:25:25,446 - __main__ - INFO - Loaded 7 production models
2025-10-28 15:25:25,446 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:25,446 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 15:25:25,446 - __main__ - INFO - ======================================================================
2025-10-28 15:25:25,446 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 15:25:25,446 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 15:25:25,451 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 15:25:25,451 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 15:25:25,451 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 15:25:25,451 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:25:25,452 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 15:25:25,452 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:25,452 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 15:25:25,452 - __main__ - INFO - ======================================================================
2025-10-28 15:25:25,452 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 15:25:25,452 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 15:25:25,452 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:25:25,452 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 15:25:25,472 - src.models.predict - INFO - Generated 7 predictions
2025-10-28 15:25:25,472 - src.models.predict - INFO - Prediction range: 53.7 to 68.7 patients
2025-10-28 15:25:25,473 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-28 15:25:25,474 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-28 15:25:25,474 - __main__ - INFO -    Prediction range: 53.7 to 68.7 patients
2025-10-28 15:25:25,474 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:25,474 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-28 15:25:25,474 - __main__ - INFO - ======================================================================
2025-10-28 15:25:25,474 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-28 15:25:25,477 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251028_152525.csv
2025-10-28 15:25:25,477 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-28 15:25:25,477 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251028_152525.csv
2025-10-28 15:25:25,477 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:25,478 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-28 15:25:25,478 - __main__ - INFO - ======================================================================
2025-10-28 15:25:25,478 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-28 15:25:25,632 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: ceb279e48818433e86b4ff8e7eb7aa6f
2025-10-28 15:25:25,644 - __main__ - INFO - Logged to MLflow run: ceb279e48818433e86b4ff8e7eb7aa6f
2025-10-28 15:25:25,645 - __main__ - INFO - 
======================================================================
2025-10-28 15:25:25,645 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-28 15:25:25,645 - __main__ - INFO - ======================================================================
2025-10-28 15:25:25,645 - __main__ - INFO - Average prediction: 63.1 patients
2025-10-28 15:25:25,646 - __main__ - INFO - Average interval width: 38.61169731138222
2025-10-28 15:25:25,646 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-28 15:25:25,647 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-28 15:53:33,488 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 15:53:33,488 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 15:53:33,488 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 15:53:33,488 - __main__ - INFO - ======================================================================
2025-10-28 15:53:33,489 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 15:53:33,489 - __main__ - INFO - ======================================================================
2025-10-28 15:53:33,489 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 15:53:33,489 - __main__ - INFO - Output path: data/predictions/
2025-10-28 15:53:33,489 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:33,489 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 15:53:33,489 - __main__ - INFO - ======================================================================
2025-10-28 15:53:33,489 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 15:53:33,934 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 15:53:33,934 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 15:53:33,980 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 15:53:33,986 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 15:53:33,987 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 15:53:34,011 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 15:53:34,011 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 15:53:34,011 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 15:53:34,012 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 15:53:34,012 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 15:53:34,014 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 15:53:34,016 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 15:53:34,018 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 15:53:34,018 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 15:53:34,019 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 15:53:34,019 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:34,019 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 15:53:34,019 - __main__ - INFO - ======================================================================
2025-10-28 15:53:34,019 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 15:53:34,019 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 15:53:34,757 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 15:53:34,759 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 15:53:34,763 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 15:53:34,763 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 15:53:34,765 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 15:53:34,765 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 15:53:34,765 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:34,765 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 15:53:34,765 - __main__ - INFO - ======================================================================
2025-10-28 15:53:34,766 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 15:53:34,766 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 15:53:34,771 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 15:53:34,771 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 15:53:34,773 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 15:53:34,773 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 15:53:34,776 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 15:53:34,776 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 15:53:34,782 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 15:53:34,782 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 15:53:34,786 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 15:53:34,786 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 15:53:34,787 - src.data.feature_engineering - INFO - Added change features
2025-10-28 15:53:34,787 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 15:53:34,787 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 15:53:34,788 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 15:53:34,789 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 15:53:34,790 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 15:53:34,792 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 15:53:34,792 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 15:53:34,792 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 15:53:34,792 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:34,792 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 15:53:34,792 - __main__ - INFO - ======================================================================
2025-10-28 15:53:34,793 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 15:53:34,793 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 15:53:34,853 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-28 15:53:35,182 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-28 15:53:35,673 - src.utils.mlflow_utils - ERROR - Failed to load production model: Model does not have the "python_function" flavor
2025-10-28 15:53:35,673 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 1: Model does not have the "python_function" flavor
2025-10-28 15:53:35,673 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_1.pkl
2025-10-28 15:53:35,673 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_1.pkl
2025-10-28 15:53:35,678 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-28 15:53:35,678 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=1)
2025-10-28 15:53:35,678 - src.models.predict - INFO - Loaded model for horizon 1 from local file
2025-10-28 15:53:35,678 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 15:53:35,693 - src.utils.mlflow_utils - INFO - Loading model version 30 from Production stage
2025-10-28 15:53:35,768 - src.utils.mlflow_utils - ERROR - Failed to load production model: Model does not have the "python_function" flavor
2025-10-28 15:53:35,769 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 2: Model does not have the "python_function" flavor
2025-10-28 15:53:35,770 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_2.pkl
2025-10-28 15:53:35,770 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_2.pkl
2025-10-28 15:53:35,775 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-28 15:53:35,775 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=2)
2025-10-28 15:53:35,775 - src.models.predict - INFO - Loaded model for horizon 2 from local file
2025-10-28 15:53:35,776 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 15:53:35,790 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:53:35,858 - src.utils.mlflow_utils - ERROR - Failed to load production model: Model does not have the "python_function" flavor
2025-10-28 15:53:35,858 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 3: Model does not have the "python_function" flavor
2025-10-28 15:53:35,858 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_3.pkl
2025-10-28 15:53:35,858 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_3.pkl
2025-10-28 15:53:35,862 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-28 15:53:35,863 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=3)
2025-10-28 15:53:35,863 - src.models.predict - INFO - Loaded model for horizon 3 from local file
2025-10-28 15:53:35,863 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 15:53:35,879 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:53:35,945 - src.utils.mlflow_utils - ERROR - Failed to load production model: Model does not have the "python_function" flavor
2025-10-28 15:53:35,945 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 4: Model does not have the "python_function" flavor
2025-10-28 15:53:35,946 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_4.pkl
2025-10-28 15:53:35,946 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_4.pkl
2025-10-28 15:53:35,949 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-28 15:53:35,949 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=4)
2025-10-28 15:53:35,950 - src.models.predict - INFO - Loaded model for horizon 4 from local file
2025-10-28 15:53:35,950 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 15:53:35,965 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:53:36,105 - src.utils.mlflow_utils - ERROR - Failed to load production model: Model does not have the "python_function" flavor
2025-10-28 15:53:36,105 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 5: Model does not have the "python_function" flavor
2025-10-28 15:53:36,105 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_5.pkl
2025-10-28 15:53:36,106 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_5.pkl
2025-10-28 15:53:36,109 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-28 15:53:36,109 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=5)
2025-10-28 15:53:36,109 - src.models.predict - INFO - Loaded model for horizon 5 from local file
2025-10-28 15:53:36,109 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 15:53:36,124 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:53:36,185 - src.utils.mlflow_utils - ERROR - Failed to load production model: Model does not have the "python_function" flavor
2025-10-28 15:53:36,185 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 6: Model does not have the "python_function" flavor
2025-10-28 15:53:36,185 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_6.pkl
2025-10-28 15:53:36,185 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_6.pkl
2025-10-28 15:53:36,189 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-28 15:53:36,189 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=6)
2025-10-28 15:53:36,189 - src.models.predict - INFO - Loaded model for horizon 6 from local file
2025-10-28 15:53:36,189 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 15:53:36,203 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:53:36,271 - src.utils.mlflow_utils - ERROR - Failed to load production model: Model does not have the "python_function" flavor
2025-10-28 15:53:36,271 - src.models.predict - WARNING - Failed to load model from MLflow for horizon 7: Model does not have the "python_function" flavor
2025-10-28 15:53:36,271 - src.models.predict - INFO - Falling back to local model file: models/forecaster_horizon_7.pkl
2025-10-28 15:53:36,272 - src.models.lightgbm_model - INFO - Loading model from: models/forecaster_horizon_7.pkl
2025-10-28 15:53:36,279 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-28 15:53:36,280 - src.models.lightgbm_model - INFO - Model loaded successfully (horizon=7)
2025-10-28 15:53:36,280 - src.models.predict - INFO - Loaded model for horizon 7 from local file
2025-10-28 15:53:36,280 - src.models.predict - WARNING - Used local file fallback for model loading (running in local/test mode)
2025-10-28 15:53:36,280 - __main__ - INFO - Loaded 7 production models
2025-10-28 15:53:36,280 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:36,280 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 15:53:36,280 - __main__ - INFO - ======================================================================
2025-10-28 15:53:36,281 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 15:53:36,281 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 15:53:36,286 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 15:53:36,286 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 15:53:36,286 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 15:53:36,286 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:53:36,287 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 15:53:36,287 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:36,287 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 15:53:36,287 - __main__ - INFO - ======================================================================
2025-10-28 15:53:36,287 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 15:53:36,287 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 15:53:36,287 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:53:36,287 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 15:53:36,306 - src.models.predict - INFO - Generated 7 predictions
2025-10-28 15:53:36,307 - src.models.predict - INFO - Prediction range: 53.7 to 68.7 patients
2025-10-28 15:53:36,308 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-28 15:53:36,308 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-28 15:53:36,308 - __main__ - INFO -    Prediction range: 53.7 to 68.7 patients
2025-10-28 15:53:36,308 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:36,308 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-28 15:53:36,309 - __main__ - INFO - ======================================================================
2025-10-28 15:53:36,309 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-28 15:53:36,312 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251028_155336.csv
2025-10-28 15:53:36,312 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-28 15:53:36,312 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251028_155336.csv
2025-10-28 15:53:36,312 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:36,312 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-28 15:53:36,312 - __main__ - INFO - ======================================================================
2025-10-28 15:53:36,313 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-28 15:53:36,459 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 9c0413777c0b44e28def42ee9a65fc94
2025-10-28 15:53:36,472 - __main__ - INFO - Logged to MLflow run: 9c0413777c0b44e28def42ee9a65fc94
2025-10-28 15:53:36,472 - __main__ - INFO - 
======================================================================
2025-10-28 15:53:36,473 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-28 15:53:36,473 - __main__ - INFO - ======================================================================
2025-10-28 15:53:36,473 - __main__ - INFO - Average prediction: 63.1 patients
2025-10-28 15:53:36,473 - __main__ - INFO - Average interval width: 38.61169731138222
2025-10-28 15:53:36,473 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-28 15:53:36,474 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-28 15:55:20,047 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 15:55:20,048 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 15:55:20,048 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 15:55:20,048 - __main__ - INFO - ======================================================================
2025-10-28 15:55:20,048 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 15:55:20,048 - __main__ - INFO - ======================================================================
2025-10-28 15:55:20,048 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 15:55:20,049 - __main__ - INFO - Output path: data/predictions/
2025-10-28 15:55:20,049 - __main__ - INFO - 
======================================================================
2025-10-28 15:55:20,049 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 15:55:20,049 - __main__ - INFO - ======================================================================
2025-10-28 15:55:20,049 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 15:55:20,530 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 15:55:20,530 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 15:55:20,578 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 15:55:20,584 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 15:55:20,586 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 15:55:20,610 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 15:55:20,610 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 15:55:20,611 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 15:55:20,611 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 15:55:20,611 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 15:55:20,613 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 15:55:20,617 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 15:55:20,618 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 15:55:20,619 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 15:55:20,619 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 15:55:20,619 - __main__ - INFO - 
======================================================================
2025-10-28 15:55:20,619 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 15:55:20,619 - __main__ - INFO - ======================================================================
2025-10-28 15:55:20,620 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 15:55:20,620 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 15:55:21,018 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 15:55:21,020 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 15:55:21,023 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 15:55:21,024 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 15:55:21,026 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 15:55:21,026 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 15:55:21,026 - __main__ - INFO - 
======================================================================
2025-10-28 15:55:21,026 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 15:55:21,026 - __main__ - INFO - ======================================================================
2025-10-28 15:55:21,027 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 15:55:21,027 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 15:55:21,032 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 15:55:21,033 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 15:55:21,036 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 15:55:21,036 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 15:55:21,038 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 15:55:21,038 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 15:55:21,045 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 15:55:21,045 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 15:55:21,049 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 15:55:21,049 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 15:55:21,051 - src.data.feature_engineering - INFO - Added change features
2025-10-28 15:55:21,051 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 15:55:21,051 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 15:55:21,051 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 15:55:21,052 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 15:55:21,053 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 15:55:21,056 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 15:55:21,056 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 15:55:21,056 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 15:55:21,056 - __main__ - INFO - 
======================================================================
2025-10-28 15:55:21,057 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 15:55:21,057 - __main__ - INFO - ======================================================================
2025-10-28 15:55:21,057 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 15:55:21,057 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 15:55:21,127 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-28 15:55:21,530 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-28 15:55:21,843 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v32
2025-10-28 15:55:21,843 - src.models.predict - INFO - Loaded model for horizon 1
2025-10-28 15:55:21,843 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 15:55:21,879 - src.utils.mlflow_utils - INFO - Loading model version 30 from Production stage
2025-10-28 15:55:21,947 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v30
2025-10-28 15:55:21,947 - src.models.predict - INFO - Loaded model for horizon 2
2025-10-28 15:55:21,947 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 15:55:21,961 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:55:22,005 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v29
2025-10-28 15:55:22,006 - src.models.predict - INFO - Loaded model for horizon 3
2025-10-28 15:55:22,006 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 15:55:22,018 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:55:22,061 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v29
2025-10-28 15:55:22,062 - src.models.predict - INFO - Loaded model for horizon 4
2025-10-28 15:55:22,062 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 15:55:22,074 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:55:22,119 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v29
2025-10-28 15:55:22,119 - src.models.predict - INFO - Loaded model for horizon 5
2025-10-28 15:55:22,119 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 15:55:22,131 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:55:22,177 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v29
2025-10-28 15:55:22,177 - src.models.predict - INFO - Loaded model for horizon 6
2025-10-28 15:55:22,177 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 15:55:22,189 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 15:55:22,239 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v29
2025-10-28 15:55:22,239 - src.models.predict - INFO - Loaded model for horizon 7
2025-10-28 15:55:22,239 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-10-28 15:55:22,239 - __main__ - INFO - Loaded 7 production models
2025-10-28 15:55:22,239 - __main__ - INFO - 
======================================================================
2025-10-28 15:55:22,239 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 15:55:22,239 - __main__ - INFO - ======================================================================
2025-10-28 15:55:22,240 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 15:55:22,240 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 15:55:22,245 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 15:55:22,245 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 15:55:22,245 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 15:55:22,245 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:55:22,245 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 15:55:22,246 - __main__ - INFO - 
======================================================================
2025-10-28 15:55:22,246 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 15:55:22,246 - __main__ - INFO - ======================================================================
2025-10-28 15:55:22,246 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 15:55:22,246 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 15:55:22,246 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 15:55:22,246 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 15:55:22,247 - __main__ - ERROR - Prediction flow failed: 'dict' object has no attribute 'predict'
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 194, in prediction_flow
    predictions = generate_predictions(
                  ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/models/predict.py", line 230, in generate_predictions
    pred = model.predict(X, return_intervals=True)
           ^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'predict'
2025-10-28 15:55:22,247 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-10-28 16:00:47,848 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 16:00:47,848 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 16:00:47,849 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 16:00:47,849 - __main__ - INFO - ======================================================================
2025-10-28 16:00:47,849 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 16:00:47,849 - __main__ - INFO - ======================================================================
2025-10-28 16:00:47,850 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 16:00:47,850 - __main__ - INFO - Output path: data/predictions/
2025-10-28 16:00:47,850 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:47,850 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 16:00:47,850 - __main__ - INFO - ======================================================================
2025-10-28 16:00:47,851 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 16:00:48,457 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 16:00:48,458 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 16:00:48,520 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 16:00:48,530 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 16:00:48,533 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 16:00:48,560 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 16:00:48,560 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 16:00:48,561 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 16:00:48,561 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 16:00:48,561 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 16:00:48,563 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 16:00:48,568 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 16:00:48,570 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 16:00:48,570 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 16:00:48,570 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 16:00:48,570 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:48,570 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 16:00:48,571 - __main__ - INFO - ======================================================================
2025-10-28 16:00:48,571 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 16:00:48,571 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 16:00:48,843 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 16:00:48,846 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 16:00:48,851 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 16:00:48,851 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 16:00:48,854 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 16:00:48,855 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 16:00:48,855 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:48,855 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 16:00:48,856 - __main__ - INFO - ======================================================================
2025-10-28 16:00:48,856 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 16:00:48,856 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 16:00:48,863 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 16:00:48,864 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 16:00:48,866 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 16:00:48,866 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 16:00:48,869 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 16:00:48,869 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 16:00:48,877 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 16:00:48,878 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 16:00:48,880 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 16:00:48,881 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 16:00:48,883 - src.data.feature_engineering - INFO - Added change features
2025-10-28 16:00:48,883 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 16:00:48,884 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 16:00:48,884 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 16:00:48,885 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 16:00:48,886 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 16:00:48,887 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 16:00:48,888 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 16:00:48,888 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 16:00:48,888 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:48,888 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 16:00:48,888 - __main__ - INFO - ======================================================================
2025-10-28 16:00:48,888 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 16:00:48,889 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 16:00:49,673 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-28 16:00:50,036 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-28 16:00:50,422 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-28 16:00:50,422 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v32
2025-10-28 16:00:50,422 - src.models.predict - INFO - Loaded model for horizon 1
2025-10-28 16:00:50,423 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 16:00:50,440 - src.utils.mlflow_utils - INFO - Loading model version 30 from Production stage
2025-10-28 16:00:50,515 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-28 16:00:50,515 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v30
2025-10-28 16:00:50,515 - src.models.predict - INFO - Loaded model for horizon 2
2025-10-28 16:00:50,515 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 16:00:50,534 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:00:50,590 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-28 16:00:50,590 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v29
2025-10-28 16:00:50,590 - src.models.predict - INFO - Loaded model for horizon 3
2025-10-28 16:00:50,590 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 16:00:50,607 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:00:50,661 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-28 16:00:50,662 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v29
2025-10-28 16:00:50,662 - src.models.predict - INFO - Loaded model for horizon 4
2025-10-28 16:00:50,662 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 16:00:50,679 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:00:50,750 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-28 16:00:50,751 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v29
2025-10-28 16:00:50,751 - src.models.predict - INFO - Loaded model for horizon 5
2025-10-28 16:00:50,751 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 16:00:50,769 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:00:50,835 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-28 16:00:50,836 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v29
2025-10-28 16:00:50,836 - src.models.predict - INFO - Loaded model for horizon 6
2025-10-28 16:00:50,836 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 16:00:50,849 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:00:50,911 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-28 16:00:50,911 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v29
2025-10-28 16:00:50,912 - src.models.predict - INFO - Loaded model for horizon 7
2025-10-28 16:00:50,912 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-10-28 16:00:50,912 - __main__ - INFO - Loaded 7 production models
2025-10-28 16:00:50,912 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:50,912 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 16:00:50,912 - __main__ - INFO - ======================================================================
2025-10-28 16:00:50,912 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 16:00:50,913 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 16:00:50,920 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 16:00:50,920 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 16:00:50,920 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 16:00:50,920 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 16:00:50,921 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 16:00:50,921 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:50,921 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 16:00:50,921 - __main__ - INFO - ======================================================================
2025-10-28 16:00:50,922 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 16:00:50,922 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 16:00:50,922 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 16:00:50,922 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 16:00:50,948 - src.models.predict - INFO - Generated 7 predictions
2025-10-28 16:00:50,949 - src.models.predict - INFO - Prediction range: 53.7 to 68.7 patients
2025-10-28 16:00:50,951 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.03s
2025-10-28 16:00:50,951 - __main__ - INFO - Generated 7 predictions in 0.03s
2025-10-28 16:00:50,952 - __main__ - INFO -    Prediction range: 53.7 to 68.7 patients
2025-10-28 16:00:50,952 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:50,952 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-28 16:00:50,952 - __main__ - INFO - ======================================================================
2025-10-28 16:00:50,952 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-28 16:00:50,960 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251028_160050.csv
2025-10-28 16:00:50,960 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-28 16:00:50,960 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251028_160050.csv
2025-10-28 16:00:50,961 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:50,961 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-28 16:00:50,961 - __main__ - INFO - ======================================================================
2025-10-28 16:00:50,961 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-28 16:00:51,678 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 352189a2a4064e5eba0e82f8bf90d543
2025-10-28 16:00:51,707 - __main__ - INFO - Logged to MLflow run: 352189a2a4064e5eba0e82f8bf90d543
2025-10-28 16:00:51,708 - __main__ - INFO - 
======================================================================
2025-10-28 16:00:51,708 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-28 16:00:51,709 - __main__ - INFO - ======================================================================
2025-10-28 16:00:51,709 - __main__ - INFO - Average prediction: 63.1 patients
2025-10-28 16:00:51,709 - __main__ - INFO - Average interval width: 38.61169731138222
2025-10-28 16:00:51,710 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-28 16:00:51,713 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-28 16:01:32,096 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 16:01:32,096 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 16:01:32,096 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 16:01:32,096 - __main__ - INFO - ======================================================================
2025-10-28 16:01:32,097 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 16:01:32,097 - __main__ - INFO - ======================================================================
2025-10-28 16:01:32,097 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 16:01:32,097 - __main__ - INFO - Output path: data/predictions/
2025-10-28 16:01:32,097 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:32,098 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 16:01:32,098 - __main__ - INFO - ======================================================================
2025-10-28 16:01:32,098 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 16:01:33,032 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 16:01:33,033 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 16:01:33,083 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 16:01:33,090 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 16:01:33,091 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 16:01:33,117 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 16:01:33,118 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 16:01:33,118 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 16:01:33,118 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 16:01:33,118 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 16:01:33,121 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 16:01:33,125 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 16:01:33,127 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 16:01:33,128 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 16:01:33,128 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 16:01:33,128 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:33,128 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 16:01:33,128 - __main__ - INFO - ======================================================================
2025-10-28 16:01:33,129 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 16:01:33,129 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 16:01:33,382 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 16:01:33,384 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 16:01:33,387 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 16:01:33,387 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 16:01:33,389 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 16:01:33,389 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 16:01:33,389 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:33,390 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 16:01:33,390 - __main__ - INFO - ======================================================================
2025-10-28 16:01:33,390 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 16:01:33,391 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 16:01:33,396 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 16:01:33,396 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 16:01:33,397 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 16:01:33,398 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 16:01:33,400 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 16:01:33,400 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 16:01:33,405 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 16:01:33,405 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 16:01:33,407 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 16:01:33,407 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 16:01:33,409 - src.data.feature_engineering - INFO - Added change features
2025-10-28 16:01:33,409 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 16:01:33,409 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 16:01:33,409 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 16:01:33,410 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 16:01:33,412 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 16:01:33,413 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 16:01:33,413 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 16:01:33,413 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 16:01:33,413 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:33,414 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 16:01:33,414 - __main__ - INFO - ======================================================================
2025-10-28 16:01:33,414 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 16:01:33,414 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 16:01:33,487 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-28 16:01:33,753 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-28 16:01:34,059 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-28 16:01:34,060 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v32
2025-10-28 16:01:34,060 - src.models.predict - INFO - Loaded model for horizon 1
2025-10-28 16:01:34,060 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 16:01:34,075 - src.utils.mlflow_utils - INFO - Loading model version 30 from Production stage
2025-10-28 16:01:34,133 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-28 16:01:34,133 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v30
2025-10-28 16:01:34,133 - src.models.predict - INFO - Loaded model for horizon 2
2025-10-28 16:01:34,133 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 16:01:34,151 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:01:34,196 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-28 16:01:34,196 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v29
2025-10-28 16:01:34,196 - src.models.predict - INFO - Loaded model for horizon 3
2025-10-28 16:01:34,196 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 16:01:34,210 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:01:34,253 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-28 16:01:34,253 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v29
2025-10-28 16:01:34,253 - src.models.predict - INFO - Loaded model for horizon 4
2025-10-28 16:01:34,253 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 16:01:34,266 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:01:34,314 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-28 16:01:34,315 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v29
2025-10-28 16:01:34,315 - src.models.predict - INFO - Loaded model for horizon 5
2025-10-28 16:01:34,315 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 16:01:34,338 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:01:34,392 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-28 16:01:34,392 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v29
2025-10-28 16:01:34,392 - src.models.predict - INFO - Loaded model for horizon 6
2025-10-28 16:01:34,393 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 16:01:34,407 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:01:34,462 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-28 16:01:34,463 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v29
2025-10-28 16:01:34,463 - src.models.predict - INFO - Loaded model for horizon 7
2025-10-28 16:01:34,463 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-10-28 16:01:34,463 - __main__ - INFO - Loaded 7 production models
2025-10-28 16:01:34,463 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:34,463 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 16:01:34,464 - __main__ - INFO - ======================================================================
2025-10-28 16:01:34,464 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 16:01:34,464 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 16:01:34,470 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 16:01:34,470 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 16:01:34,470 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 16:01:34,470 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 16:01:34,471 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 16:01:34,471 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:34,471 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 16:01:34,471 - __main__ - INFO - ======================================================================
2025-10-28 16:01:34,471 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 16:01:34,472 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 16:01:34,472 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 16:01:34,472 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 16:01:34,496 - src.models.predict - INFO - Generated 7 predictions
2025-10-28 16:01:34,496 - src.models.predict - INFO - Prediction range: 53.7 to 68.7 patients
2025-10-28 16:01:34,498 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.03s
2025-10-28 16:01:34,498 - __main__ - INFO - Generated 7 predictions in 0.03s
2025-10-28 16:01:34,498 - __main__ - INFO -    Prediction range: 53.7 to 68.7 patients
2025-10-28 16:01:34,498 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:34,498 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-28 16:01:34,498 - __main__ - INFO - ======================================================================
2025-10-28 16:01:34,498 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-28 16:01:34,503 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251028_160134.csv
2025-10-28 16:01:34,503 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-28 16:01:34,503 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251028_160134.csv
2025-10-28 16:01:34,503 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:34,503 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-28 16:01:34,503 - __main__ - INFO - ======================================================================
2025-10-28 16:01:34,503 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-28 16:01:34,784 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: c7c80990f49246c5bc02b1485fdd8a9c
2025-10-28 16:01:34,804 - __main__ - INFO - Logged to MLflow run: c7c80990f49246c5bc02b1485fdd8a9c
2025-10-28 16:01:34,805 - __main__ - INFO - 
======================================================================
2025-10-28 16:01:34,805 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-28 16:01:34,806 - __main__ - INFO - ======================================================================
2025-10-28 16:01:34,806 - __main__ - INFO - Average prediction: 63.1 patients
2025-10-28 16:01:34,806 - __main__ - INFO - Average interval width: 38.61169731138222
2025-10-28 16:01:34,806 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-28 16:01:34,808 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-28 16:03:24,346 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-28 16:03:24,347 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-28 16:03:24,347 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-28 16:03:24,347 - __main__ - INFO - ======================================================================
2025-10-28 16:03:24,347 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-28 16:03:24,347 - __main__ - INFO - ======================================================================
2025-10-28 16:03:24,347 - __main__ - INFO - Prediction base date: 2025-10-28
2025-10-28 16:03:24,347 - __main__ - INFO - Output path: data/predictions/
2025-10-28 16:03:24,348 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:24,348 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-28 16:03:24,348 - __main__ - INFO - ======================================================================
2025-10-28 16:03:24,348 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-28 16:03:24,852 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-28 16:03:24,853 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-28 16:03:24,905 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-28 16:03:24,914 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-28 16:03:24,917 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-28 16:03:24,942 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-28 16:03:24,942 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-28 16:03:24,943 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-28 16:03:24,943 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-28 16:03:24,943 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-28 16:03:24,945 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-28 16:03:24,948 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-28 16:03:24,951 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-28 16:03:24,951 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-28 16:03:24,952 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-28 16:03:24,952 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:24,952 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-28 16:03:24,952 - __main__ - INFO - ======================================================================
2025-10-28 16:03:24,952 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-28
2025-10-28 16:03:24,953 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-28 16:03:25,200 - src.data.weather_integration - INFO - Successfully fetched weather data: 1254 days
2025-10-28 16:03:25,203 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-28 16:03:25,208 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-28 16:03:25,208 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-28
2025-10-28 16:03:25,212 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-28 16:03:25,212 - __main__ - INFO - Weather data updated: 1254 days
2025-10-28 16:03:25,213 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:25,213 - __main__ - INFO - STEP 3: Engineering Features
2025-10-28 16:03:25,213 - __main__ - INFO - ======================================================================
2025-10-28 16:03:25,213 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-28 16:03:25,214 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-28 16:03:25,221 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-28 16:03:25,221 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-28 16:03:25,224 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-28 16:03:25,224 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-28 16:03:25,227 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-28 16:03:25,227 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-28 16:03:25,234 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-28 16:03:25,234 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-28 16:03:25,236 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-28 16:03:25,236 - src.data.feature_engineering - INFO - Adding change features
2025-10-28 16:03:25,237 - src.data.feature_engineering - INFO - Added change features
2025-10-28 16:03:25,237 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-28 16:03:25,238 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-28 16:03:25,238 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-28 16:03:25,239 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-28 16:03:25,240 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-28 16:03:25,241 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-28 16:03:25,242 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-28 16:03:25,242 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-28 16:03:25,242 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:25,242 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-28 16:03:25,242 - __main__ - INFO - ======================================================================
2025-10-28 16:03:25,242 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-28 16:03:25,242 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-28 16:03:25,310 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-28 16:03:25,515 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-28 16:03:25,781 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-28 16:03:25,782 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v32
2025-10-28 16:03:25,782 - src.models.predict - INFO - Loaded model for horizon 1
2025-10-28 16:03:25,782 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-28 16:03:25,797 - src.utils.mlflow_utils - INFO - Loading model version 30 from Production stage
2025-10-28 16:03:25,850 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-28 16:03:25,850 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v30
2025-10-28 16:03:25,850 - src.models.predict - INFO - Loaded model for horizon 2
2025-10-28 16:03:25,850 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-28 16:03:25,864 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:03:25,923 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-28 16:03:25,923 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v29
2025-10-28 16:03:25,923 - src.models.predict - INFO - Loaded model for horizon 3
2025-10-28 16:03:25,923 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-28 16:03:25,939 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:03:25,999 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-28 16:03:25,999 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v29
2025-10-28 16:03:26,000 - src.models.predict - INFO - Loaded model for horizon 4
2025-10-28 16:03:26,000 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-28 16:03:26,014 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:03:26,064 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-28 16:03:26,064 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v29
2025-10-28 16:03:26,065 - src.models.predict - INFO - Loaded model for horizon 5
2025-10-28 16:03:26,065 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-28 16:03:26,081 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:03:26,127 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-28 16:03:26,127 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v29
2025-10-28 16:03:26,127 - src.models.predict - INFO - Loaded model for horizon 6
2025-10-28 16:03:26,127 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-28 16:03:26,141 - src.utils.mlflow_utils - INFO - Loading model version 29 from Production stage
2025-10-28 16:03:26,194 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-28 16:03:26,194 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v29
2025-10-28 16:03:26,194 - src.models.predict - INFO - Loaded model for horizon 7
2025-10-28 16:03:26,195 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-10-28 16:03:26,195 - __main__ - INFO - Loaded 7 production models
2025-10-28 16:03:26,195 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:26,195 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-28 16:03:26,195 - __main__ - INFO - ======================================================================
2025-10-28 16:03:26,195 - src.models.predict - INFO - Preparing features for prediction
2025-10-28 16:03:26,195 - src.models.predict - INFO - Base date for predictions: 2025-10-28
2025-10-28 16:03:26,201 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-28 16:03:26,201 - src.models.predict - INFO - Prediction date range: 2025-10-29 to 2025-11-04
2025-10-28 16:03:26,201 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-28 16:03:26,201 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 16:03:26,201 - __main__ - INFO - Features prepared for next 7 days
2025-10-28 16:03:26,201 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:26,201 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-28 16:03:26,202 - __main__ - INFO - ======================================================================
2025-10-28 16:03:26,202 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-28 16:03:26,202 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-28 16:03:26,202 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-28 16:03:26,202 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-28 16:03:26,223 - src.models.predict - INFO - Generated 7 predictions
2025-10-28 16:03:26,223 - src.models.predict - INFO - Prediction range: 53.7 to 68.7 patients
2025-10-28 16:03:26,225 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-28 16:03:26,225 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-28 16:03:26,225 - __main__ - INFO -    Prediction range: 53.7 to 68.7 patients
2025-10-28 16:03:26,225 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:26,225 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-28 16:03:26,225 - __main__ - INFO - ======================================================================
2025-10-28 16:03:26,225 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-28 16:03:26,229 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251028_160326.csv
2025-10-28 16:03:26,229 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-28 16:03:26,229 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251028_160326.csv
2025-10-28 16:03:26,230 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:26,230 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-28 16:03:26,230 - __main__ - INFO - ======================================================================
2025-10-28 16:03:26,230 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-28 16:03:26,476 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: d87ff370c77d4666818bfe67116043f5
2025-10-28 16:03:26,490 - __main__ - INFO - Logged to MLflow run: d87ff370c77d4666818bfe67116043f5
2025-10-28 16:03:26,491 - __main__ - INFO - 
======================================================================
2025-10-28 16:03:26,491 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-28 16:03:26,491 - __main__ - INFO - ======================================================================
2025-10-28 16:03:26,491 - __main__ - INFO - Average prediction: 63.1 patients
2025-10-28 16:03:26,492 - __main__ - INFO - Average interval width: 38.61169731138222
2025-10-28 16:03:26,492 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-28 16:03:26,493 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-31 11:06:44,606 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-31 11:06:44,606 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-31 11:06:44,606 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-31 11:06:44,606 - __main__ - INFO - ======================================================================
2025-10-31 11:06:44,607 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-31 11:06:44,607 - __main__ - INFO - ======================================================================
2025-10-31 11:06:44,607 - __main__ - INFO - Prediction base date: 2025-10-31
2025-10-31 11:06:44,607 - __main__ - INFO - Output path: data/predictions/
2025-10-31 11:06:44,607 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:44,607 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-31 11:06:44,607 - __main__ - INFO - ======================================================================
2025-10-31 11:06:44,608 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-31 11:06:45,122 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-31 11:06:45,122 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-31 11:06:45,180 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-31 11:06:45,192 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-31 11:06:45,194 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-31 11:06:45,223 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-31 11:06:45,224 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-31 11:06:45,224 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-31 11:06:45,224 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-31 11:06:45,224 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-31 11:06:45,227 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-31 11:06:45,231 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-31 11:06:45,233 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-31 11:06:45,234 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-31 11:06:45,234 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-31 11:06:45,234 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:45,234 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-31 11:06:45,234 - __main__ - INFO - ======================================================================
2025-10-31 11:06:45,235 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-31
2025-10-31 11:06:45,235 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-31 11:06:46,041 - src.data.weather_integration - INFO - Successfully fetched weather data: 1257 days
2025-10-31 11:06:46,055 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-31 11:06:46,064 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-31 11:06:46,065 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-31
2025-10-31 11:06:46,075 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-31 11:06:46,077 - __main__ - INFO - Weather data updated: 1257 days
2025-10-31 11:06:46,078 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:46,079 - __main__ - INFO - STEP 3: Engineering Features
2025-10-31 11:06:46,080 - __main__ - INFO - ======================================================================
2025-10-31 11:06:46,081 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-31 11:06:46,086 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-31 11:06:46,105 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-31 11:06:46,106 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-31 11:06:46,112 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-31 11:06:46,124 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-31 11:06:46,153 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-31 11:06:46,154 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-31 11:06:46,158 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-31 11:06:46,159 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-31 11:06:46,161 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-31 11:06:46,161 - src.data.feature_engineering - INFO - Adding change features
2025-10-31 11:06:46,162 - src.data.feature_engineering - INFO - Added change features
2025-10-31 11:06:46,162 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-31 11:06:46,162 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-31 11:06:46,162 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-31 11:06:46,163 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-31 11:06:46,164 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-31 11:06:46,165 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-31 11:06:46,165 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-31 11:06:46,166 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-31 11:06:46,166 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:46,166 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-31 11:06:46,166 - __main__ - INFO - ======================================================================
2025-10-31 11:06:46,166 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-31 11:06:46,166 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-31 11:06:46,306 - src.utils.mlflow_utils - INFO - Loading model version 35 from Production stage
2025-10-31 11:06:46,754 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-31 11:06:47,094 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-31 11:06:47,095 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v35
2025-10-31 11:06:47,095 - src.models.predict - INFO - Loaded model for horizon 1
2025-10-31 11:06:47,095 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-31 11:06:47,109 - src.utils.mlflow_utils - INFO - Loading model version 33 from Production stage
2025-10-31 11:06:47,173 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-31 11:06:47,174 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v33
2025-10-31 11:06:47,174 - src.models.predict - INFO - Loaded model for horizon 2
2025-10-31 11:06:47,174 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-31 11:06:47,196 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-31 11:06:47,244 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-31 11:06:47,244 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v32
2025-10-31 11:06:47,244 - src.models.predict - INFO - Loaded model for horizon 3
2025-10-31 11:06:47,244 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-31 11:06:47,257 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-31 11:06:47,307 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-31 11:06:47,307 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v32
2025-10-31 11:06:47,307 - src.models.predict - INFO - Loaded model for horizon 4
2025-10-31 11:06:47,307 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-31 11:06:47,319 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-31 11:06:47,368 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-31 11:06:47,368 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v32
2025-10-31 11:06:47,368 - src.models.predict - INFO - Loaded model for horizon 5
2025-10-31 11:06:47,368 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-31 11:06:47,379 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-31 11:06:47,421 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-31 11:06:47,421 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v32
2025-10-31 11:06:47,421 - src.models.predict - INFO - Loaded model for horizon 6
2025-10-31 11:06:47,421 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-31 11:06:47,434 - src.utils.mlflow_utils - INFO - Loading model version 32 from Production stage
2025-10-31 11:06:47,481 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-31 11:06:47,481 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v32
2025-10-31 11:06:47,481 - src.models.predict - INFO - Loaded model for horizon 7
2025-10-31 11:06:47,481 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-10-31 11:06:47,481 - __main__ - INFO - Loaded 7 production models
2025-10-31 11:06:47,482 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:47,482 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-31 11:06:47,482 - __main__ - INFO - ======================================================================
2025-10-31 11:06:47,482 - src.models.predict - INFO - Preparing features for prediction
2025-10-31 11:06:47,482 - src.models.predict - INFO - Base date for predictions: 2025-10-31
2025-10-31 11:06:47,489 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-31 11:06:47,489 - src.models.predict - INFO - Prediction date range: 2025-11-01 to 2025-11-07
2025-10-31 11:06:47,490 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-31 11:06:47,490 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-31 11:06:47,490 - __main__ - INFO - Features prepared for next 7 days
2025-10-31 11:06:47,490 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:47,490 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-31 11:06:47,490 - __main__ - INFO - ======================================================================
2025-10-31 11:06:47,490 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-31 11:06:47,490 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-31 11:06:47,490 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-31 11:06:47,490 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-31 11:06:47,509 - src.models.predict - INFO - Generated 7 predictions
2025-10-31 11:06:47,509 - src.models.predict - INFO - Prediction range: 52.0 to 69.1 patients
2025-10-31 11:06:47,511 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-31 11:06:47,511 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-31 11:06:47,511 - __main__ - INFO -    Prediction range: 52.0 to 69.1 patients
2025-10-31 11:06:47,511 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:47,511 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-31 11:06:47,511 - __main__ - INFO - ======================================================================
2025-10-31 11:06:47,511 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-31 11:06:47,515 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251031_110647.csv
2025-10-31 11:06:47,515 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-31 11:06:47,515 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251031_110647.csv
2025-10-31 11:06:47,515 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:47,515 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-31 11:06:47,516 - __main__ - INFO - ======================================================================
2025-10-31 11:06:47,516 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-31 11:06:47,791 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 8c792511aa034d5e96879b1332995262
2025-10-31 11:06:47,804 - __main__ - INFO - Logged to MLflow run: 8c792511aa034d5e96879b1332995262
2025-10-31 11:06:47,807 - __main__ - INFO - 
======================================================================
2025-10-31 11:06:47,807 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-31 11:06:47,807 - __main__ - INFO - ======================================================================
2025-10-31 11:06:47,807 - __main__ - INFO - Average prediction: 62.8 patients
2025-10-31 11:06:47,807 - __main__ - INFO - Average interval width: 38.53788057374841
2025-10-31 11:06:47,807 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-31 11:06:47,809 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-31 11:31:34,567 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-31 11:31:34,567 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-31 11:31:34,567 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-31 11:31:34,567 - __main__ - INFO - ======================================================================
2025-10-31 11:31:34,567 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-31 11:31:34,567 - __main__ - INFO - ======================================================================
2025-10-31 11:31:34,568 - __main__ - INFO - Prediction base date: 2025-10-31
2025-10-31 11:31:34,568 - __main__ - INFO - Output path: data/predictions/
2025-10-31 11:31:34,568 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:34,568 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-31 11:31:34,568 - __main__ - INFO - ======================================================================
2025-10-31 11:31:34,568 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-31 11:31:35,264 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-31 11:31:35,265 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-31 11:31:35,315 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-31 11:31:35,321 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-31 11:31:35,323 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-31 11:31:35,350 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-31 11:31:35,351 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-31 11:31:35,351 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-31 11:31:35,351 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-31 11:31:35,351 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-31 11:31:35,354 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-31 11:31:35,357 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-31 11:31:35,359 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-31 11:31:35,359 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-31 11:31:35,360 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-31 11:31:35,360 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:35,360 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-31 11:31:35,360 - __main__ - INFO - ======================================================================
2025-10-31 11:31:35,360 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-31
2025-10-31 11:31:35,360 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-31 11:31:35,548 - src.data.weather_integration - INFO - Successfully fetched weather data: 1257 days
2025-10-31 11:31:35,551 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-31 11:31:35,555 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-31 11:31:35,555 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-31
2025-10-31 11:31:35,558 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-31 11:31:35,558 - __main__ - INFO - Weather data updated: 1257 days
2025-10-31 11:31:35,558 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:35,559 - __main__ - INFO - STEP 3: Engineering Features
2025-10-31 11:31:35,559 - __main__ - INFO - ======================================================================
2025-10-31 11:31:35,559 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-31 11:31:35,559 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-31 11:31:35,568 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-31 11:31:35,569 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-31 11:31:35,572 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-31 11:31:35,572 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-31 11:31:35,575 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-31 11:31:35,575 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-31 11:31:35,584 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-31 11:31:35,585 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-31 11:31:35,587 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-31 11:31:35,587 - src.data.feature_engineering - INFO - Adding change features
2025-10-31 11:31:35,589 - src.data.feature_engineering - INFO - Added change features
2025-10-31 11:31:35,590 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-31 11:31:35,590 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-31 11:31:35,590 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-31 11:31:35,592 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-31 11:31:35,593 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-31 11:31:35,595 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-31 11:31:35,595 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-31 11:31:35,595 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-31 11:31:35,596 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:35,596 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-31 11:31:35,596 - __main__ - INFO - ======================================================================
2025-10-31 11:31:35,596 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-31 11:31:35,597 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-31 11:31:35,693 - src.utils.mlflow_utils - INFO - Loading model version 36 from Production stage
2025-10-31 11:31:36,022 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-31 11:31:36,503 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-31 11:31:36,503 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v36
2025-10-31 11:31:36,504 - src.models.predict - INFO - Loaded model for horizon 1
2025-10-31 11:31:36,504 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-31 11:31:36,621 - src.utils.mlflow_utils - INFO - Loading model version 34 from Production stage
2025-10-31 11:31:36,829 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-31 11:31:36,829 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v34
2025-10-31 11:31:36,830 - src.models.predict - INFO - Loaded model for horizon 2
2025-10-31 11:31:36,830 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-31 11:31:36,885 - src.utils.mlflow_utils - INFO - Loading model version 33 from Production stage
2025-10-31 11:31:37,002 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-31 11:31:37,002 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v33
2025-10-31 11:31:37,002 - src.models.predict - INFO - Loaded model for horizon 3
2025-10-31 11:31:37,003 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-31 11:31:37,034 - src.utils.mlflow_utils - INFO - Loading model version 33 from Production stage
2025-10-31 11:31:37,166 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-31 11:31:37,166 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v33
2025-10-31 11:31:37,167 - src.models.predict - INFO - Loaded model for horizon 4
2025-10-31 11:31:37,167 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-31 11:31:37,195 - src.utils.mlflow_utils - INFO - Loading model version 33 from Production stage
2025-10-31 11:31:37,312 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-31 11:31:37,312 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v33
2025-10-31 11:31:37,312 - src.models.predict - INFO - Loaded model for horizon 5
2025-10-31 11:31:37,312 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-31 11:31:37,339 - src.utils.mlflow_utils - INFO - Loading model version 33 from Production stage
2025-10-31 11:31:37,660 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-31 11:31:37,660 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v33
2025-10-31 11:31:37,661 - src.models.predict - INFO - Loaded model for horizon 6
2025-10-31 11:31:37,661 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-31 11:31:37,693 - src.utils.mlflow_utils - INFO - Loading model version 33 from Production stage
2025-10-31 11:31:37,829 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-31 11:31:37,829 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v33
2025-10-31 11:31:37,829 - src.models.predict - INFO - Loaded model for horizon 7
2025-10-31 11:31:37,829 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-10-31 11:31:37,829 - __main__ - INFO - Loaded 7 production models
2025-10-31 11:31:37,829 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:37,830 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-31 11:31:37,830 - __main__ - INFO - ======================================================================
2025-10-31 11:31:37,830 - src.models.predict - INFO - Preparing features for prediction
2025-10-31 11:31:37,830 - src.models.predict - INFO - Base date for predictions: 2025-10-31
2025-10-31 11:31:37,861 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-31 11:31:37,863 - src.models.predict - INFO - Prediction date range: 2025-11-01 to 2025-11-07
2025-10-31 11:31:37,863 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-31 11:31:37,863 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-31 11:31:37,864 - __main__ - INFO - Features prepared for next 7 days
2025-10-31 11:31:37,864 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:37,864 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-31 11:31:37,864 - __main__ - INFO - ======================================================================
2025-10-31 11:31:37,864 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-31 11:31:37,864 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-31 11:31:37,864 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-31 11:31:37,868 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-31 11:31:37,968 - src.models.predict - INFO - Generated 7 predictions
2025-10-31 11:31:37,969 - src.models.predict - INFO - Prediction range: 52.0 to 69.1 patients
2025-10-31 11:31:37,975 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.11s
2025-10-31 11:31:37,976 - __main__ - INFO - Generated 7 predictions in 0.11s
2025-10-31 11:31:37,977 - __main__ - INFO -    Prediction range: 52.0 to 69.1 patients
2025-10-31 11:31:37,977 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:37,978 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-31 11:31:37,978 - __main__ - INFO - ======================================================================
2025-10-31 11:31:37,978 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-31 11:31:37,990 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251031_113137.csv
2025-10-31 11:31:37,990 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-31 11:31:37,990 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251031_113137.csv
2025-10-31 11:31:37,990 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:37,990 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-31 11:31:37,990 - __main__ - INFO - ======================================================================
2025-10-31 11:31:37,991 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-31 11:31:38,632 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 4cc47ae5534f4e06ae87aaaa13e6153b
2025-10-31 11:31:38,651 - __main__ - INFO - Logged to MLflow run: 4cc47ae5534f4e06ae87aaaa13e6153b
2025-10-31 11:31:38,653 - __main__ - INFO - 
======================================================================
2025-10-31 11:31:38,653 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-31 11:31:38,653 - __main__ - INFO - ======================================================================
2025-10-31 11:31:38,653 - __main__ - INFO - Average prediction: 62.8 patients
2025-10-31 11:31:38,653 - __main__ - INFO - Average interval width: 38.53788057374841
2025-10-31 11:31:38,654 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-31 11:31:38,657 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-10-31 12:14:44,251 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-10-31 12:14:44,251 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-10-31 12:14:44,252 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-10-31 12:14:44,253 - __main__ - INFO - ======================================================================
2025-10-31 12:14:44,253 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-10-31 12:14:44,253 - __main__ - INFO - ======================================================================
2025-10-31 12:14:44,254 - __main__ - INFO - Prediction base date: 2025-10-31
2025-10-31 12:14:44,254 - __main__ - INFO - Output path: data/predictions/
2025-10-31 12:14:44,255 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:44,255 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-10-31 12:14:44,255 - __main__ - INFO - ======================================================================
2025-10-31 12:14:44,255 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-10-31 12:14:44,944 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-10-31 12:14:44,944 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-10-31 12:14:45,009 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-10-31 12:14:45,016 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-10-31 12:14:45,018 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-10-31 12:14:45,047 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-10-31 12:14:45,048 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-10-31 12:14:45,049 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-10-31 12:14:45,049 - src.data.preprocessing - INFO - Min patients per day: 26
2025-10-31 12:14:45,049 - src.data.preprocessing - INFO - Max patients per day: 104
2025-10-31 12:14:45,052 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-10-31 12:14:45,057 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-10-31 12:14:45,060 - src.data.preprocessing - INFO - Filled 10 missing dates with 0 patient counts
2025-10-31 12:14:45,060 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-10-31 12:14:45,061 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-10-31 12:14:45,061 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:45,061 - __main__ - INFO - STEP 2: Fetching Latest Weather Data
2025-10-31 12:14:45,061 - __main__ - INFO - ======================================================================
2025-10-31 12:14:45,061 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-10-31
2025-10-31 12:14:45,062 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-10-31 12:14:45,240 - src.data.weather_integration - INFO - Successfully fetched weather data: 1257 days
2025-10-31 12:14:45,243 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-10-31 12:14:45,248 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-09-22
2025-10-31 12:14:45,248 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-10-31
2025-10-31 12:14:45,253 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-10-31 12:14:45,254 - __main__ - INFO - Weather data updated: 1257 days
2025-10-31 12:14:45,255 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:45,255 - __main__ - INFO - STEP 3: Engineering Features
2025-10-31 12:14:45,255 - __main__ - INFO - ======================================================================
2025-10-31 12:14:45,255 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-10-31 12:14:45,255 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-10-31 12:14:45,270 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-10-31 12:14:45,270 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-10-31 12:14:45,273 - src.data.feature_engineering - INFO - Weekend days: 348/1218 (28.6%)
2025-10-31 12:14:45,273 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-10-31 12:14:45,275 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-10-31 12:14:45,276 - src.data.feature_engineering - INFO - Adding Fourier features for periods: [365.25, 7, 3.5, 2.3]
2025-10-31 12:14:45,284 - src.data.feature_engineering - INFO - Added 14 Fourier features
2025-10-31 12:14:45,285 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-10-31 12:14:45,289 - src.data.feature_engineering - INFO - Added 7 lag features
2025-10-31 12:14:45,289 - src.data.feature_engineering - INFO - Adding change features
2025-10-31 12:14:45,291 - src.data.feature_engineering - INFO - Added change features
2025-10-31 12:14:45,292 - src.data.feature_engineering - INFO - Feature engineering complete: added 42 features
2025-10-31 12:14:45,292 - src.data.feature_engineering - INFO - Final shape: (1218, 49)
2025-10-31 12:14:45,292 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-10-31 12:14:45,295 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-10-31 12:14:45,296 - src.data.feature_engineering - INFO - Rows with NaN: 28/1218 (2.3%)
2025-10-31 12:14:45,297 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-10-31 12:14:45,298 - src.data.feature_engineering - INFO - Remaining rows: 1190
2025-10-31 12:14:45,298 - __main__ - INFO - Features engineered: (1190, 49)
2025-10-31 12:14:45,298 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:45,298 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-10-31 12:14:45,299 - __main__ - INFO - ======================================================================
2025-10-31 12:14:45,299 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-10-31 12:14:45,299 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-10-31 12:14:45,380 - src.utils.mlflow_utils - INFO - Loading model version 37 from Production stage
2025-10-31 12:14:45,754 - botocore.credentials - INFO - Found credentials in environment variables.
2025-10-31 12:14:46,083 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-10-31 12:14:46,084 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v37
2025-10-31 12:14:46,084 - src.models.predict - INFO - Loaded model for horizon 1
2025-10-31 12:14:46,084 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-10-31 12:14:46,100 - src.utils.mlflow_utils - INFO - Loading model version 35 from Production stage
2025-10-31 12:14:46,173 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-10-31 12:14:46,173 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v35
2025-10-31 12:14:46,174 - src.models.predict - INFO - Loaded model for horizon 2
2025-10-31 12:14:46,174 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-10-31 12:14:46,191 - src.utils.mlflow_utils - INFO - Loading model version 34 from Production stage
2025-10-31 12:14:46,262 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-10-31 12:14:46,262 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v34
2025-10-31 12:14:46,262 - src.models.predict - INFO - Loaded model for horizon 3
2025-10-31 12:14:46,263 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-10-31 12:14:46,282 - src.utils.mlflow_utils - INFO - Loading model version 34 from Production stage
2025-10-31 12:14:46,353 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-10-31 12:14:46,353 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v34
2025-10-31 12:14:46,353 - src.models.predict - INFO - Loaded model for horizon 4
2025-10-31 12:14:46,354 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-10-31 12:14:46,372 - src.utils.mlflow_utils - INFO - Loading model version 34 from Production stage
2025-10-31 12:14:46,434 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-10-31 12:14:46,434 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v34
2025-10-31 12:14:46,434 - src.models.predict - INFO - Loaded model for horizon 5
2025-10-31 12:14:46,434 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-10-31 12:14:46,452 - src.utils.mlflow_utils - INFO - Loading model version 34 from Production stage
2025-10-31 12:14:46,525 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-10-31 12:14:46,525 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v34
2025-10-31 12:14:46,525 - src.models.predict - INFO - Loaded model for horizon 6
2025-10-31 12:14:46,525 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-10-31 12:14:46,541 - src.utils.mlflow_utils - INFO - Loading model version 34 from Production stage
2025-10-31 12:14:46,640 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-10-31 12:14:46,641 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v34
2025-10-31 12:14:46,642 - src.models.predict - INFO - Loaded model for horizon 7
2025-10-31 12:14:46,643 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-10-31 12:14:46,644 - __main__ - INFO - Loaded 7 production models
2025-10-31 12:14:46,645 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:46,648 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-10-31 12:14:46,648 - __main__ - INFO - ======================================================================
2025-10-31 12:14:46,649 - src.models.predict - INFO - Preparing features for prediction
2025-10-31 12:14:46,649 - src.models.predict - INFO - Base date for predictions: 2025-10-31
2025-10-31 12:14:46,661 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-10-31 12:14:46,662 - src.models.predict - INFO - Prediction date range: 2025-11-01 to 2025-11-07
2025-10-31 12:14:46,662 - src.models.predict - INFO - Total columns in prediction features: 49
2025-10-31 12:14:46,662 - src.models.predict - INFO - All columns: ['Date', 'Patients_per_day', 'Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-31 12:14:46,662 - __main__ - INFO - Features prepared for next 7 days
2025-10-31 12:14:46,663 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:46,663 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-10-31 12:14:46,663 - __main__ - INFO - ======================================================================
2025-10-31 12:14:46,663 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-10-31 12:14:46,663 - src.models.predict - INFO - Feature columns selected: 47 features
2025-10-31 12:14:46,663 - src.models.predict - INFO - All feature columns: ['Temp_Max', 'Temp_Min', 'Temp_Mean', 'Precipitation', 'Snowfall', 'Day_of_week_sin', 'Day_of_week_cos', 'Month_sin', 'Month_cos', 'Day_of_month_sin', 'Day_of_month_cos', 'Day_of_week_1', 'Day_of_week_2', 'Day_of_week_3', 'Day_of_week_4', 'Day_of_week_5', 'Day_of_week_6', 'Weekend', 'patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg', 'patients_30d_std', 'annual_sin_1', 'annual_cos_1', 'annual_sin_2', 'annual_cos_2', 'annual_sin_3', 'annual_cos_3', 'weekly_sin_1', 'weekly_cos_1', 'weekly_sin_2', 'weekly_cos_2', 'half_week_sin_1', 'half_week_cos_1', 'short_cycle_sin_1', 'short_cycle_cos_1', 'patients_lag_1', 'patients_lag_2', 'patients_lag_3', 'patients_lag_7', 'patients_lag_14', 'patients_lag_21', 'patients_lag_28', 'patients_change_1d', 'patients_change_7d']
2025-10-31 12:14:46,663 - src.models.predict - INFO - Excluded columns present: Date=True, Patients_per_day=True, target=False
2025-10-31 12:14:46,683 - src.models.predict - INFO - Generated 7 predictions
2025-10-31 12:14:46,684 - src.models.predict - INFO - Prediction range: 52.0 to 69.1 patients
2025-10-31 12:14:46,685 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-10-31 12:14:46,685 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-10-31 12:14:46,686 - __main__ - INFO -    Prediction range: 52.0 to 69.1 patients
2025-10-31 12:14:46,686 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:46,686 - __main__ - INFO - STEP 7: Saving Predictions
2025-10-31 12:14:46,687 - __main__ - INFO - ======================================================================
2025-10-31 12:14:46,687 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-10-31 12:14:46,692 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251031_121446.csv
2025-10-31 12:14:46,692 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-10-31 12:14:46,692 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251031_121446.csv
2025-10-31 12:14:46,693 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:46,693 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-10-31 12:14:46,693 - __main__ - INFO - ======================================================================
2025-10-31 12:14:46,693 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-10-31 12:14:47,660 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 40c86dc5eb4c47e9b0b36d940acecdcf
2025-10-31 12:14:47,775 - __main__ - INFO - Logged to MLflow run: 40c86dc5eb4c47e9b0b36d940acecdcf
2025-10-31 12:14:47,780 - __main__ - INFO - 
======================================================================
2025-10-31 12:14:47,781 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-10-31 12:14:47,782 - __main__ - INFO - ======================================================================
2025-10-31 12:14:47,782 - __main__ - INFO - Average prediction: 62.8 patients
2025-10-31 12:14:47,783 - __main__ - INFO - Average interval width: 38.53788057374841
2025-10-31 12:14:47,796 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-10-31 12:14:47,809 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-03 18:43:19,507 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-03 18:43:19,507 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-03 18:43:19,507 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-03 18:43:19,507 - __main__ - INFO - ======================================================================
2025-12-03 18:43:19,507 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-03 18:43:19,507 - __main__ - INFO - ======================================================================
2025-12-03 18:43:19,507 - __main__ - INFO - Prediction base date: 2025-12-03
2025-12-03 18:43:19,507 - __main__ - INFO - Output path: data/predictions/
2025-12-03 18:43:19,507 - __main__ - INFO - 
======================================================================
2025-12-03 18:43:19,507 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-03 18:43:19,507 - __main__ - INFO - ======================================================================
2025-12-03 18:43:19,507 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-03 18:43:19,507 - __main__ - WARNING - Failed to load data from database: No module named 'pyodbc'
2025-12-03 18:43:19,507 - __main__ - INFO - Falling back to CSV file: data/raw/emergency_visits.csv
2025-12-03 18:43:19,507 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-12-03 18:43:19,862 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-12-03 18:43:19,862 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-12-03 18:43:19,898 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-12-03 18:43:19,901 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-12-03 18:43:19,902 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-03 18:43:19,928 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-12-03 18:43:19,928 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-12-03 18:43:19,928 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-12-03 18:43:19,928 - src.data.preprocessing - INFO - Min patients per day: 26
2025-12-03 18:43:19,928 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-03 18:43:19,929 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-03 18:43:19,932 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-12-03 18:43:19,935 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-03 18:43:19,935 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-12-03 18:43:19,936 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-03 18:43:19,936 - src.data.preprocessing - INFO - Outlier bounds: [18, 102] patients
2025-12-03 18:43:19,936 - src.data.preprocessing - INFO - Found 1 outliers (0.08%)
2025-12-03 18:43:19,936 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-03 18:43:19,937 - src.data.preprocessing - WARNING -   Below 18: 0 days
2025-12-03 18:43:19,937 - src.data.preprocessing - WARNING -   Above 102: 1 days
2025-12-03 18:43:19,937 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-03 18:43:19,938 - src.data.preprocessing - INFO - Capped 1 outliers to bounds [18, 102]
2025-12-03 18:43:19,938 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-12-03 18:43:19,938 - __main__ - ERROR - Prediction flow failed: Data is too stale for predictions. Most recent data: 2025-09-22 (72 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 230, in prediction_flow
    validate_data_freshness(df, max_staleness_days=max_staleness, min_rows_required=min_rows)
  File "/app/flows/prediction_flow.py", line 97, in validate_data_freshness
    raise ValueError(
ValueError: Data is too stale for predictions. Most recent data: 2025-09-22 (72 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
2025-12-03 18:43:19,938 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-12-06 01:48:39,578 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-06 01:48:39,578 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-06 01:48:39,578 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-06 01:48:39,578 - __main__ - INFO - ======================================================================
2025-12-06 01:48:39,578 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-06 01:48:39,578 - __main__ - INFO - ======================================================================
2025-12-06 01:48:39,578 - __main__ - INFO - Prediction base date: 2025-12-06
2025-12-06 01:48:39,578 - __main__ - INFO - Output path: data/predictions/
2025-12-06 01:48:39,578 - __main__ - INFO - 
======================================================================
2025-12-06 01:48:39,578 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-06 01:48:39,578 - __main__ - INFO - ======================================================================
2025-12-06 01:48:39,578 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-06 01:48:39,578 - __main__ - WARNING - Failed to load data from database: No module named 'pyodbc'
2025-12-06 01:48:39,578 - __main__ - INFO - Falling back to CSV file: data/raw/emergency_visits.csv
2025-12-06 01:48:39,578 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-12-06 01:48:39,932 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-12-06 01:48:39,932 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-12-06 01:48:39,969 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-12-06 01:48:39,973 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-12-06 01:48:39,974 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-06 01:48:39,995 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-12-06 01:48:39,995 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-12-06 01:48:39,995 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-12-06 01:48:39,995 - src.data.preprocessing - INFO - Min patients per day: 26
2025-12-06 01:48:39,995 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-06 01:48:39,996 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-06 01:48:39,999 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-12-06 01:48:40,002 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-06 01:48:40,002 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-12-06 01:48:40,002 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-06 01:48:40,003 - src.data.preprocessing - INFO - Outlier bounds: [18, 102] patients
2025-12-06 01:48:40,003 - src.data.preprocessing - INFO - Found 1 outliers (0.08%)
2025-12-06 01:48:40,003 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-06 01:48:40,003 - src.data.preprocessing - WARNING -   Below 18: 0 days
2025-12-06 01:48:40,003 - src.data.preprocessing - WARNING -   Above 102: 1 days
2025-12-06 01:48:40,004 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-06 01:48:40,005 - src.data.preprocessing - INFO - Capped 1 outliers to bounds [18, 102]
2025-12-06 01:48:40,005 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-12-06 01:48:40,005 - __main__ - ERROR - Prediction flow failed: Data is too stale for predictions. Most recent data: 2025-09-22 (75 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 230, in prediction_flow
    validate_data_freshness(df, max_staleness_days=max_staleness, min_rows_required=min_rows)
  File "/app/flows/prediction_flow.py", line 97, in validate_data_freshness
    raise ValueError(
ValueError: Data is too stale for predictions. Most recent data: 2025-09-22 (75 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
2025-12-06 01:48:40,005 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-12-06 01:57:23,720 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-06 01:57:23,720 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-06 01:57:23,720 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-06 01:57:23,720 - __main__ - INFO - ======================================================================
2025-12-06 01:57:23,720 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-06 01:57:23,720 - __main__ - INFO - ======================================================================
2025-12-06 01:57:23,720 - __main__ - INFO - Prediction base date: 2025-12-06
2025-12-06 01:57:23,720 - __main__ - INFO - Output path: data/predictions/
2025-12-06 01:57:23,720 - __main__ - INFO - 
======================================================================
2025-12-06 01:57:23,720 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-06 01:57:23,720 - __main__ - INFO - ======================================================================
2025-12-06 01:57:23,720 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-06 01:57:23,721 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-06 01:57:26,377 - src.data.preprocessing - ERROR - Failed to execute stored procedure: cannot assemble with duplicate keys
2025-12-06 01:57:26,377 - src.data.preprocessing - ERROR - Failed to load data from database: cannot assemble with duplicate keys
2025-12-06 01:57:26,377 - __main__ - WARNING - Failed to load data from database: cannot assemble with duplicate keys
2025-12-06 01:57:26,377 - __main__ - INFO - Falling back to CSV file: data/raw/emergency_visits.csv
2025-12-06 01:57:26,377 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-12-06 01:57:26,738 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-12-06 01:57:26,770 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-12-06 01:57:26,806 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-12-06 01:57:26,810 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-12-06 01:57:26,810 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-06 01:57:26,831 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-12-06 01:57:26,831 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-12-06 01:57:26,831 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-12-06 01:57:26,831 - src.data.preprocessing - INFO - Min patients per day: 26
2025-12-06 01:57:26,831 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-06 01:57:26,833 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-06 01:57:26,834 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-12-06 01:57:26,838 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-06 01:57:26,838 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-12-06 01:57:26,838 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-06 01:57:26,839 - src.data.preprocessing - INFO - Outlier bounds: [18, 102] patients
2025-12-06 01:57:26,839 - src.data.preprocessing - INFO - Found 1 outliers (0.08%)
2025-12-06 01:57:26,839 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-06 01:57:26,839 - src.data.preprocessing - WARNING -   Below 18: 0 days
2025-12-06 01:57:26,839 - src.data.preprocessing - WARNING -   Above 102: 1 days
2025-12-06 01:57:26,840 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-06 01:57:26,840 - src.data.preprocessing - INFO - Capped 1 outliers to bounds [18, 102]
2025-12-06 01:57:26,840 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-12-06 01:57:26,840 - __main__ - ERROR - Prediction flow failed: Data is too stale for predictions. Most recent data: 2025-09-22 (75 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 230, in prediction_flow
    validate_data_freshness(df, max_staleness_days=max_staleness, min_rows_required=min_rows)
  File "/app/flows/prediction_flow.py", line 97, in validate_data_freshness
    raise ValueError(
ValueError: Data is too stale for predictions. Most recent data: 2025-09-22 (75 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
2025-12-06 01:57:26,841 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-12-06 02:06:54,721 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-06 02:06:54,721 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-06 02:06:54,721 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-06 02:06:54,721 - __main__ - INFO - ======================================================================
2025-12-06 02:06:54,721 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-06 02:06:54,721 - __main__ - INFO - ======================================================================
2025-12-06 02:06:54,721 - __main__ - INFO - Prediction base date: 2025-12-06
2025-12-06 02:06:54,721 - __main__ - INFO - Output path: data/predictions/
2025-12-06 02:06:54,721 - __main__ - INFO - 
======================================================================
2025-12-06 02:06:54,721 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-06 02:06:54,721 - __main__ - INFO - ======================================================================
2025-12-06 02:06:54,721 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-06 02:06:54,722 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-06 02:06:58,034 - src.data.preprocessing - ERROR - Failed to execute stored procedure: cannot assemble with duplicate keys
2025-12-06 02:06:58,039 - src.data.preprocessing - ERROR - Failed to load data from database: cannot assemble with duplicate keys
2025-12-06 02:06:58,039 - __main__ - WARNING - Failed to load data from database: cannot assemble with duplicate keys
2025-12-06 02:06:58,039 - __main__ - INFO - Falling back to CSV file: data/raw/emergency_visits.csv
2025-12-06 02:06:58,039 - src.data.preprocessing - INFO - Loading raw data from: data/raw/emergency_visits.csv
2025-12-06 02:06:58,426 - src.data.preprocessing - INFO - Successfully loaded 261,533 rows from data/raw/emergency_visits.csv
2025-12-06 02:06:58,458 - src.data.preprocessing - INFO - Removing duplicates from 261,533 rows
2025-12-06 02:06:58,498 - src.data.preprocessing - WARNING - Found 189,003 duplicate rows (72.27%)
2025-12-06 02:06:58,502 - src.data.preprocessing - INFO - After removing duplicates: 72,530 rows remain
2025-12-06 02:06:58,502 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-06 02:06:58,523 - src.data.preprocessing - INFO - Aggregated to 1,208 days
2025-12-06 02:06:58,524 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-09-22 00:00:00
2025-12-06 02:06:58,524 - src.data.preprocessing - INFO - Average patients per day: 60.0
2025-12-06 02:06:58,524 - src.data.preprocessing - INFO - Min patients per day: 26
2025-12-06 02:06:58,524 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-06 02:06:58,525 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-06 02:06:58,527 - src.data.preprocessing - WARNING - Found 10 missing dates (0.82%)
2025-12-06 02:06:58,530 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-06 02:06:58,531 - src.data.preprocessing - INFO - Final time series: 1,218 days from 2022-05-24 to 2025-09-22
2025-12-06 02:06:58,531 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-06 02:06:58,531 - src.data.preprocessing - INFO - Outlier bounds: [18, 102] patients
2025-12-06 02:06:58,531 - src.data.preprocessing - INFO - Found 1 outliers (0.08%)
2025-12-06 02:06:58,532 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-06 02:06:58,532 - src.data.preprocessing - WARNING -   Below 18: 0 days
2025-12-06 02:06:58,532 - src.data.preprocessing - WARNING -   Above 102: 1 days
2025-12-06 02:06:58,532 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-06 02:06:58,533 - src.data.preprocessing - INFO - Capped 1 outliers to bounds [18, 102]
2025-12-06 02:06:58,533 - __main__ - INFO - Loaded data: 1218 days up to 2025-09-22
2025-12-06 02:06:58,533 - __main__ - ERROR - Prediction flow failed: Data is too stale for predictions. Most recent data: 2025-09-22 (75 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 230, in prediction_flow
    validate_data_freshness(df, max_staleness_days=max_staleness, min_rows_required=min_rows)
  File "/app/flows/prediction_flow.py", line 97, in validate_data_freshness
    raise ValueError(
ValueError: Data is too stale for predictions. Most recent data: 2025-09-22 (75 days old). Maximum allowed staleness: 1 days. Stale data causes lag feature misalignment with prediction dates, breaking weekly pattern capture. Please ensure the data pipeline is running correctly.
2025-12-06 02:06:58,534 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-12-06 02:30:00,315 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-06 02:30:00,315 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-06 02:30:00,315 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-06 02:30:00,315 - __main__ - INFO - ======================================================================
2025-12-06 02:30:00,316 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-06 02:30:00,316 - __main__ - INFO - ======================================================================
2025-12-06 02:30:00,316 - __main__ - INFO - Prediction base date: 2025-12-06
2025-12-06 02:30:00,316 - __main__ - INFO - Output path: data/predictions/
2025-12-06 02:30:00,316 - __main__ - INFO - 
======================================================================
2025-12-06 02:30:00,316 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-06 02:30:00,316 - __main__ - INFO - ======================================================================
2025-12-06 02:30:00,316 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-06 02:30:00,316 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-06 02:30:02,962 - src.data.preprocessing - INFO - Successfully loaded 276,620 rows from database
2025-12-06 02:30:02,998 - __main__ - INFO - Successfully loaded 276,620 rows from database
2025-12-06 02:30:02,998 - src.data.preprocessing - INFO - Removing duplicates from 276,620 rows
2025-12-06 02:30:03,018 - src.data.preprocessing - WARNING - Found 199,537 duplicate rows (72.13%)
2025-12-06 02:30:03,021 - src.data.preprocessing - INFO - After removing duplicates: 77,083 rows remain
2025-12-06 02:30:03,023 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-06 02:30:03,089 - src.data.preprocessing - INFO - Aggregated to 1,283 days
2025-12-06 02:30:03,089 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-06 00:00:00
2025-12-06 02:30:03,089 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-06 02:30:03,089 - src.data.preprocessing - INFO - Min patients per day: 2
2025-12-06 02:30:03,089 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-06 02:30:03,091 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-06 02:30:03,093 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-06 02:30:03,096 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-06 02:30:03,097 - src.data.preprocessing - INFO - Final time series: 1,293 days from 2022-05-24 to 2025-12-06
2025-12-06 02:30:03,097 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-06 02:30:03,097 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-06 02:30:03,097 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-06 02:30:03,098 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-06 02:30:03,098 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-06 02:30:03,098 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-06 02:30:03,098 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-06 02:30:03,099 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 2 patients
2025-12-06 02:30:03,099 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-06 02:30:03,099 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-06 02:30:03,100 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-06 02:30:03,100 - __main__ - INFO - Loaded data: 1293 days up to 2025-12-06
2025-12-06 02:30:03,100 - __main__ - INFO - Data validation passed: 1293 rows, most recent date 2025-12-06 (0 days ago)
2025-12-06 02:30:03,100 - __main__ - INFO - 
======================================================================
2025-12-06 02:30:03,100 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-06 02:30:03,100 - __main__ - INFO - ======================================================================
2025-12-06 02:30:03,100 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-06
2025-12-06 02:30:03,100 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 02:30:03,502 - src.data.weather_integration - INFO - Successfully fetched weather data: 1293 days
2025-12-06 02:30:03,503 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-06 02:30:03,504 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-06
2025-12-06 02:30:03,504 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-06
2025-12-06 02:30:03,506 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-06 02:30:03,506 - __main__ - INFO - Historical weather data: 1293 days
2025-12-06 02:30:03,506 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-06 02:30:03,506 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 02:30:05,501 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-06 02:30:05,502 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-06 02:30:05,503 - __main__ - INFO - Forecast date range: 2025-12-06 to 2025-12-13
2025-12-06 02:30:05,503 - __main__ - INFO - 
======================================================================
2025-12-06 02:30:05,503 - __main__ - INFO - STEP 3: Engineering Features
2025-12-06 02:30:05,503 - __main__ - INFO - ======================================================================
2025-12-06 02:30:05,503 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-06 02:30:05,503 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-06 02:30:05,506 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-06 02:30:05,507 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-06 02:30:05,508 - src.data.feature_engineering - INFO - Weekend days: 369/1293 (28.5%)
2025-12-06 02:30:05,508 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-06 02:30:05,509 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-06 02:30:05,509 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-06 02:30:05,510 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-06 02:30:05,510 - src.data.feature_engineering - INFO - Adding change features
2025-12-06 02:30:05,511 - src.data.feature_engineering - INFO - Added change features
2025-12-06 02:30:05,511 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-06 02:30:05,511 - src.data.feature_engineering - INFO - Final shape: (1293, 35)
2025-12-06 02:30:05,511 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-06 02:30:05,511 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-06 02:30:05,512 - src.data.feature_engineering - INFO - Rows with NaN: 28/1293 (2.2%)
2025-12-06 02:30:05,513 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-06 02:30:05,513 - src.data.feature_engineering - INFO - Remaining rows: 1265
2025-12-06 02:30:05,513 - __main__ - INFO - Features engineered: (1265, 35)
2025-12-06 02:30:05,513 - __main__ - INFO - 
======================================================================
2025-12-06 02:30:05,513 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-06 02:30:05,513 - __main__ - INFO - ======================================================================
2025-12-06 02:30:05,513 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-06 02:30:05,513 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-06 02:30:05,894 - src.utils.mlflow_utils - INFO - Loading model version 4 from Production stage
2025-12-06 02:30:06,214 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-06 02:30:06,336 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-06 02:30:06,336 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v4
2025-12-06 02:30:06,336 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-06 02:30:06,336 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-06 02:30:06,390 - src.utils.mlflow_utils - INFO - Loading model version 4 from Production stage
2025-12-06 02:30:06,556 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-06 02:30:06,556 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v4
2025-12-06 02:30:06,556 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-06 02:30:06,556 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-06 02:30:06,652 - src.utils.mlflow_utils - INFO - Loading model version 4 from Production stage
2025-12-06 02:30:06,814 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-06 02:30:06,815 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v4
2025-12-06 02:30:06,815 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-06 02:30:06,815 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-06 02:30:06,908 - src.utils.mlflow_utils - INFO - Loading model version 4 from Production stage
2025-12-06 02:30:07,073 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-06 02:30:07,073 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v4
2025-12-06 02:30:07,073 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-06 02:30:07,073 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-06 02:30:07,169 - src.utils.mlflow_utils - INFO - Loading model version 4 from Production stage
2025-12-06 02:30:07,334 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-06 02:30:07,334 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v4
2025-12-06 02:30:07,334 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-06 02:30:07,334 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-06 02:30:07,430 - src.utils.mlflow_utils - INFO - Loading model version 4 from Production stage
2025-12-06 02:30:07,595 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-06 02:30:07,595 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v4
2025-12-06 02:30:07,595 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-06 02:30:07,595 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-06 02:30:07,688 - src.utils.mlflow_utils - INFO - Loading model version 4 from Production stage
2025-12-06 02:30:07,855 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-06 02:30:07,855 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v4
2025-12-06 02:30:07,855 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-06 02:30:07,855 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-06 02:30:07,855 - __main__ - INFO - Loaded 7 production models
2025-12-06 02:30:07,855 - __main__ - INFO - 
======================================================================
2025-12-06 02:30:07,855 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-06 02:30:07,855 - __main__ - INFO - ======================================================================
2025-12-06 02:30:07,855 - src.models.predict - INFO - Preparing features for prediction
2025-12-06 02:30:07,855 - src.models.predict - INFO - Base date for predictions: 2025-12-06
2025-12-06 02:30:07,863 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-06 02:30:07,864 - src.models.predict - INFO - Prediction date range: 2025-12-07 to 2025-12-13
2025-12-06 02:30:07,864 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-06 02:30:07,864 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-06 02:30:07,864 - __main__ - INFO - Features prepared for next 7 days
2025-12-06 02:30:07,864 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-06 02:30:07,864 - __main__ - INFO - 
======================================================================
2025-12-06 02:30:07,864 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-06 02:30:07,864 - __main__ - INFO - ======================================================================
2025-12-06 02:30:07,864 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-06 02:30:07,864 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-06 02:30:07,866 - __main__ - ERROR - Prediction flow failed: The number of features in data (33) is not the same as it was in training data (47).
You can set ``predict_disable_shape_check=true`` to discard this error, but please be aware what you are doing.
Traceback (most recent call last):
  File "/app/flows/prediction_flow.py", line 315, in prediction_flow
    predictions = generate_predictions(
                  ^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/models/predict.py", line 290, in generate_predictions
    pred = model.predict(X, return_intervals=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/src/models/lightgbm_model.py", line 161, in predict
    point_preds = self.point_model.predict(X)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/lightgbm/sklearn.py", line 1144, in predict
    return self._Booster.predict(  # type: ignore[union-attr]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/lightgbm/basic.py", line 4767, in predict
    return predictor.predict(
           ^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/lightgbm/basic.py", line 1204, in predict
    preds, nrow = self.__pred_for_np2d(
                  ^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/lightgbm/basic.py", line 1361, in __pred_for_np2d
    return self.__inner_predict_np2d(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/.venv/lib/python3.11/site-packages/lightgbm/basic.py", line 1307, in __inner_predict_np2d
    _safe_call(
  File "/app/.venv/lib/python3.11/site-packages/lightgbm/basic.py", line 313, in _safe_call
    raise LightGBMError(_LIB.LGBM_GetLastError().decode("utf-8"))
lightgbm.basic.LightGBMError: The number of features in data (33) is not the same as it was in training data (47).
You can set ``predict_disable_shape_check=true`` to discard this error, but please be aware what you are doing.
2025-12-06 02:30:07,867 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - failure
2025-12-06 02:31:40,115 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-06 02:31:40,115 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-06 02:31:40,115 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-06 02:31:40,115 - __main__ - INFO - ======================================================================
2025-12-06 02:31:40,115 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-06 02:31:40,115 - __main__ - INFO - ======================================================================
2025-12-06 02:31:40,115 - __main__ - INFO - Prediction base date: 2025-12-06
2025-12-06 02:31:40,115 - __main__ - INFO - Output path: data/predictions/
2025-12-06 02:31:40,115 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:40,115 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-06 02:31:40,115 - __main__ - INFO - ======================================================================
2025-12-06 02:31:40,115 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-06 02:31:40,116 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-06 02:31:43,393 - src.data.preprocessing - INFO - Successfully loaded 276,620 rows from database
2025-12-06 02:31:43,428 - __main__ - INFO - Successfully loaded 276,620 rows from database
2025-12-06 02:31:43,428 - src.data.preprocessing - INFO - Removing duplicates from 276,620 rows
2025-12-06 02:31:43,445 - src.data.preprocessing - WARNING - Found 199,537 duplicate rows (72.13%)
2025-12-06 02:31:43,448 - src.data.preprocessing - INFO - After removing duplicates: 77,083 rows remain
2025-12-06 02:31:43,450 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-06 02:31:43,514 - src.data.preprocessing - INFO - Aggregated to 1,283 days
2025-12-06 02:31:43,514 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-06 00:00:00
2025-12-06 02:31:43,514 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-06 02:31:43,514 - src.data.preprocessing - INFO - Min patients per day: 2
2025-12-06 02:31:43,514 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-06 02:31:43,516 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-06 02:31:43,518 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-06 02:31:43,521 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-06 02:31:43,521 - src.data.preprocessing - INFO - Final time series: 1,293 days from 2022-05-24 to 2025-12-06
2025-12-06 02:31:43,521 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-06 02:31:43,522 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-06 02:31:43,522 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-06 02:31:43,522 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-06 02:31:43,522 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-06 02:31:43,522 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-06 02:31:43,523 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-06 02:31:43,524 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 2 patients
2025-12-06 02:31:43,524 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-06 02:31:43,524 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-06 02:31:43,524 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-06 02:31:43,525 - __main__ - INFO - Loaded data: 1293 days up to 2025-12-06
2025-12-06 02:31:43,525 - __main__ - INFO - Data validation passed: 1293 rows, most recent date 2025-12-06 (0 days ago)
2025-12-06 02:31:43,525 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:43,525 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-06 02:31:43,525 - __main__ - INFO - ======================================================================
2025-12-06 02:31:43,525 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-06
2025-12-06 02:31:43,525 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 02:31:43,852 - src.data.weather_integration - INFO - Successfully fetched weather data: 1293 days
2025-12-06 02:31:43,852 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-06 02:31:43,854 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-06
2025-12-06 02:31:43,854 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-06
2025-12-06 02:31:43,855 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-06 02:31:43,856 - __main__ - INFO - Historical weather data: 1293 days
2025-12-06 02:31:43,856 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-06 02:31:43,856 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 02:31:43,990 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-06 02:31:43,991 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-06 02:31:43,991 - __main__ - INFO - Forecast date range: 2025-12-06 to 2025-12-13
2025-12-06 02:31:43,991 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:43,991 - __main__ - INFO - STEP 3: Engineering Features
2025-12-06 02:31:43,991 - __main__ - INFO - ======================================================================
2025-12-06 02:31:43,991 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-06 02:31:43,991 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-06 02:31:43,995 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-06 02:31:43,995 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-06 02:31:43,996 - src.data.feature_engineering - INFO - Weekend days: 369/1293 (28.5%)
2025-12-06 02:31:43,996 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-06 02:31:43,997 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-06 02:31:43,997 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-06 02:31:43,998 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-06 02:31:43,999 - src.data.feature_engineering - INFO - Adding change features
2025-12-06 02:31:43,999 - src.data.feature_engineering - INFO - Added change features
2025-12-06 02:31:43,999 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-06 02:31:43,999 - src.data.feature_engineering - INFO - Final shape: (1293, 35)
2025-12-06 02:31:43,999 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-06 02:31:43,999 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-06 02:31:44,000 - src.data.feature_engineering - INFO - Rows with NaN: 28/1293 (2.2%)
2025-12-06 02:31:44,000 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-06 02:31:44,001 - src.data.feature_engineering - INFO - Remaining rows: 1265
2025-12-06 02:31:44,001 - __main__ - INFO - Features engineered: (1265, 35)
2025-12-06 02:31:44,001 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:44,001 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-06 02:31:44,001 - __main__ - INFO - ======================================================================
2025-12-06 02:31:44,001 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-06 02:31:44,001 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-06 02:31:44,378 - src.utils.mlflow_utils - INFO - Loading model version 5 from Production stage
2025-12-06 02:31:44,695 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-06 02:31:44,816 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-06 02:31:44,816 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v5
2025-12-06 02:31:44,816 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-06 02:31:44,816 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-06 02:31:44,870 - src.utils.mlflow_utils - INFO - Loading model version 5 from Production stage
2025-12-06 02:31:45,037 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-06 02:31:45,037 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v5
2025-12-06 02:31:45,037 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-06 02:31:45,037 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-06 02:31:45,129 - src.utils.mlflow_utils - INFO - Loading model version 5 from Production stage
2025-12-06 02:31:45,290 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-06 02:31:45,290 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v5
2025-12-06 02:31:45,290 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-06 02:31:45,290 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-06 02:31:45,383 - src.utils.mlflow_utils - INFO - Loading model version 5 from Production stage
2025-12-06 02:31:45,547 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-06 02:31:45,547 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v5
2025-12-06 02:31:45,547 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-06 02:31:45,547 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-06 02:31:45,641 - src.utils.mlflow_utils - INFO - Loading model version 5 from Production stage
2025-12-06 02:31:45,806 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-06 02:31:45,807 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v5
2025-12-06 02:31:45,807 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-06 02:31:45,807 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-06 02:31:45,900 - src.utils.mlflow_utils - INFO - Loading model version 5 from Production stage
2025-12-06 02:31:46,065 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-06 02:31:46,065 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v5
2025-12-06 02:31:46,065 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-06 02:31:46,065 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-06 02:31:46,160 - src.utils.mlflow_utils - INFO - Loading model version 5 from Production stage
2025-12-06 02:31:46,326 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-06 02:31:46,326 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v5
2025-12-06 02:31:46,326 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-06 02:31:46,326 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-06 02:31:46,326 - __main__ - INFO - Loaded 7 production models
2025-12-06 02:31:46,326 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:46,326 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-06 02:31:46,326 - __main__ - INFO - ======================================================================
2025-12-06 02:31:46,326 - src.models.predict - INFO - Preparing features for prediction
2025-12-06 02:31:46,326 - src.models.predict - INFO - Base date for predictions: 2025-12-06
2025-12-06 02:31:46,334 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-06 02:31:46,335 - src.models.predict - INFO - Prediction date range: 2025-12-07 to 2025-12-13
2025-12-06 02:31:46,335 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-06 02:31:46,335 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-06 02:31:46,335 - __main__ - INFO - Features prepared for next 7 days
2025-12-06 02:31:46,335 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-06 02:31:46,335 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:46,335 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-06 02:31:46,335 - __main__ - INFO - ======================================================================
2025-12-06 02:31:46,335 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-06 02:31:46,335 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-06 02:31:46,355 - src.models.predict - INFO - Generated 7 predictions
2025-12-06 02:31:46,355 - src.models.predict - INFO - Prediction range: 50.2 to 73.3 patients
2025-12-06 02:31:46,356 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-06 02:31:46,356 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-06 02:31:46,356 - __main__ - INFO -    Prediction range: 50.2 to 73.3 patients
2025-12-06 02:31:46,356 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:46,356 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-06 02:31:46,356 - __main__ - INFO - ======================================================================
2025-12-06 02:31:46,356 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-06 02:31:46,359 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251206_023146.csv
2025-12-06 02:31:46,359 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-06 02:31:46,359 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251206_023146.csv
2025-12-06 02:31:46,359 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 02:31:46,430 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 02:31:46,430 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 02:31:46,430 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:46,431 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-06 02:31:46,431 - __main__ - INFO - ======================================================================
2025-12-06 02:31:46,431 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-06 02:31:47,259 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: a51432372bda4859ae6425903b89428f
2025-12-06 02:31:47,314 - __main__ - INFO - Logged to MLflow run: a51432372bda4859ae6425903b89428f
2025-12-06 02:31:47,315 - __main__ - INFO - 
======================================================================
2025-12-06 02:31:47,315 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-06 02:31:47,315 - __main__ - INFO - ======================================================================
2025-12-06 02:31:47,315 - __main__ - INFO - Average prediction: 63.5 patients
2025-12-06 02:31:47,315 - __main__ - INFO - Average interval width: 39.33210931337724
2025-12-06 02:31:47,315 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-06 02:31:47,316 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-06 02:47:12,535 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-06 02:47:12,535 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-06 02:47:12,535 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-06 02:47:12,535 - __main__ - INFO - ======================================================================
2025-12-06 02:47:12,535 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-06 02:47:12,535 - __main__ - INFO - ======================================================================
2025-12-06 02:47:12,535 - __main__ - INFO - Prediction base date: 2025-12-06
2025-12-06 02:47:12,535 - __main__ - INFO - Output path: data/predictions/
2025-12-06 02:47:12,535 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:12,535 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-06 02:47:12,535 - __main__ - INFO - ======================================================================
2025-12-06 02:47:12,535 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-06 02:47:12,536 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-06 02:47:15,493 - src.data.preprocessing - INFO - Successfully loaded 276,620 rows from database
2025-12-06 02:47:15,527 - __main__ - INFO - Successfully loaded 276,620 rows from database
2025-12-06 02:47:15,527 - src.data.preprocessing - INFO - Removing duplicates from 276,620 rows
2025-12-06 02:47:15,544 - src.data.preprocessing - WARNING - Found 199,537 duplicate rows (72.13%)
2025-12-06 02:47:15,547 - src.data.preprocessing - INFO - After removing duplicates: 77,083 rows remain
2025-12-06 02:47:15,549 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-06 02:47:15,612 - src.data.preprocessing - INFO - Aggregated to 1,283 days
2025-12-06 02:47:15,612 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-06 00:00:00
2025-12-06 02:47:15,612 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-06 02:47:15,612 - src.data.preprocessing - INFO - Min patients per day: 2
2025-12-06 02:47:15,613 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-06 02:47:15,614 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-06 02:47:15,616 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-06 02:47:15,619 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-06 02:47:15,619 - src.data.preprocessing - INFO - Final time series: 1,293 days from 2022-05-24 to 2025-12-06
2025-12-06 02:47:15,620 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-06 02:47:15,620 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-06 02:47:15,620 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-06 02:47:15,620 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-06 02:47:15,620 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-06 02:47:15,621 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-06 02:47:15,621 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-06 02:47:15,622 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 2 patients
2025-12-06 02:47:15,622 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-06 02:47:15,622 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-06 02:47:15,622 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-06 02:47:15,623 - __main__ - INFO - Loaded data: 1293 days up to 2025-12-06
2025-12-06 02:47:15,623 - __main__ - INFO - Data validation passed: 1293 rows, most recent date 2025-12-06 (0 days ago)
2025-12-06 02:47:15,623 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:15,623 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-06 02:47:15,623 - __main__ - INFO - ======================================================================
2025-12-06 02:47:15,623 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-06
2025-12-06 02:47:15,623 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 02:47:15,777 - src.data.weather_integration - INFO - Successfully fetched weather data: 1293 days
2025-12-06 02:47:15,778 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-06 02:47:15,779 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-06
2025-12-06 02:47:15,779 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-06
2025-12-06 02:47:15,780 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-06 02:47:15,781 - __main__ - INFO - Historical weather data: 1293 days
2025-12-06 02:47:15,781 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-06 02:47:15,781 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 02:47:15,905 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-06 02:47:15,906 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-06 02:47:15,906 - __main__ - INFO - Forecast date range: 2025-12-06 to 2025-12-13
2025-12-06 02:47:15,906 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:15,906 - __main__ - INFO - STEP 3: Engineering Features
2025-12-06 02:47:15,906 - __main__ - INFO - ======================================================================
2025-12-06 02:47:15,906 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-06 02:47:15,906 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-06 02:47:15,909 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-06 02:47:15,909 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-06 02:47:15,911 - src.data.feature_engineering - INFO - Weekend days: 369/1293 (28.5%)
2025-12-06 02:47:15,911 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-06 02:47:15,912 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-06 02:47:15,912 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-06 02:47:15,913 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-06 02:47:15,913 - src.data.feature_engineering - INFO - Adding change features
2025-12-06 02:47:15,914 - src.data.feature_engineering - INFO - Added change features
2025-12-06 02:47:15,914 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-06 02:47:15,914 - src.data.feature_engineering - INFO - Final shape: (1293, 35)
2025-12-06 02:47:15,914 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-06 02:47:15,914 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-06 02:47:15,915 - src.data.feature_engineering - INFO - Rows with NaN: 28/1293 (2.2%)
2025-12-06 02:47:15,915 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-06 02:47:15,915 - src.data.feature_engineering - INFO - Remaining rows: 1265
2025-12-06 02:47:15,915 - __main__ - INFO - Features engineered: (1265, 35)
2025-12-06 02:47:15,915 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:15,915 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-06 02:47:15,915 - __main__ - INFO - ======================================================================
2025-12-06 02:47:15,915 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-06 02:47:15,915 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-06 02:47:15,980 - src.utils.mlflow_utils - INFO - Loading model version 6 from Production stage
2025-12-06 02:47:16,294 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-06 02:47:16,419 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-06 02:47:16,419 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v6
2025-12-06 02:47:16,419 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-06 02:47:16,419 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-06 02:47:16,472 - src.utils.mlflow_utils - INFO - Loading model version 6 from Production stage
2025-12-06 02:47:16,638 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-06 02:47:16,638 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v6
2025-12-06 02:47:16,638 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-06 02:47:16,639 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-06 02:47:16,734 - src.utils.mlflow_utils - INFO - Loading model version 6 from Production stage
2025-12-06 02:47:16,899 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-06 02:47:16,899 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v6
2025-12-06 02:47:16,899 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-06 02:47:16,899 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-06 02:47:16,993 - src.utils.mlflow_utils - INFO - Loading model version 6 from Production stage
2025-12-06 02:47:17,160 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-06 02:47:17,161 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v6
2025-12-06 02:47:17,161 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-06 02:47:17,161 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-06 02:47:17,258 - src.utils.mlflow_utils - INFO - Loading model version 6 from Production stage
2025-12-06 02:47:17,424 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-06 02:47:17,424 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v6
2025-12-06 02:47:17,424 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-06 02:47:17,424 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-06 02:47:17,517 - src.utils.mlflow_utils - INFO - Loading model version 6 from Production stage
2025-12-06 02:47:17,681 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-06 02:47:17,681 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v6
2025-12-06 02:47:17,681 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-06 02:47:17,681 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-06 02:47:17,774 - src.utils.mlflow_utils - INFO - Loading model version 6 from Production stage
2025-12-06 02:47:17,940 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-06 02:47:17,940 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v6
2025-12-06 02:47:17,940 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-06 02:47:17,940 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-06 02:47:17,940 - __main__ - INFO - Loaded 7 production models
2025-12-06 02:47:17,940 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:17,940 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-06 02:47:17,940 - __main__ - INFO - ======================================================================
2025-12-06 02:47:17,941 - src.models.predict - INFO - Preparing features for prediction
2025-12-06 02:47:17,941 - src.models.predict - INFO - Base date for predictions: 2025-12-06
2025-12-06 02:47:17,949 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-06 02:47:17,949 - src.models.predict - INFO - Prediction date range: 2025-12-07 to 2025-12-13
2025-12-06 02:47:17,949 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-06 02:47:17,949 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-06 02:47:17,949 - __main__ - INFO - Features prepared for next 7 days
2025-12-06 02:47:17,949 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-06 02:47:17,949 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:17,949 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-06 02:47:17,949 - __main__ - INFO - ======================================================================
2025-12-06 02:47:17,949 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-06 02:47:17,949 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-06 02:47:17,969 - src.models.predict - INFO - Generated 7 predictions
2025-12-06 02:47:17,969 - src.models.predict - INFO - Prediction range: 50.2 to 73.3 patients
2025-12-06 02:47:17,971 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-06 02:47:17,971 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-06 02:47:17,971 - __main__ - INFO -    Prediction range: 50.2 to 73.3 patients
2025-12-06 02:47:17,971 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:17,971 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-06 02:47:17,971 - __main__ - INFO - ======================================================================
2025-12-06 02:47:17,971 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-06 02:47:17,974 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251206_024717.csv
2025-12-06 02:47:17,974 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-06 02:47:17,974 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251206_024717.csv
2025-12-06 02:47:17,974 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 02:47:18,015 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 02:47:18,015 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 02:47:18,015 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:18,015 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-06 02:47:18,015 - __main__ - INFO - ======================================================================
2025-12-06 02:47:18,016 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-06 02:47:18,711 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 01afa9160fdd40459a6a6f301e137e4a
2025-12-06 02:47:18,766 - __main__ - INFO - Logged to MLflow run: 01afa9160fdd40459a6a6f301e137e4a
2025-12-06 02:47:18,767 - __main__ - INFO - 
======================================================================
2025-12-06 02:47:18,767 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-06 02:47:18,767 - __main__ - INFO - ======================================================================
2025-12-06 02:47:18,767 - __main__ - INFO - Average prediction: 63.5 patients
2025-12-06 02:47:18,767 - __main__ - INFO - Average interval width: 39.33210931337724
2025-12-06 02:47:18,767 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-06 02:47:18,768 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-06 03:05:13,940 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-06 03:05:13,940 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-06 03:05:13,940 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-06 03:05:13,940 - __main__ - INFO - ======================================================================
2025-12-06 03:05:13,941 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-06 03:05:13,941 - __main__ - INFO - ======================================================================
2025-12-06 03:05:13,941 - __main__ - INFO - Prediction base date: 2025-12-06
2025-12-06 03:05:13,941 - __main__ - INFO - Output path: data/predictions/
2025-12-06 03:05:13,941 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:13,941 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-06 03:05:13,941 - __main__ - INFO - ======================================================================
2025-12-06 03:05:13,941 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-06 03:05:13,941 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-06 03:05:17,253 - src.data.preprocessing - INFO - Successfully loaded 276,620 rows from database
2025-12-06 03:05:17,290 - __main__ - INFO - Successfully loaded 276,620 rows from database
2025-12-06 03:05:17,290 - src.data.preprocessing - INFO - Removing duplicates from 276,620 rows
2025-12-06 03:05:17,310 - src.data.preprocessing - WARNING - Found 199,537 duplicate rows (72.13%)
2025-12-06 03:05:17,314 - src.data.preprocessing - INFO - After removing duplicates: 77,083 rows remain
2025-12-06 03:05:17,316 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-06 03:05:17,382 - src.data.preprocessing - INFO - Aggregated to 1,283 days
2025-12-06 03:05:17,382 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-06 00:00:00
2025-12-06 03:05:17,383 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-06 03:05:17,383 - src.data.preprocessing - INFO - Min patients per day: 2
2025-12-06 03:05:17,383 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-06 03:05:17,385 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-06 03:05:17,387 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-06 03:05:17,390 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-06 03:05:17,390 - src.data.preprocessing - INFO - Final time series: 1,293 days from 2022-05-24 to 2025-12-06
2025-12-06 03:05:17,390 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-06 03:05:17,391 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-06 03:05:17,391 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-06 03:05:17,391 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-06 03:05:17,391 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-06 03:05:17,391 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-06 03:05:17,392 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-06 03:05:17,393 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 2 patients
2025-12-06 03:05:17,393 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-06 03:05:17,393 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-06 03:05:17,393 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-06 03:05:17,393 - __main__ - INFO - Loaded data: 1293 days up to 2025-12-06
2025-12-06 03:05:17,394 - __main__ - INFO - Data validation passed: 1293 rows, most recent date 2025-12-06 (0 days ago)
2025-12-06 03:05:17,394 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:17,394 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-06 03:05:17,394 - __main__ - INFO - ======================================================================
2025-12-06 03:05:17,394 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-06
2025-12-06 03:05:17,394 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 03:05:17,560 - src.data.weather_integration - INFO - Successfully fetched weather data: 1293 days
2025-12-06 03:05:17,561 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-06 03:05:17,562 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-06
2025-12-06 03:05:17,563 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-06
2025-12-06 03:05:17,564 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-06 03:05:17,564 - __main__ - INFO - Historical weather data: 1293 days
2025-12-06 03:05:17,564 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-06 03:05:17,564 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-06 03:05:17,697 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-06 03:05:17,698 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-06 03:05:17,698 - __main__ - INFO - Forecast date range: 2025-12-06 to 2025-12-13
2025-12-06 03:05:17,698 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:17,698 - __main__ - INFO - STEP 3: Engineering Features
2025-12-06 03:05:17,698 - __main__ - INFO - ======================================================================
2025-12-06 03:05:17,698 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-06 03:05:17,698 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-06 03:05:17,701 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-06 03:05:17,701 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-06 03:05:17,703 - src.data.feature_engineering - INFO - Weekend days: 369/1293 (28.5%)
2025-12-06 03:05:17,703 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-06 03:05:17,704 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-06 03:05:17,704 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-06 03:05:17,705 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-06 03:05:17,705 - src.data.feature_engineering - INFO - Adding change features
2025-12-06 03:05:17,706 - src.data.feature_engineering - INFO - Added change features
2025-12-06 03:05:17,706 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-06 03:05:17,706 - src.data.feature_engineering - INFO - Final shape: (1293, 35)
2025-12-06 03:05:17,706 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-06 03:05:17,706 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-06 03:05:17,707 - src.data.feature_engineering - INFO - Rows with NaN: 28/1293 (2.2%)
2025-12-06 03:05:17,707 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-06 03:05:17,707 - src.data.feature_engineering - INFO - Remaining rows: 1265
2025-12-06 03:05:17,707 - __main__ - INFO - Features engineered: (1265, 35)
2025-12-06 03:05:17,708 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:17,708 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-06 03:05:17,708 - __main__ - INFO - ======================================================================
2025-12-06 03:05:17,708 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-06 03:05:17,708 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-06 03:05:17,773 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-06 03:05:18,089 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-06 03:05:18,226 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-06 03:05:18,226 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v8
2025-12-06 03:05:18,226 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-06 03:05:18,226 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-06 03:05:18,284 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-06 03:05:18,451 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-06 03:05:18,451 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v8
2025-12-06 03:05:18,451 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-06 03:05:18,451 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-06 03:05:18,546 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-06 03:05:18,713 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-06 03:05:18,713 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v8
2025-12-06 03:05:18,713 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-06 03:05:18,713 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-06 03:05:18,806 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-06 03:05:18,987 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-06 03:05:18,987 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v8
2025-12-06 03:05:18,987 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-06 03:05:18,987 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-06 03:05:19,040 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-06 03:05:19,205 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-06 03:05:19,205 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v8
2025-12-06 03:05:19,205 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-06 03:05:19,205 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-06 03:05:19,299 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-06 03:05:19,467 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-06 03:05:19,467 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v8
2025-12-06 03:05:19,467 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-06 03:05:19,467 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-06 03:05:19,563 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-06 03:05:19,728 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-06 03:05:19,728 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v8
2025-12-06 03:05:19,728 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-06 03:05:19,728 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-06 03:05:19,729 - __main__ - INFO - Loaded 7 production models
2025-12-06 03:05:19,729 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:19,729 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-06 03:05:19,729 - __main__ - INFO - ======================================================================
2025-12-06 03:05:19,729 - src.models.predict - INFO - Preparing features for prediction
2025-12-06 03:05:19,729 - src.models.predict - INFO - Base date for predictions: 2025-12-06
2025-12-06 03:05:19,737 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-06 03:05:19,737 - src.models.predict - INFO - Prediction date range: 2025-12-07 to 2025-12-13
2025-12-06 03:05:19,737 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-06 03:05:19,737 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-06 03:05:19,737 - __main__ - INFO - Features prepared for next 7 days
2025-12-06 03:05:19,737 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-06 03:05:19,737 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:19,737 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-06 03:05:19,737 - __main__ - INFO - ======================================================================
2025-12-06 03:05:19,737 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-06 03:05:19,737 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-06 03:05:19,757 - src.models.predict - INFO - Generated 7 predictions
2025-12-06 03:05:19,757 - src.models.predict - INFO - Prediction range: 51.0 to 74.0 patients
2025-12-06 03:05:19,759 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-06 03:05:19,759 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-06 03:05:19,759 - __main__ - INFO -    Prediction range: 51.0 to 74.0 patients
2025-12-06 03:05:19,759 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:19,759 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-06 03:05:19,759 - __main__ - INFO - ======================================================================
2025-12-06 03:05:19,759 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-06 03:05:19,762 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251206_030519.csv
2025-12-06 03:05:19,762 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-06 03:05:19,762 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251206_030519.csv
2025-12-06 03:05:19,762 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 03:05:19,804 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 03:05:19,804 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-06 03:05:19,804 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:19,804 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-06 03:05:19,804 - __main__ - INFO - ======================================================================
2025-12-06 03:05:19,804 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-06 03:05:20,491 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 38516eb344a54a7fba89b3ed276db4b1
2025-12-06 03:05:20,545 - __main__ - INFO - Logged to MLflow run: 38516eb344a54a7fba89b3ed276db4b1
2025-12-06 03:05:20,546 - __main__ - INFO - 
======================================================================
2025-12-06 03:05:20,546 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-06 03:05:20,546 - __main__ - INFO - ======================================================================
2025-12-06 03:05:20,546 - __main__ - INFO - Average prediction: 63.9 patients
2025-12-06 03:05:20,546 - __main__ - INFO - Average interval width: 39.33116848471817
2025-12-06 03:05:20,546 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-06 03:05:20,547 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-08 13:29:44,558 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-08 13:29:44,558 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-08 13:29:44,558 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-08 13:29:44,558 - __main__ - INFO - ======================================================================
2025-12-08 13:29:44,558 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-08 13:29:44,558 - __main__ - INFO - ======================================================================
2025-12-08 13:29:44,558 - __main__ - INFO - Prediction base date: 2025-12-08
2025-12-08 13:29:44,558 - __main__ - INFO - Output path: data/predictions/
2025-12-08 13:29:44,558 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:44,558 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-08 13:29:44,558 - __main__ - INFO - ======================================================================
2025-12-08 13:29:44,558 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-08 13:29:44,559 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-08 13:29:46,299 - src.data.preprocessing - INFO - Successfully loaded 276,998 rows from database
2025-12-08 13:29:46,337 - __main__ - INFO - Successfully loaded 276,998 rows from database
2025-12-08 13:29:46,337 - src.data.preprocessing - INFO - Removing duplicates from 276,998 rows
2025-12-08 13:29:46,358 - src.data.preprocessing - WARNING - Found 199,820 duplicate rows (72.14%)
2025-12-08 13:29:46,361 - src.data.preprocessing - INFO - After removing duplicates: 77,178 rows remain
2025-12-08 13:29:46,364 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-08 13:29:46,381 - src.data.preprocessing - INFO - Aggregated to 1,285 days
2025-12-08 13:29:46,381 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-08 00:00:00
2025-12-08 13:29:46,381 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-08 13:29:46,381 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-08 13:29:46,381 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-08 13:29:46,382 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-08 13:29:46,431 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-08 13:29:46,435 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-08 13:29:46,435 - src.data.preprocessing - INFO - Final time series: 1,295 days from 2022-05-24 to 2025-12-08
2025-12-08 13:29:46,435 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-08 13:29:46,436 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-08 13:29:46,436 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-08 13:29:46,436 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-08 13:29:46,436 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-08 13:29:46,436 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-08 13:29:46,437 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-08 13:29:46,437 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-08 13:29:46,438 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-08 13:29:46,438 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-08 13:29:46,438 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-08 13:29:46,438 - __main__ - INFO - Loaded data: 1295 days up to 2025-12-08
2025-12-08 13:29:46,438 - __main__ - INFO - Data validation passed: 1295 rows, most recent date 2025-12-08 (0 days ago)
2025-12-08 13:29:46,438 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:46,438 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-08 13:29:46,438 - __main__ - INFO - ======================================================================
2025-12-08 13:29:46,438 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-08
2025-12-08 13:29:46,438 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 13:29:46,737 - src.data.weather_integration - INFO - Successfully fetched weather data: 1295 days
2025-12-08 13:29:46,738 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-08 13:29:46,739 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-08
2025-12-08 13:29:46,740 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-08
2025-12-08 13:29:46,741 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-08 13:29:46,741 - __main__ - INFO - Historical weather data: 1295 days
2025-12-08 13:29:46,741 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-08 13:29:46,741 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 13:29:46,934 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-08 13:29:46,935 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-08 13:29:46,935 - __main__ - INFO - Forecast date range: 2025-12-08 to 2025-12-15
2025-12-08 13:29:46,935 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:46,935 - __main__ - INFO - STEP 3: Engineering Features
2025-12-08 13:29:46,935 - __main__ - INFO - ======================================================================
2025-12-08 13:29:46,935 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-08 13:29:46,936 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-08 13:29:46,939 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-08 13:29:46,939 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-08 13:29:46,940 - src.data.feature_engineering - INFO - Weekend days: 370/1295 (28.6%)
2025-12-08 13:29:46,940 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-08 13:29:46,942 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-08 13:29:46,942 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-08 13:29:46,943 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-08 13:29:46,943 - src.data.feature_engineering - INFO - Adding change features
2025-12-08 13:29:46,943 - src.data.feature_engineering - INFO - Added change features
2025-12-08 13:29:46,943 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-08 13:29:46,943 - src.data.feature_engineering - INFO - Final shape: (1295, 35)
2025-12-08 13:29:46,943 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-08 13:29:46,944 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-08 13:29:46,944 - src.data.feature_engineering - INFO - Rows with NaN: 28/1295 (2.2%)
2025-12-08 13:29:46,945 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-08 13:29:46,945 - src.data.feature_engineering - INFO - Remaining rows: 1267
2025-12-08 13:29:46,945 - __main__ - INFO - Features engineered: (1267, 35)
2025-12-08 13:29:46,945 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:46,945 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-08 13:29:46,945 - __main__ - INFO - ======================================================================
2025-12-08 13:29:46,945 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-08 13:29:46,945 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-08 13:29:47,330 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 13:29:47,648 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-08 13:29:47,769 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-08 13:29:47,769 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v8
2025-12-08 13:29:47,769 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-08 13:29:47,769 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-08 13:29:47,822 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 13:29:47,989 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-08 13:29:47,989 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v8
2025-12-08 13:29:47,989 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-08 13:29:47,989 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-08 13:29:48,083 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 13:29:48,251 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-08 13:29:48,251 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v8
2025-12-08 13:29:48,251 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-08 13:29:48,251 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-08 13:29:48,343 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 13:29:48,507 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-08 13:29:48,507 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v8
2025-12-08 13:29:48,507 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-08 13:29:48,507 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-08 13:29:48,600 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 13:29:48,766 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-08 13:29:48,766 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v8
2025-12-08 13:29:48,766 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-08 13:29:48,766 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-08 13:29:48,859 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 13:29:49,025 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-08 13:29:49,026 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v8
2025-12-08 13:29:49,026 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-08 13:29:49,026 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-08 13:29:49,119 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 13:29:49,284 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-08 13:29:49,284 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v8
2025-12-08 13:29:49,284 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-08 13:29:49,284 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-08 13:29:49,284 - __main__ - INFO - Loaded 7 production models
2025-12-08 13:29:49,284 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:49,284 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-08 13:29:49,284 - __main__ - INFO - ======================================================================
2025-12-08 13:29:49,284 - src.models.predict - INFO - Preparing features for prediction
2025-12-08 13:29:49,284 - src.models.predict - INFO - Base date for predictions: 2025-12-08
2025-12-08 13:29:49,292 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-08 13:29:49,292 - src.models.predict - INFO - Prediction date range: 2025-12-09 to 2025-12-15
2025-12-08 13:29:49,292 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-08 13:29:49,292 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-08 13:29:49,292 - __main__ - INFO - Features prepared for next 7 days
2025-12-08 13:29:49,292 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-08 13:29:49,292 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:49,292 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-08 13:29:49,292 - __main__ - INFO - ======================================================================
2025-12-08 13:29:49,292 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-08 13:29:49,292 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-08 13:29:49,312 - src.models.predict - INFO - Generated 7 predictions
2025-12-08 13:29:49,312 - src.models.predict - INFO - Prediction range: 49.1 to 65.9 patients
2025-12-08 13:29:49,313 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-08 13:29:49,314 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-08 13:29:49,314 - __main__ - INFO -    Prediction range: 49.1 to 65.9 patients
2025-12-08 13:29:49,314 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:49,314 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-08 13:29:49,314 - __main__ - INFO - ======================================================================
2025-12-08 13:29:49,314 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-08 13:29:49,317 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251208_132949.csv
2025-12-08 13:29:49,317 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-08 13:29:49,317 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251208_132949.csv
2025-12-08 13:29:49,317 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 13:29:49,342 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 13:29:49,343 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 13:29:49,343 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:49,343 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-08 13:29:49,343 - __main__ - INFO - ======================================================================
2025-12-08 13:29:49,343 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-08 13:29:50,090 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 3cce1ca64dfc450e8089f89101d031b9
2025-12-08 13:29:50,147 - __main__ - INFO - Logged to MLflow run: 3cce1ca64dfc450e8089f89101d031b9
2025-12-08 13:29:50,148 - __main__ - INFO - 
======================================================================
2025-12-08 13:29:50,148 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-08 13:29:50,148 - __main__ - INFO - ======================================================================
2025-12-08 13:29:50,148 - __main__ - INFO - Average prediction: 58.9 patients
2025-12-08 13:29:50,148 - __main__ - INFO - Average interval width: 39.13712766231442
2025-12-08 13:29:50,148 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-08 13:29:50,149 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-08 14:14:06,413 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-08 14:14:06,413 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-08 14:14:06,413 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-08 14:14:06,413 - __main__ - INFO - ======================================================================
2025-12-08 14:14:06,413 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-08 14:14:06,413 - __main__ - INFO - ======================================================================
2025-12-08 14:14:06,414 - __main__ - INFO - Prediction base date: 2025-12-08
2025-12-08 14:14:06,414 - __main__ - INFO - Output path: data/predictions/
2025-12-08 14:14:06,414 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:06,414 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-08 14:14:06,414 - __main__ - INFO - ======================================================================
2025-12-08 14:14:06,414 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-08 14:14:06,414 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-08 14:14:08,108 - src.data.preprocessing - INFO - Successfully loaded 277,019 rows from database
2025-12-08 14:14:08,147 - __main__ - INFO - Successfully loaded 277,019 rows from database
2025-12-08 14:14:08,147 - src.data.preprocessing - INFO - Removing duplicates from 277,019 rows
2025-12-08 14:14:08,167 - src.data.preprocessing - WARNING - Found 199,836 duplicate rows (72.14%)
2025-12-08 14:14:08,170 - src.data.preprocessing - INFO - After removing duplicates: 77,183 rows remain
2025-12-08 14:14:08,173 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-08 14:14:08,238 - src.data.preprocessing - INFO - Aggregated to 1,285 days
2025-12-08 14:14:08,239 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-08 00:00:00
2025-12-08 14:14:08,239 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-08 14:14:08,239 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-08 14:14:08,239 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-08 14:14:08,241 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-08 14:14:08,242 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-08 14:14:08,246 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-08 14:14:08,246 - src.data.preprocessing - INFO - Final time series: 1,295 days from 2022-05-24 to 2025-12-08
2025-12-08 14:14:08,246 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-08 14:14:08,247 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-08 14:14:08,247 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-08 14:14:08,247 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-08 14:14:08,247 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-08 14:14:08,247 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-08 14:14:08,248 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-08 14:14:08,248 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-08 14:14:08,249 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-08 14:14:08,249 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-08 14:14:08,249 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-08 14:14:08,249 - __main__ - INFO - Loaded data: 1295 days up to 2025-12-08
2025-12-08 14:14:08,249 - __main__ - INFO - Data validation passed: 1295 rows, most recent date 2025-12-08 (0 days ago)
2025-12-08 14:14:08,249 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:08,249 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-08 14:14:08,249 - __main__ - INFO - ======================================================================
2025-12-08 14:14:08,249 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-08
2025-12-08 14:14:08,249 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 14:14:08,533 - src.data.weather_integration - INFO - Successfully fetched weather data: 1295 days
2025-12-08 14:14:08,534 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-08 14:14:08,536 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-08
2025-12-08 14:14:08,536 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-08
2025-12-08 14:14:08,537 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-08 14:14:08,537 - __main__ - INFO - Historical weather data: 1295 days
2025-12-08 14:14:08,537 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-08 14:14:08,537 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 14:14:08,660 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-08 14:14:08,661 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-08 14:14:08,661 - __main__ - INFO - Forecast date range: 2025-12-08 to 2025-12-15
2025-12-08 14:14:08,661 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:08,662 - __main__ - INFO - STEP 3: Engineering Features
2025-12-08 14:14:08,662 - __main__ - INFO - ======================================================================
2025-12-08 14:14:08,662 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-08 14:14:08,662 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-08 14:14:08,665 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-08 14:14:08,665 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-08 14:14:08,666 - src.data.feature_engineering - INFO - Weekend days: 370/1295 (28.6%)
2025-12-08 14:14:08,666 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-08 14:14:08,668 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-08 14:14:08,668 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-08 14:14:08,669 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-08 14:14:08,669 - src.data.feature_engineering - INFO - Adding change features
2025-12-08 14:14:08,669 - src.data.feature_engineering - INFO - Added change features
2025-12-08 14:14:08,670 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-08 14:14:08,670 - src.data.feature_engineering - INFO - Final shape: (1295, 35)
2025-12-08 14:14:08,670 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-08 14:14:08,670 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-08 14:14:08,670 - src.data.feature_engineering - INFO - Rows with NaN: 28/1295 (2.2%)
2025-12-08 14:14:08,671 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-08 14:14:08,671 - src.data.feature_engineering - INFO - Remaining rows: 1267
2025-12-08 14:14:08,671 - __main__ - INFO - Features engineered: (1267, 35)
2025-12-08 14:14:08,671 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:08,671 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-08 14:14:08,671 - __main__ - INFO - ======================================================================
2025-12-08 14:14:08,671 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-08 14:14:08,671 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-08 14:14:08,736 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:14:09,049 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-08 14:14:09,169 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-08 14:14:09,169 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v8
2025-12-08 14:14:09,169 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-08 14:14:09,169 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-08 14:14:09,221 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:14:09,387 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-08 14:14:09,387 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v8
2025-12-08 14:14:09,387 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-08 14:14:09,387 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-08 14:14:09,478 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:14:09,642 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-08 14:14:09,642 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v8
2025-12-08 14:14:09,642 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-08 14:14:09,642 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-08 14:14:09,735 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:14:09,899 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-08 14:14:09,900 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v8
2025-12-08 14:14:09,900 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-08 14:14:09,900 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-08 14:14:09,993 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:14:10,159 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-08 14:14:10,159 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v8
2025-12-08 14:14:10,159 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-08 14:14:10,159 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-08 14:14:10,252 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:14:10,419 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-08 14:14:10,419 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v8
2025-12-08 14:14:10,419 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-08 14:14:10,419 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-08 14:14:10,512 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:14:10,679 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-08 14:14:10,679 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v8
2025-12-08 14:14:10,679 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-08 14:14:10,679 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-08 14:14:10,679 - __main__ - INFO - Loaded 7 production models
2025-12-08 14:14:10,679 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:10,679 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-08 14:14:10,679 - __main__ - INFO - ======================================================================
2025-12-08 14:14:10,679 - src.models.predict - INFO - Preparing features for prediction
2025-12-08 14:14:10,679 - src.models.predict - INFO - Base date for predictions: 2025-12-08
2025-12-08 14:14:10,687 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-08 14:14:10,687 - src.models.predict - INFO - Prediction date range: 2025-12-09 to 2025-12-15
2025-12-08 14:14:10,687 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-08 14:14:10,687 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-08 14:14:10,688 - __main__ - INFO - Features prepared for next 7 days
2025-12-08 14:14:10,688 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-08 14:14:10,688 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:10,688 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-08 14:14:10,688 - __main__ - INFO - ======================================================================
2025-12-08 14:14:10,688 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-08 14:14:10,688 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-08 14:14:10,707 - src.models.predict - INFO - Generated 7 predictions
2025-12-08 14:14:10,708 - src.models.predict - INFO - Prediction range: 49.1 to 65.9 patients
2025-12-08 14:14:10,709 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-08 14:14:10,709 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-08 14:14:10,709 - __main__ - INFO -    Prediction range: 49.1 to 65.9 patients
2025-12-08 14:14:10,709 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:10,709 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-08 14:14:10,709 - __main__ - INFO - ======================================================================
2025-12-08 14:14:10,709 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-08 14:14:10,712 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251208_141410.csv
2025-12-08 14:14:10,712 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-08 14:14:10,712 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251208_141410.csv
2025-12-08 14:14:10,712 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:14:10,737 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:14:10,737 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:14:10,737 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:10,737 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-08 14:14:10,737 - __main__ - INFO - ======================================================================
2025-12-08 14:14:10,737 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-08 14:14:11,431 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: c8c09dc42ef94ebe9d2bb4b6ee342c63
2025-12-08 14:14:11,485 - __main__ - INFO - Logged to MLflow run: c8c09dc42ef94ebe9d2bb4b6ee342c63
2025-12-08 14:14:11,486 - __main__ - INFO - 
======================================================================
2025-12-08 14:14:11,486 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-08 14:14:11,486 - __main__ - INFO - ======================================================================
2025-12-08 14:14:11,486 - __main__ - INFO - Average prediction: 58.9 patients
2025-12-08 14:14:11,486 - __main__ - INFO - Average interval width: 39.13712766231442
2025-12-08 14:14:11,486 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-08 14:14:11,487 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-08 14:33:05,713 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-08 14:33:05,713 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-08 14:33:05,713 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-08 14:33:05,713 - __main__ - INFO - ======================================================================
2025-12-08 14:33:05,713 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-08 14:33:05,713 - __main__ - INFO - ======================================================================
2025-12-08 14:33:05,713 - __main__ - INFO - Prediction base date: 2025-12-08
2025-12-08 14:33:05,713 - __main__ - INFO - Output path: data/predictions/
2025-12-08 14:33:05,713 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:05,713 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-08 14:33:05,713 - __main__ - INFO - ======================================================================
2025-12-08 14:33:05,713 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-08 14:33:05,714 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-08 14:33:07,483 - src.data.preprocessing - INFO - Successfully loaded 277,019 rows from database
2025-12-08 14:33:07,517 - __main__ - INFO - Successfully loaded 277,019 rows from database
2025-12-08 14:33:07,517 - src.data.preprocessing - INFO - Removing duplicates from 277,019 rows
2025-12-08 14:33:07,533 - src.data.preprocessing - WARNING - Found 199,836 duplicate rows (72.14%)
2025-12-08 14:33:07,536 - src.data.preprocessing - INFO - After removing duplicates: 77,183 rows remain
2025-12-08 14:33:07,538 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-08 14:33:07,600 - src.data.preprocessing - INFO - Aggregated to 1,285 days
2025-12-08 14:33:07,600 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-08 00:00:00
2025-12-08 14:33:07,600 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-08 14:33:07,600 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-08 14:33:07,600 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-08 14:33:07,602 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-08 14:33:07,604 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-08 14:33:07,607 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-08 14:33:07,607 - src.data.preprocessing - INFO - Final time series: 1,295 days from 2022-05-24 to 2025-12-08
2025-12-08 14:33:07,607 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-08 14:33:07,608 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-08 14:33:07,608 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-08 14:33:07,608 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-08 14:33:07,608 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-08 14:33:07,608 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-08 14:33:07,609 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-08 14:33:07,610 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-08 14:33:07,610 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-08 14:33:07,610 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-08 14:33:07,610 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-08 14:33:07,610 - __main__ - INFO - Loaded data: 1295 days up to 2025-12-08
2025-12-08 14:33:07,610 - __main__ - INFO - Data validation passed: 1295 rows, most recent date 2025-12-08 (0 days ago)
2025-12-08 14:33:07,610 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:07,610 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-08 14:33:07,610 - __main__ - INFO - ======================================================================
2025-12-08 14:33:07,611 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-08
2025-12-08 14:33:07,611 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 14:33:07,994 - src.data.weather_integration - INFO - Successfully fetched weather data: 1295 days
2025-12-08 14:33:07,995 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-08 14:33:07,996 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-08
2025-12-08 14:33:07,996 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-08
2025-12-08 14:33:07,998 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-08 14:33:07,998 - __main__ - INFO - Historical weather data: 1295 days
2025-12-08 14:33:07,998 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-08 14:33:07,998 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 14:33:08,197 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-08 14:33:08,198 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-08 14:33:08,198 - __main__ - INFO - Forecast date range: 2025-12-08 to 2025-12-15
2025-12-08 14:33:08,198 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:08,198 - __main__ - INFO - STEP 3: Engineering Features
2025-12-08 14:33:08,198 - __main__ - INFO - ======================================================================
2025-12-08 14:33:08,198 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-08 14:33:08,198 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-08 14:33:08,202 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-08 14:33:08,202 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-08 14:33:08,203 - src.data.feature_engineering - INFO - Weekend days: 370/1295 (28.6%)
2025-12-08 14:33:08,203 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-08 14:33:08,204 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-08 14:33:08,204 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-08 14:33:08,206 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-08 14:33:08,206 - src.data.feature_engineering - INFO - Adding change features
2025-12-08 14:33:08,206 - src.data.feature_engineering - INFO - Added change features
2025-12-08 14:33:08,206 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-08 14:33:08,206 - src.data.feature_engineering - INFO - Final shape: (1295, 35)
2025-12-08 14:33:08,206 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-08 14:33:08,207 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-08 14:33:08,207 - src.data.feature_engineering - INFO - Rows with NaN: 28/1295 (2.2%)
2025-12-08 14:33:08,208 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-08 14:33:08,208 - src.data.feature_engineering - INFO - Remaining rows: 1267
2025-12-08 14:33:08,208 - __main__ - INFO - Features engineered: (1267, 35)
2025-12-08 14:33:08,208 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:08,208 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-08 14:33:08,208 - __main__ - INFO - ======================================================================
2025-12-08 14:33:08,208 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-08 14:33:08,208 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-08 14:33:08,272 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:33:08,585 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-08 14:33:08,706 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-08 14:33:08,706 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v8
2025-12-08 14:33:08,706 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-08 14:33:08,706 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-08 14:33:08,759 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:33:08,924 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-08 14:33:08,924 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v8
2025-12-08 14:33:08,924 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-08 14:33:08,924 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-08 14:33:09,018 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:33:09,183 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-08 14:33:09,183 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v8
2025-12-08 14:33:09,183 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-08 14:33:09,183 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-08 14:33:09,279 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:33:09,444 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-08 14:33:09,444 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v8
2025-12-08 14:33:09,444 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-08 14:33:09,444 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-08 14:33:09,538 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:33:09,703 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-08 14:33:09,703 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v8
2025-12-08 14:33:09,703 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-08 14:33:09,703 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-08 14:33:09,798 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:33:09,963 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-08 14:33:09,963 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v8
2025-12-08 14:33:09,964 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-08 14:33:09,964 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-08 14:33:10,057 - src.utils.mlflow_utils - INFO - Loading model version 8 from Production stage
2025-12-08 14:33:10,224 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-08 14:33:10,224 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v8
2025-12-08 14:33:10,224 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-08 14:33:10,224 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-08 14:33:10,224 - __main__ - INFO - Loaded 7 production models
2025-12-08 14:33:10,224 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:10,224 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-08 14:33:10,224 - __main__ - INFO - ======================================================================
2025-12-08 14:33:10,224 - src.models.predict - INFO - Preparing features for prediction
2025-12-08 14:33:10,224 - src.models.predict - INFO - Base date for predictions: 2025-12-08
2025-12-08 14:33:10,232 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-08 14:33:10,232 - src.models.predict - INFO - Prediction date range: 2025-12-09 to 2025-12-15
2025-12-08 14:33:10,232 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-08 14:33:10,233 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-08 14:33:10,233 - __main__ - INFO - Features prepared for next 7 days
2025-12-08 14:33:10,233 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-08 14:33:10,233 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:10,233 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-08 14:33:10,233 - __main__ - INFO - ======================================================================
2025-12-08 14:33:10,233 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-08 14:33:10,233 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-08 14:33:10,253 - src.models.predict - INFO - Generated 7 predictions
2025-12-08 14:33:10,253 - src.models.predict - INFO - Prediction range: 49.1 to 65.9 patients
2025-12-08 14:33:10,254 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-08 14:33:10,255 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-08 14:33:10,255 - __main__ - INFO -    Prediction range: 49.1 to 65.9 patients
2025-12-08 14:33:10,255 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:10,255 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-08 14:33:10,255 - __main__ - INFO - ======================================================================
2025-12-08 14:33:10,255 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-08 14:33:10,258 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251208_143310.csv
2025-12-08 14:33:10,258 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-08 14:33:10,258 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251208_143310.csv
2025-12-08 14:33:10,258 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:33:10,279 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:33:10,279 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:33:10,279 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:10,279 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-08 14:33:10,279 - __main__ - INFO - ======================================================================
2025-12-08 14:33:10,279 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-08 14:33:10,973 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: df1665fda7774f3596dd6b49cd0bb052
2025-12-08 14:33:11,028 - __main__ - INFO - Logged to MLflow run: df1665fda7774f3596dd6b49cd0bb052
2025-12-08 14:33:11,029 - __main__ - INFO - 
======================================================================
2025-12-08 14:33:11,029 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-08 14:33:11,029 - __main__ - INFO - ======================================================================
2025-12-08 14:33:11,029 - __main__ - INFO - Average prediction: 58.9 patients
2025-12-08 14:33:11,029 - __main__ - INFO - Average interval width: 39.13712766231442
2025-12-08 14:33:11,029 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-08 14:33:11,030 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-08 14:46:28,023 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-08 14:46:28,023 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-08 14:46:28,023 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-08 14:46:28,023 - __main__ - INFO - ======================================================================
2025-12-08 14:46:28,023 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-08 14:46:28,023 - __main__ - INFO - ======================================================================
2025-12-08 14:46:28,023 - __main__ - INFO - Prediction base date: 2025-12-08
2025-12-08 14:46:28,023 - __main__ - INFO - Output path: data/predictions/
2025-12-08 14:46:28,023 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:28,023 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-08 14:46:28,023 - __main__ - INFO - ======================================================================
2025-12-08 14:46:28,023 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-08 14:46:28,024 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-08 14:46:29,704 - src.data.preprocessing - INFO - Successfully loaded 277,019 rows from database
2025-12-08 14:46:29,748 - __main__ - INFO - Successfully loaded 277,019 rows from database
2025-12-08 14:46:29,748 - src.data.preprocessing - INFO - Removing duplicates from 277,019 rows
2025-12-08 14:46:29,767 - src.data.preprocessing - WARNING - Found 199,836 duplicate rows (72.14%)
2025-12-08 14:46:29,770 - src.data.preprocessing - INFO - After removing duplicates: 77,183 rows remain
2025-12-08 14:46:29,772 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-08 14:46:29,838 - src.data.preprocessing - INFO - Aggregated to 1,285 days
2025-12-08 14:46:29,838 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-08 00:00:00
2025-12-08 14:46:29,838 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-08 14:46:29,838 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-08 14:46:29,838 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-08 14:46:29,840 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-08 14:46:29,842 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-08 14:46:29,845 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-08 14:46:29,845 - src.data.preprocessing - INFO - Final time series: 1,295 days from 2022-05-24 to 2025-12-08
2025-12-08 14:46:29,845 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-08 14:46:29,846 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-08 14:46:29,846 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-08 14:46:29,846 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-08 14:46:29,846 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-08 14:46:29,846 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-08 14:46:29,847 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-08 14:46:29,848 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-08 14:46:29,848 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-08 14:46:29,848 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-08 14:46:29,848 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-08 14:46:29,848 - __main__ - INFO - Loaded data: 1295 days up to 2025-12-08
2025-12-08 14:46:29,849 - __main__ - INFO - Data validation passed: 1295 rows, most recent date 2025-12-08 (0 days ago)
2025-12-08 14:46:29,849 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:29,849 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-08 14:46:29,849 - __main__ - INFO - ======================================================================
2025-12-08 14:46:29,849 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-08
2025-12-08 14:46:29,849 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 14:46:30,121 - src.data.weather_integration - INFO - Successfully fetched weather data: 1295 days
2025-12-08 14:46:30,121 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-08 14:46:30,123 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-08
2025-12-08 14:46:30,123 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-08
2025-12-08 14:46:30,124 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-08 14:46:30,125 - __main__ - INFO - Historical weather data: 1295 days
2025-12-08 14:46:30,125 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-08 14:46:30,125 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-08 14:46:30,249 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-08 14:46:30,250 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-08 14:46:30,250 - __main__ - INFO - Forecast date range: 2025-12-08 to 2025-12-15
2025-12-08 14:46:30,250 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:30,250 - __main__ - INFO - STEP 3: Engineering Features
2025-12-08 14:46:30,250 - __main__ - INFO - ======================================================================
2025-12-08 14:46:30,250 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-08 14:46:30,251 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-08 14:46:30,254 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-08 14:46:30,254 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-08 14:46:30,255 - src.data.feature_engineering - INFO - Weekend days: 370/1295 (28.6%)
2025-12-08 14:46:30,255 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-08 14:46:30,257 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-08 14:46:30,257 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-08 14:46:30,258 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-08 14:46:30,258 - src.data.feature_engineering - INFO - Adding change features
2025-12-08 14:46:30,258 - src.data.feature_engineering - INFO - Added change features
2025-12-08 14:46:30,258 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-08 14:46:30,258 - src.data.feature_engineering - INFO - Final shape: (1295, 35)
2025-12-08 14:46:30,258 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-08 14:46:30,259 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-08 14:46:30,259 - src.data.feature_engineering - INFO - Rows with NaN: 28/1295 (2.2%)
2025-12-08 14:46:30,260 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-08 14:46:30,260 - src.data.feature_engineering - INFO - Remaining rows: 1267
2025-12-08 14:46:30,260 - __main__ - INFO - Features engineered: (1267, 35)
2025-12-08 14:46:30,260 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:30,260 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-08 14:46:30,260 - __main__ - INFO - ======================================================================
2025-12-08 14:46:30,260 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-08 14:46:30,260 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-08 14:46:30,325 - src.utils.mlflow_utils - INFO - Loading model version 9 from Production stage
2025-12-08 14:46:30,639 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-08 14:46:30,759 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-08 14:46:30,759 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v9
2025-12-08 14:46:30,759 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-08 14:46:30,759 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-08 14:46:30,872 - src.utils.mlflow_utils - INFO - Loading model version 9 from Production stage
2025-12-08 14:46:31,042 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-08 14:46:31,042 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v9
2025-12-08 14:46:31,042 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-08 14:46:31,042 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-08 14:46:31,135 - src.utils.mlflow_utils - INFO - Loading model version 9 from Production stage
2025-12-08 14:46:31,300 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-08 14:46:31,300 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v9
2025-12-08 14:46:31,300 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-08 14:46:31,300 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-08 14:46:31,394 - src.utils.mlflow_utils - INFO - Loading model version 9 from Production stage
2025-12-08 14:46:31,559 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-08 14:46:31,559 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v9
2025-12-08 14:46:31,559 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-08 14:46:31,559 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-08 14:46:31,653 - src.utils.mlflow_utils - INFO - Loading model version 9 from Production stage
2025-12-08 14:46:31,817 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-08 14:46:31,818 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v9
2025-12-08 14:46:31,818 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-08 14:46:31,818 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-08 14:46:31,914 - src.utils.mlflow_utils - INFO - Loading model version 9 from Production stage
2025-12-08 14:46:32,080 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-08 14:46:32,080 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v9
2025-12-08 14:46:32,080 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-08 14:46:32,080 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-08 14:46:32,173 - src.utils.mlflow_utils - INFO - Loading model version 9 from Production stage
2025-12-08 14:46:32,339 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-08 14:46:32,339 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v9
2025-12-08 14:46:32,339 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-08 14:46:32,339 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-08 14:46:32,339 - __main__ - INFO - Loaded 7 production models
2025-12-08 14:46:32,339 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:32,339 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-08 14:46:32,339 - __main__ - INFO - ======================================================================
2025-12-08 14:46:32,339 - src.models.predict - INFO - Preparing features for prediction
2025-12-08 14:46:32,339 - src.models.predict - INFO - Base date for predictions: 2025-12-08
2025-12-08 14:46:32,347 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-08 14:46:32,347 - src.models.predict - INFO - Prediction date range: 2025-12-09 to 2025-12-15
2025-12-08 14:46:32,347 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-08 14:46:32,347 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-08 14:46:32,347 - __main__ - INFO - Features prepared for next 7 days
2025-12-08 14:46:32,348 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-08 14:46:32,348 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:32,348 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-08 14:46:32,348 - __main__ - INFO - ======================================================================
2025-12-08 14:46:32,348 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-08 14:46:32,348 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-08 14:46:32,367 - src.models.predict - INFO - Generated 7 predictions
2025-12-08 14:46:32,368 - src.models.predict - INFO - Prediction range: 49.3 to 65.8 patients
2025-12-08 14:46:32,369 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-08 14:46:32,369 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-08 14:46:32,369 - __main__ - INFO -    Prediction range: 49.3 to 65.8 patients
2025-12-08 14:46:32,369 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:32,369 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-08 14:46:32,369 - __main__ - INFO - ======================================================================
2025-12-08 14:46:32,369 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-08 14:46:32,372 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251208_144632.csv
2025-12-08 14:46:32,372 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-08 14:46:32,372 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251208_144632.csv
2025-12-08 14:46:32,372 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:46:32,394 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:46:32,394 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-08 14:46:32,394 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:32,394 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-08 14:46:32,394 - __main__ - INFO - ======================================================================
2025-12-08 14:46:32,394 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-08 14:46:33,064 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: b7d1d9998ab1402a8eaaff374c01e7e8
2025-12-08 14:46:33,116 - __main__ - INFO - Logged to MLflow run: b7d1d9998ab1402a8eaaff374c01e7e8
2025-12-08 14:46:33,117 - __main__ - INFO - 
======================================================================
2025-12-08 14:46:33,117 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-08 14:46:33,117 - __main__ - INFO - ======================================================================
2025-12-08 14:46:33,117 - __main__ - INFO - Average prediction: 59.1 patients
2025-12-08 14:46:33,117 - __main__ - INFO - Average interval width: 38.27011808154877
2025-12-08 14:46:33,117 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-08 14:46:33,118 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-09 02:00:06,036 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-09 02:00:06,036 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-09 02:00:06,036 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-09 02:00:06,036 - __main__ - INFO - ======================================================================
2025-12-09 02:00:06,036 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-09 02:00:06,036 - __main__ - INFO - ======================================================================
2025-12-09 02:00:06,036 - __main__ - INFO - Prediction base date: 2025-12-09
2025-12-09 02:00:06,036 - __main__ - INFO - Output path: data/predictions/
2025-12-09 02:00:06,036 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:06,036 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-09 02:00:06,036 - __main__ - INFO - ======================================================================
2025-12-09 02:00:06,036 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-09 02:00:06,037 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-09 02:00:08,492 - src.data.preprocessing - INFO - Successfully loaded 277,155 rows from database
2025-12-09 02:00:08,532 - __main__ - INFO - Successfully loaded 277,155 rows from database
2025-12-09 02:00:08,532 - src.data.preprocessing - INFO - Removing duplicates from 277,155 rows
2025-12-09 02:00:08,551 - src.data.preprocessing - WARNING - Found 199,937 duplicate rows (72.14%)
2025-12-09 02:00:08,554 - src.data.preprocessing - INFO - After removing duplicates: 77,218 rows remain
2025-12-09 02:00:08,556 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-09 02:00:08,573 - src.data.preprocessing - INFO - Aggregated to 1,285 days
2025-12-09 02:00:08,573 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-08 00:00:00
2025-12-09 02:00:08,574 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-09 02:00:08,574 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-09 02:00:08,574 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-09 02:00:08,575 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-09 02:00:08,624 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-09 02:00:08,628 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-09 02:00:08,628 - src.data.preprocessing - INFO - Final time series: 1,295 days from 2022-05-24 to 2025-12-08
2025-12-09 02:00:08,628 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-09 02:00:08,629 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-09 02:00:08,629 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-09 02:00:08,629 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-09 02:00:08,629 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-09 02:00:08,629 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-09 02:00:08,630 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-09 02:00:08,631 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-09 02:00:08,631 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-09 02:00:08,631 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-09 02:00:08,631 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-09 02:00:08,631 - __main__ - INFO - Loaded data: 1295 days up to 2025-12-08
2025-12-09 02:00:08,632 - __main__ - INFO - Data validation passed: 1295 rows, most recent date 2025-12-08 (1 days ago)
2025-12-09 02:00:08,632 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:08,632 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-09 02:00:08,632 - __main__ - INFO - ======================================================================
2025-12-09 02:00:08,632 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-09
2025-12-09 02:00:08,632 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-09 02:00:09,419 - src.data.weather_integration - INFO - Successfully fetched weather data: 1296 days
2025-12-09 02:00:09,420 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-09 02:00:09,421 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-08
2025-12-09 02:00:09,422 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-09
2025-12-09 02:00:09,423 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-09 02:00:09,423 - __main__ - INFO - Historical weather data: 1296 days
2025-12-09 02:00:09,423 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-09 02:00:09,423 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-09 02:00:10,740 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-09 02:00:10,741 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-09 02:00:10,741 - __main__ - INFO - Forecast date range: 2025-12-09 to 2025-12-16
2025-12-09 02:00:10,741 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:10,741 - __main__ - INFO - STEP 3: Engineering Features
2025-12-09 02:00:10,741 - __main__ - INFO - ======================================================================
2025-12-09 02:00:10,741 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-09 02:00:10,741 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-09 02:00:10,745 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-09 02:00:10,745 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-09 02:00:10,746 - src.data.feature_engineering - INFO - Weekend days: 370/1295 (28.6%)
2025-12-09 02:00:10,746 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-09 02:00:10,747 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-09 02:00:10,747 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-09 02:00:10,749 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-09 02:00:10,749 - src.data.feature_engineering - INFO - Adding change features
2025-12-09 02:00:10,749 - src.data.feature_engineering - INFO - Added change features
2025-12-09 02:00:10,749 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-09 02:00:10,749 - src.data.feature_engineering - INFO - Final shape: (1295, 35)
2025-12-09 02:00:10,749 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-09 02:00:10,750 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-09 02:00:10,750 - src.data.feature_engineering - INFO - Rows with NaN: 28/1295 (2.2%)
2025-12-09 02:00:10,751 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-09 02:00:10,751 - src.data.feature_engineering - INFO - Remaining rows: 1267
2025-12-09 02:00:10,751 - __main__ - INFO - Features engineered: (1267, 35)
2025-12-09 02:00:10,751 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:10,751 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-09 02:00:10,751 - __main__ - INFO - ======================================================================
2025-12-09 02:00:10,751 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-09 02:00:10,751 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-09 02:00:11,129 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 02:00:11,446 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-09 02:00:11,567 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-09 02:00:11,567 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v10
2025-12-09 02:00:11,567 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-09 02:00:11,567 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-09 02:00:11,620 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 02:00:11,786 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-09 02:00:11,787 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v10
2025-12-09 02:00:11,787 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-09 02:00:11,787 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-09 02:00:11,879 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 02:00:12,046 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-09 02:00:12,046 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v10
2025-12-09 02:00:12,046 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-09 02:00:12,046 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-09 02:00:12,140 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 02:00:12,305 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-09 02:00:12,305 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v10
2025-12-09 02:00:12,305 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-09 02:00:12,305 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-09 02:00:12,399 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 02:00:12,565 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-09 02:00:12,565 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v10
2025-12-09 02:00:12,565 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-09 02:00:12,565 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-09 02:00:12,659 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 02:00:12,825 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-09 02:00:12,825 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v10
2025-12-09 02:00:12,825 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-09 02:00:12,825 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-09 02:00:12,917 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 02:00:13,083 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-09 02:00:13,083 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v10
2025-12-09 02:00:13,083 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-09 02:00:13,083 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-09 02:00:13,083 - __main__ - INFO - Loaded 7 production models
2025-12-09 02:00:13,083 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:13,083 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-09 02:00:13,083 - __main__ - INFO - ======================================================================
2025-12-09 02:00:13,083 - src.models.predict - INFO - Preparing features for prediction
2025-12-09 02:00:13,083 - src.models.predict - INFO - Base date for predictions: 2025-12-09
2025-12-09 02:00:13,091 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-09 02:00:13,091 - src.models.predict - INFO - Prediction date range: 2025-12-10 to 2025-12-16
2025-12-09 02:00:13,091 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-09 02:00:13,092 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-09 02:00:13,092 - __main__ - INFO - Features prepared for next 7 days
2025-12-09 02:00:13,092 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-09 02:00:13,092 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:13,092 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-09 02:00:13,092 - __main__ - INFO - ======================================================================
2025-12-09 02:00:13,092 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-09 02:00:13,092 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-09 02:00:13,112 - src.models.predict - INFO - Generated 7 predictions
2025-12-09 02:00:13,112 - src.models.predict - INFO - Prediction range: 47.5 to 65.2 patients
2025-12-09 02:00:13,113 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-09 02:00:13,113 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-09 02:00:13,113 - __main__ - INFO -    Prediction range: 47.5 to 65.2 patients
2025-12-09 02:00:13,113 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:13,113 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-09 02:00:13,113 - __main__ - INFO - ======================================================================
2025-12-09 02:00:13,113 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-09 02:00:13,116 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251209_020013.csv
2025-12-09 02:00:13,116 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-09 02:00:13,116 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251209_020013.csv
2025-12-09 02:00:13,116 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-09 02:00:13,165 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-09 02:00:13,165 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-09 02:00:13,165 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:13,165 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-09 02:00:13,165 - __main__ - INFO - ======================================================================
2025-12-09 02:00:13,165 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-09 02:00:13,905 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 9ae34313331c448c8816954102ed2455
2025-12-09 02:00:13,961 - __main__ - INFO - Logged to MLflow run: 9ae34313331c448c8816954102ed2455
2025-12-09 02:00:13,962 - __main__ - INFO - 
======================================================================
2025-12-09 02:00:13,962 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-09 02:00:13,962 - __main__ - INFO - ======================================================================
2025-12-09 02:00:13,962 - __main__ - INFO - Average prediction: 58.8 patients
2025-12-09 02:00:13,962 - __main__ - INFO - Average interval width: 37.775130202986794
2025-12-09 02:00:13,962 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-09 02:00:13,964 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-09 18:05:35,524 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-09 18:05:35,524 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-09 18:05:35,524 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-09 18:05:35,525 - __main__ - INFO - ======================================================================
2025-12-09 18:05:35,525 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-09 18:05:35,525 - __main__ - INFO - ======================================================================
2025-12-09 18:05:35,525 - __main__ - INFO - Prediction base date: 2025-12-09
2025-12-09 18:05:35,525 - __main__ - INFO - Output path: data/predictions/
2025-12-09 18:05:35,525 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:35,525 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-09 18:05:35,525 - __main__ - INFO - ======================================================================
2025-12-09 18:05:35,525 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-09 18:05:35,526 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-09 18:05:37,277 - src.data.preprocessing - INFO - Successfully loaded 277,319 rows from database
2025-12-09 18:05:37,319 - __main__ - INFO - Successfully loaded 277,319 rows from database
2025-12-09 18:05:37,320 - src.data.preprocessing - INFO - Removing duplicates from 277,319 rows
2025-12-09 18:05:37,338 - src.data.preprocessing - WARNING - Found 200,049 duplicate rows (72.14%)
2025-12-09 18:05:37,342 - src.data.preprocessing - INFO - After removing duplicates: 77,270 rows remain
2025-12-09 18:05:37,344 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-09 18:05:37,409 - src.data.preprocessing - INFO - Aggregated to 1,286 days
2025-12-09 18:05:37,409 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-09 00:00:00
2025-12-09 18:05:37,409 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-09 18:05:37,409 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-09 18:05:37,409 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-09 18:05:37,411 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-09 18:05:37,413 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-09 18:05:37,416 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-09 18:05:37,417 - src.data.preprocessing - INFO - Final time series: 1,296 days from 2022-05-24 to 2025-12-09
2025-12-09 18:05:37,417 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-09 18:05:37,418 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-09 18:05:37,418 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-09 18:05:37,418 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-09 18:05:37,418 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-09 18:05:37,418 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-09 18:05:37,419 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-09 18:05:37,419 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-09 18:05:37,419 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-09 18:05:37,419 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-09 18:05:37,420 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-09 18:05:37,420 - __main__ - INFO - Loaded data: 1296 days up to 2025-12-09
2025-12-09 18:05:37,420 - __main__ - INFO - Data validation passed: 1296 rows, most recent date 2025-12-09 (0 days ago)
2025-12-09 18:05:37,420 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:37,420 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-09 18:05:37,420 - __main__ - INFO - ======================================================================
2025-12-09 18:05:37,420 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-09
2025-12-09 18:05:37,420 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-09 18:05:37,796 - src.data.weather_integration - INFO - Successfully fetched weather data: 1296 days
2025-12-09 18:05:37,797 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-09 18:05:37,799 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-09
2025-12-09 18:05:37,799 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-09
2025-12-09 18:05:37,800 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-09 18:05:37,800 - __main__ - INFO - Historical weather data: 1296 days
2025-12-09 18:05:37,800 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-09 18:05:37,800 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-09 18:05:38,008 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-09 18:05:38,009 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-09 18:05:38,009 - __main__ - INFO - Forecast date range: 2025-12-09 to 2025-12-16
2025-12-09 18:05:38,009 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:38,009 - __main__ - INFO - STEP 3: Engineering Features
2025-12-09 18:05:38,009 - __main__ - INFO - ======================================================================
2025-12-09 18:05:38,009 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-09 18:05:38,009 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-09 18:05:38,013 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-09 18:05:38,013 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-09 18:05:38,014 - src.data.feature_engineering - INFO - Weekend days: 370/1296 (28.5%)
2025-12-09 18:05:38,014 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-09 18:05:38,015 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-09 18:05:38,015 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-09 18:05:38,016 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-09 18:05:38,017 - src.data.feature_engineering - INFO - Adding change features
2025-12-09 18:05:38,017 - src.data.feature_engineering - INFO - Added change features
2025-12-09 18:05:38,017 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-09 18:05:38,017 - src.data.feature_engineering - INFO - Final shape: (1296, 35)
2025-12-09 18:05:38,017 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-09 18:05:38,017 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-09 18:05:38,018 - src.data.feature_engineering - INFO - Rows with NaN: 28/1296 (2.2%)
2025-12-09 18:05:38,018 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-09 18:05:38,019 - src.data.feature_engineering - INFO - Remaining rows: 1268
2025-12-09 18:05:38,019 - __main__ - INFO - Features engineered: (1268, 35)
2025-12-09 18:05:38,019 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:38,019 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-09 18:05:38,019 - __main__ - INFO - ======================================================================
2025-12-09 18:05:38,019 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-09 18:05:38,019 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-09 18:05:38,405 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 18:05:38,722 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-09 18:05:38,843 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-09 18:05:38,843 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v10
2025-12-09 18:05:38,843 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-09 18:05:38,843 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-09 18:05:38,897 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 18:05:39,064 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-09 18:05:39,064 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v10
2025-12-09 18:05:39,064 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-09 18:05:39,064 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-09 18:05:39,158 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 18:05:39,324 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-09 18:05:39,324 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v10
2025-12-09 18:05:39,324 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-09 18:05:39,324 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-09 18:05:39,417 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 18:05:39,582 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-09 18:05:39,582 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v10
2025-12-09 18:05:39,582 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-09 18:05:39,582 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-09 18:05:39,676 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 18:05:39,842 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-09 18:05:39,842 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v10
2025-12-09 18:05:39,842 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-09 18:05:39,842 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-09 18:05:39,935 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 18:05:40,102 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-09 18:05:40,102 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v10
2025-12-09 18:05:40,102 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-09 18:05:40,102 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-09 18:05:40,196 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-09 18:05:40,362 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-09 18:05:40,362 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v10
2025-12-09 18:05:40,362 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-09 18:05:40,362 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-09 18:05:40,362 - __main__ - INFO - Loaded 7 production models
2025-12-09 18:05:40,362 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:40,362 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-09 18:05:40,362 - __main__ - INFO - ======================================================================
2025-12-09 18:05:40,363 - src.models.predict - INFO - Preparing features for prediction
2025-12-09 18:05:40,363 - src.models.predict - INFO - Base date for predictions: 2025-12-09
2025-12-09 18:05:40,371 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-09 18:05:40,371 - src.models.predict - INFO - Prediction date range: 2025-12-10 to 2025-12-16
2025-12-09 18:05:40,371 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-09 18:05:40,371 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-09 18:05:40,371 - __main__ - INFO - Features prepared for next 7 days
2025-12-09 18:05:40,371 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-09 18:05:40,371 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:40,371 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-09 18:05:40,371 - __main__ - INFO - ======================================================================
2025-12-09 18:05:40,371 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-09 18:05:40,371 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-09 18:05:40,391 - src.models.predict - INFO - Generated 7 predictions
2025-12-09 18:05:40,391 - src.models.predict - INFO - Prediction range: 51.6 to 68.4 patients
2025-12-09 18:05:40,393 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-09 18:05:40,393 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-09 18:05:40,393 - __main__ - INFO -    Prediction range: 51.6 to 68.4 patients
2025-12-09 18:05:40,393 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:40,393 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-09 18:05:40,393 - __main__ - INFO - ======================================================================
2025-12-09 18:05:40,393 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-09 18:05:40,396 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251209_180540.csv
2025-12-09 18:05:40,396 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-09 18:05:40,396 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251209_180540.csv
2025-12-09 18:05:40,396 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-09 18:05:40,420 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-09 18:05:40,420 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-09 18:05:40,420 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:40,420 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-09 18:05:40,420 - __main__ - INFO - ======================================================================
2025-12-09 18:05:40,420 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-09 18:05:41,167 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 39f63ab5dd9b446192b40d9e74b641d6
2025-12-09 18:05:41,223 - __main__ - INFO - Logged to MLflow run: 39f63ab5dd9b446192b40d9e74b641d6
2025-12-09 18:05:41,224 - __main__ - INFO - 
======================================================================
2025-12-09 18:05:41,224 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-09 18:05:41,224 - __main__ - INFO - ======================================================================
2025-12-09 18:05:41,224 - __main__ - INFO - Average prediction: 62.4 patients
2025-12-09 18:05:41,224 - __main__ - INFO - Average interval width: 37.9140670961594
2025-12-09 18:05:41,224 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-09 18:05:41,225 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-10 16:18:35,196 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-10 16:18:35,196 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-10 16:18:35,196 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-10 16:18:35,197 - __main__ - INFO - ======================================================================
2025-12-10 16:18:35,197 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-10 16:18:35,197 - __main__ - INFO - ======================================================================
2025-12-10 16:18:35,197 - __main__ - INFO - Prediction base date: 2025-12-10
2025-12-10 16:18:35,197 - __main__ - INFO - Output path: data/predictions/
2025-12-10 16:18:35,197 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:35,197 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-10 16:18:35,197 - __main__ - INFO - ======================================================================
2025-12-10 16:18:35,197 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-10 16:18:35,198 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-10 16:18:36,948 - src.data.preprocessing - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:18:36,984 - __main__ - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:18:36,985 - src.data.preprocessing - INFO - Removing duplicates from 277,534 rows
2025-12-10 16:18:37,001 - src.data.preprocessing - WARNING - Found 200,196 duplicate rows (72.13%)
2025-12-10 16:18:37,004 - src.data.preprocessing - INFO - After removing duplicates: 77,338 rows remain
2025-12-10 16:18:37,006 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-10 16:18:37,070 - src.data.preprocessing - INFO - Aggregated to 1,287 days
2025-12-10 16:18:37,070 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-10 00:00:00
2025-12-10 16:18:37,070 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-10 16:18:37,070 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-10 16:18:37,070 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-10 16:18:37,072 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-10 16:18:37,074 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-10 16:18:37,077 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-10 16:18:37,078 - src.data.preprocessing - INFO - Final time series: 1,297 days from 2022-05-24 to 2025-12-10
2025-12-10 16:18:37,078 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-10 16:18:37,078 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-10 16:18:37,078 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-10 16:18:37,079 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-10 16:18:37,079 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-10 16:18:37,079 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-10 16:18:37,080 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-10 16:18:37,080 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-10 16:18:37,080 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-10 16:18:37,080 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-10 16:18:37,081 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-10 16:18:37,081 - __main__ - INFO - Loaded data: 1297 days up to 2025-12-10
2025-12-10 16:18:37,081 - __main__ - INFO - Data validation passed: 1297 rows, most recent date 2025-12-10 (0 days ago)
2025-12-10 16:18:37,081 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:37,081 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-10 16:18:37,081 - __main__ - INFO - ======================================================================
2025-12-10 16:18:37,081 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-10
2025-12-10 16:18:37,081 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:18:38,050 - src.data.weather_integration - INFO - Successfully fetched weather data: 1297 days
2025-12-10 16:18:38,051 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-10 16:18:38,053 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-10
2025-12-10 16:18:38,053 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-10
2025-12-10 16:18:38,055 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-10 16:18:38,055 - __main__ - INFO - Historical weather data: 1297 days
2025-12-10 16:18:38,055 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-10 16:18:38,055 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:18:38,255 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-10 16:18:38,256 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-10 16:18:38,256 - __main__ - INFO - Forecast date range: 2025-12-10 to 2025-12-17
2025-12-10 16:18:38,256 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:38,256 - __main__ - INFO - STEP 3: Engineering Features
2025-12-10 16:18:38,256 - __main__ - INFO - ======================================================================
2025-12-10 16:18:38,256 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-10 16:18:38,257 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-10 16:18:38,260 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-10 16:18:38,260 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-10 16:18:38,261 - src.data.feature_engineering - INFO - Weekend days: 370/1297 (28.5%)
2025-12-10 16:18:38,261 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-10 16:18:38,263 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-10 16:18:38,263 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-10 16:18:38,264 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-10 16:18:38,264 - src.data.feature_engineering - INFO - Adding change features
2025-12-10 16:18:38,265 - src.data.feature_engineering - INFO - Added change features
2025-12-10 16:18:38,265 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-10 16:18:38,265 - src.data.feature_engineering - INFO - Final shape: (1297, 35)
2025-12-10 16:18:38,265 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-10 16:18:38,265 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-10 16:18:38,266 - src.data.feature_engineering - INFO - Rows with NaN: 28/1297 (2.2%)
2025-12-10 16:18:38,266 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-10 16:18:38,266 - src.data.feature_engineering - INFO - Remaining rows: 1269
2025-12-10 16:18:38,266 - __main__ - INFO - Features engineered: (1269, 35)
2025-12-10 16:18:38,266 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:38,266 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-10 16:18:38,266 - __main__ - INFO - ======================================================================
2025-12-10 16:18:38,266 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-10 16:18:38,266 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-10 16:18:38,645 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:18:38,964 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-10 16:18:39,086 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-10 16:18:39,086 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v10
2025-12-10 16:18:39,086 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-10 16:18:39,086 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-10 16:18:39,139 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:18:39,305 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-10 16:18:39,305 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v10
2025-12-10 16:18:39,305 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-10 16:18:39,305 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-10 16:18:39,398 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:18:39,563 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-10 16:18:39,563 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v10
2025-12-10 16:18:39,563 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-10 16:18:39,563 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-10 16:18:39,656 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:18:39,819 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-10 16:18:39,819 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v10
2025-12-10 16:18:39,819 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-10 16:18:39,819 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-10 16:18:39,914 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:18:40,096 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-10 16:18:40,096 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v10
2025-12-10 16:18:40,096 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-10 16:18:40,096 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-10 16:18:40,150 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:18:40,316 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-10 16:18:40,317 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v10
2025-12-10 16:18:40,317 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-10 16:18:40,317 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-10 16:18:40,410 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:18:40,576 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-10 16:18:40,576 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v10
2025-12-10 16:18:40,576 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-10 16:18:40,576 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-10 16:18:40,576 - __main__ - INFO - Loaded 7 production models
2025-12-10 16:18:40,576 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:40,576 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-10 16:18:40,576 - __main__ - INFO - ======================================================================
2025-12-10 16:18:40,576 - src.models.predict - INFO - Preparing features for prediction
2025-12-10 16:18:40,576 - src.models.predict - INFO - Base date for predictions: 2025-12-10
2025-12-10 16:18:40,584 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-10 16:18:40,584 - src.models.predict - INFO - Prediction date range: 2025-12-11 to 2025-12-17
2025-12-10 16:18:40,584 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-10 16:18:40,584 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-10 16:18:40,584 - __main__ - INFO - Features prepared for next 7 days
2025-12-10 16:18:40,584 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-10 16:18:40,584 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:40,584 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-10 16:18:40,584 - __main__ - INFO - ======================================================================
2025-12-10 16:18:40,584 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-10 16:18:40,585 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-10 16:18:40,605 - src.models.predict - INFO - Generated 7 predictions
2025-12-10 16:18:40,605 - src.models.predict - INFO - Prediction range: 51.8 to 71.0 patients
2025-12-10 16:18:40,606 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-10 16:18:40,606 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-10 16:18:40,606 - __main__ - INFO -    Prediction range: 51.8 to 71.0 patients
2025-12-10 16:18:40,606 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:40,606 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-10 16:18:40,606 - __main__ - INFO - ======================================================================
2025-12-10 16:18:40,606 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-10 16:18:40,609 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251210_161840.csv
2025-12-10 16:18:40,609 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-10 16:18:40,609 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251210_161840.csv
2025-12-10 16:18:40,609 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:18:40,631 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:18:40,632 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:18:40,632 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:40,632 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-10 16:18:40,632 - __main__ - INFO - ======================================================================
2025-12-10 16:18:40,632 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-10 16:18:41,375 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: dfd0f41419a745af83bce42589ec9fb4
2025-12-10 16:18:41,432 - __main__ - INFO - Logged to MLflow run: dfd0f41419a745af83bce42589ec9fb4
2025-12-10 16:18:41,433 - __main__ - INFO - 
======================================================================
2025-12-10 16:18:41,433 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-10 16:18:41,433 - __main__ - INFO - ======================================================================
2025-12-10 16:18:41,433 - __main__ - INFO - Average prediction: 63.4 patients
2025-12-10 16:18:41,433 - __main__ - INFO - Average interval width: 37.65985452280102
2025-12-10 16:18:41,433 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-10 16:18:41,435 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-10 16:22:54,938 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-10 16:22:54,938 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-10 16:22:54,938 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-10 16:22:54,938 - __main__ - INFO - ======================================================================
2025-12-10 16:22:54,938 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-10 16:22:54,938 - __main__ - INFO - ======================================================================
2025-12-10 16:22:54,938 - __main__ - INFO - Prediction base date: 2025-12-10
2025-12-10 16:22:54,938 - __main__ - INFO - Output path: data/predictions/
2025-12-10 16:22:54,938 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:54,938 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-10 16:22:54,938 - __main__ - INFO - ======================================================================
2025-12-10 16:22:54,938 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-10 16:22:54,939 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-10 16:22:56,590 - src.data.preprocessing - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:22:56,628 - __main__ - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:22:56,628 - src.data.preprocessing - INFO - Removing duplicates from 277,534 rows
2025-12-10 16:22:56,644 - src.data.preprocessing - WARNING - Found 200,196 duplicate rows (72.13%)
2025-12-10 16:22:56,647 - src.data.preprocessing - INFO - After removing duplicates: 77,338 rows remain
2025-12-10 16:22:56,649 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-10 16:22:56,711 - src.data.preprocessing - INFO - Aggregated to 1,287 days
2025-12-10 16:22:56,711 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-10 00:00:00
2025-12-10 16:22:56,711 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-10 16:22:56,711 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-10 16:22:56,711 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-10 16:22:56,713 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-10 16:22:56,715 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-10 16:22:56,718 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-10 16:22:56,718 - src.data.preprocessing - INFO - Final time series: 1,297 days from 2022-05-24 to 2025-12-10
2025-12-10 16:22:56,718 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-10 16:22:56,719 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-10 16:22:56,719 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-10 16:22:56,719 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-10 16:22:56,719 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-10 16:22:56,719 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-10 16:22:56,720 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-10 16:22:56,721 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-10 16:22:56,721 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-10 16:22:56,721 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-10 16:22:56,721 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-10 16:22:56,721 - __main__ - INFO - Loaded data: 1297 days up to 2025-12-10
2025-12-10 16:22:56,721 - __main__ - INFO - Data validation passed: 1297 rows, most recent date 2025-12-10 (0 days ago)
2025-12-10 16:22:56,721 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:56,721 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-10 16:22:56,721 - __main__ - INFO - ======================================================================
2025-12-10 16:22:56,722 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-10
2025-12-10 16:22:56,722 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:22:56,914 - src.data.weather_integration - INFO - Successfully fetched weather data: 1297 days
2025-12-10 16:22:56,915 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-10 16:22:56,916 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-10
2025-12-10 16:22:56,916 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-10
2025-12-10 16:22:56,917 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-10 16:22:56,918 - __main__ - INFO - Historical weather data: 1297 days
2025-12-10 16:22:56,918 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-10 16:22:56,918 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:22:57,077 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-10 16:22:57,078 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-10 16:22:57,078 - __main__ - INFO - Forecast date range: 2025-12-10 to 2025-12-17
2025-12-10 16:22:57,078 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:57,078 - __main__ - INFO - STEP 3: Engineering Features
2025-12-10 16:22:57,078 - __main__ - INFO - ======================================================================
2025-12-10 16:22:57,078 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-10 16:22:57,078 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-10 16:22:57,082 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-10 16:22:57,082 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-10 16:22:57,083 - src.data.feature_engineering - INFO - Weekend days: 370/1297 (28.5%)
2025-12-10 16:22:57,083 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-10 16:22:57,084 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-10 16:22:57,084 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-10 16:22:57,086 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-10 16:22:57,086 - src.data.feature_engineering - INFO - Adding change features
2025-12-10 16:22:57,086 - src.data.feature_engineering - INFO - Added change features
2025-12-10 16:22:57,086 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-10 16:22:57,086 - src.data.feature_engineering - INFO - Final shape: (1297, 35)
2025-12-10 16:22:57,086 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-10 16:22:57,087 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-10 16:22:57,087 - src.data.feature_engineering - INFO - Rows with NaN: 28/1297 (2.2%)
2025-12-10 16:22:57,088 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-10 16:22:57,088 - src.data.feature_engineering - INFO - Remaining rows: 1269
2025-12-10 16:22:57,088 - __main__ - INFO - Features engineered: (1269, 35)
2025-12-10 16:22:57,088 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:57,088 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-10 16:22:57,088 - __main__ - INFO - ======================================================================
2025-12-10 16:22:57,088 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-10 16:22:57,088 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-10 16:22:57,153 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:22:57,466 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-10 16:22:57,587 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-10 16:22:57,587 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v10
2025-12-10 16:22:57,587 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-10 16:22:57,587 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-10 16:22:57,641 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:22:57,808 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-10 16:22:57,809 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v10
2025-12-10 16:22:57,809 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-10 16:22:57,809 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-10 16:22:57,904 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:22:58,070 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-10 16:22:58,070 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v10
2025-12-10 16:22:58,070 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-10 16:22:58,070 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-10 16:22:58,163 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:22:58,328 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-10 16:22:58,328 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v10
2025-12-10 16:22:58,328 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-10 16:22:58,328 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-10 16:22:58,421 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:22:58,586 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-10 16:22:58,587 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v10
2025-12-10 16:22:58,587 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-10 16:22:58,587 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-10 16:22:58,680 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:22:58,845 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-10 16:22:58,845 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v10
2025-12-10 16:22:58,845 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-10 16:22:58,845 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-10 16:22:58,938 - src.utils.mlflow_utils - INFO - Loading model version 10 from Production stage
2025-12-10 16:22:59,099 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-10 16:22:59,099 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v10
2025-12-10 16:22:59,099 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-10 16:22:59,099 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-10 16:22:59,099 - __main__ - INFO - Loaded 7 production models
2025-12-10 16:22:59,099 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:59,099 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-10 16:22:59,099 - __main__ - INFO - ======================================================================
2025-12-10 16:22:59,099 - src.models.predict - INFO - Preparing features for prediction
2025-12-10 16:22:59,099 - src.models.predict - INFO - Base date for predictions: 2025-12-10
2025-12-10 16:22:59,107 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-10 16:22:59,107 - src.models.predict - INFO - Prediction date range: 2025-12-11 to 2025-12-17
2025-12-10 16:22:59,107 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-10 16:22:59,107 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-10 16:22:59,107 - __main__ - INFO - Features prepared for next 7 days
2025-12-10 16:22:59,107 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-10 16:22:59,107 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:59,107 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-10 16:22:59,107 - __main__ - INFO - ======================================================================
2025-12-10 16:22:59,107 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-10 16:22:59,107 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-10 16:22:59,127 - src.models.predict - INFO - Generated 7 predictions
2025-12-10 16:22:59,127 - src.models.predict - INFO - Prediction range: 51.8 to 71.0 patients
2025-12-10 16:22:59,128 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-10 16:22:59,128 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-10 16:22:59,129 - __main__ - INFO -    Prediction range: 51.8 to 71.0 patients
2025-12-10 16:22:59,129 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:59,129 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-10 16:22:59,129 - __main__ - INFO - ======================================================================
2025-12-10 16:22:59,129 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-10 16:22:59,132 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251210_162259.csv
2025-12-10 16:22:59,132 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-10 16:22:59,132 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251210_162259.csv
2025-12-10 16:22:59,132 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:22:59,153 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:22:59,153 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:22:59,153 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:59,153 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-10 16:22:59,153 - __main__ - INFO - ======================================================================
2025-12-10 16:22:59,153 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-10 16:22:59,884 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: ddaa088b32a34e7392cacd5051892baa
2025-12-10 16:22:59,937 - __main__ - INFO - Logged to MLflow run: ddaa088b32a34e7392cacd5051892baa
2025-12-10 16:22:59,938 - __main__ - INFO - 
======================================================================
2025-12-10 16:22:59,938 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-10 16:22:59,938 - __main__ - INFO - ======================================================================
2025-12-10 16:22:59,938 - __main__ - INFO - Average prediction: 63.4 patients
2025-12-10 16:22:59,938 - __main__ - INFO - Average interval width: 37.65985452280102
2025-12-10 16:22:59,938 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-10 16:22:59,940 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-10 16:27:38,704 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-10 16:27:38,704 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-10 16:27:38,704 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-10 16:27:38,704 - __main__ - INFO - ======================================================================
2025-12-10 16:27:38,704 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-10 16:27:38,704 - __main__ - INFO - ======================================================================
2025-12-10 16:27:38,704 - __main__ - INFO - Prediction base date: 2025-12-10
2025-12-10 16:27:38,705 - __main__ - INFO - Output path: data/predictions/
2025-12-10 16:27:38,705 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:38,705 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-10 16:27:38,705 - __main__ - INFO - ======================================================================
2025-12-10 16:27:38,705 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-10 16:27:38,705 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-10 16:27:40,429 - src.data.preprocessing - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:27:40,464 - __main__ - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:27:40,464 - src.data.preprocessing - INFO - Removing duplicates from 277,534 rows
2025-12-10 16:27:40,485 - src.data.preprocessing - WARNING - Found 200,196 duplicate rows (72.13%)
2025-12-10 16:27:40,488 - src.data.preprocessing - INFO - After removing duplicates: 77,338 rows remain
2025-12-10 16:27:40,491 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-10 16:27:40,555 - src.data.preprocessing - INFO - Aggregated to 1,287 days
2025-12-10 16:27:40,555 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-10 00:00:00
2025-12-10 16:27:40,555 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-10 16:27:40,555 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-10 16:27:40,555 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-10 16:27:40,558 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-10 16:27:40,559 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-10 16:27:40,562 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-10 16:27:40,563 - src.data.preprocessing - INFO - Final time series: 1,297 days from 2022-05-24 to 2025-12-10
2025-12-10 16:27:40,563 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-10 16:27:40,564 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-10 16:27:40,564 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-10 16:27:40,564 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-10 16:27:40,564 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-10 16:27:40,564 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-10 16:27:40,565 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-10 16:27:40,565 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-10 16:27:40,565 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-10 16:27:40,565 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-10 16:27:40,566 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-10 16:27:40,566 - __main__ - INFO - Loaded data: 1297 days up to 2025-12-10
2025-12-10 16:27:40,566 - __main__ - INFO - Data validation passed: 1297 rows, most recent date 2025-12-10 (0 days ago)
2025-12-10 16:27:40,566 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:40,566 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-10 16:27:40,566 - __main__ - INFO - ======================================================================
2025-12-10 16:27:40,566 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-10
2025-12-10 16:27:40,566 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:27:40,767 - src.data.weather_integration - INFO - Successfully fetched weather data: 1297 days
2025-12-10 16:27:40,768 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-10 16:27:40,770 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-10
2025-12-10 16:27:40,770 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-10
2025-12-10 16:27:40,771 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-10 16:27:40,771 - __main__ - INFO - Historical weather data: 1297 days
2025-12-10 16:27:40,771 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-10 16:27:40,771 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:27:40,897 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-10 16:27:40,897 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-10 16:27:40,897 - __main__ - INFO - Forecast date range: 2025-12-10 to 2025-12-17
2025-12-10 16:27:40,897 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:40,898 - __main__ - INFO - STEP 3: Engineering Features
2025-12-10 16:27:40,898 - __main__ - INFO - ======================================================================
2025-12-10 16:27:40,898 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-10 16:27:40,898 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-10 16:27:40,901 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-10 16:27:40,901 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-10 16:27:40,902 - src.data.feature_engineering - INFO - Weekend days: 370/1297 (28.5%)
2025-12-10 16:27:40,902 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-10 16:27:40,903 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-10 16:27:40,904 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-10 16:27:40,905 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-10 16:27:40,905 - src.data.feature_engineering - INFO - Adding change features
2025-12-10 16:27:40,905 - src.data.feature_engineering - INFO - Added change features
2025-12-10 16:27:40,905 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-10 16:27:40,905 - src.data.feature_engineering - INFO - Final shape: (1297, 35)
2025-12-10 16:27:40,905 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-10 16:27:40,906 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-10 16:27:40,906 - src.data.feature_engineering - INFO - Rows with NaN: 28/1297 (2.2%)
2025-12-10 16:27:40,907 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-10 16:27:40,907 - src.data.feature_engineering - INFO - Remaining rows: 1269
2025-12-10 16:27:40,907 - __main__ - INFO - Features engineered: (1269, 35)
2025-12-10 16:27:40,907 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:40,907 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-10 16:27:40,907 - __main__ - INFO - ======================================================================
2025-12-10 16:27:40,907 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-10 16:27:40,907 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-10 16:27:41,296 - src.utils.mlflow_utils - INFO - Loading model version 11 from Production stage
2025-12-10 16:27:41,612 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-10 16:27:41,733 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-10 16:27:41,733 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v11
2025-12-10 16:27:41,733 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-10 16:27:41,733 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-10 16:27:41,785 - src.utils.mlflow_utils - INFO - Loading model version 11 from Production stage
2025-12-10 16:27:41,950 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-10 16:27:41,950 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v11
2025-12-10 16:27:41,950 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-10 16:27:41,950 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-10 16:27:42,043 - src.utils.mlflow_utils - INFO - Loading model version 11 from Production stage
2025-12-10 16:27:42,209 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-10 16:27:42,210 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v11
2025-12-10 16:27:42,210 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-10 16:27:42,210 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-10 16:27:42,303 - src.utils.mlflow_utils - INFO - Loading model version 11 from Production stage
2025-12-10 16:27:42,468 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-10 16:27:42,468 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v11
2025-12-10 16:27:42,468 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-10 16:27:42,468 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-10 16:27:42,560 - src.utils.mlflow_utils - INFO - Loading model version 11 from Production stage
2025-12-10 16:27:42,724 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-10 16:27:42,724 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v11
2025-12-10 16:27:42,724 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-10 16:27:42,724 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-10 16:27:42,817 - src.utils.mlflow_utils - INFO - Loading model version 11 from Production stage
2025-12-10 16:27:42,984 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-10 16:27:42,984 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v11
2025-12-10 16:27:42,984 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-10 16:27:42,984 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-10 16:27:43,077 - src.utils.mlflow_utils - INFO - Loading model version 11 from Production stage
2025-12-10 16:27:43,242 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-10 16:27:43,242 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v11
2025-12-10 16:27:43,242 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-10 16:27:43,242 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-10 16:27:43,242 - __main__ - INFO - Loaded 7 production models
2025-12-10 16:27:43,242 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:43,242 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-10 16:27:43,242 - __main__ - INFO - ======================================================================
2025-12-10 16:27:43,242 - src.models.predict - INFO - Preparing features for prediction
2025-12-10 16:27:43,242 - src.models.predict - INFO - Base date for predictions: 2025-12-10
2025-12-10 16:27:43,250 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-10 16:27:43,250 - src.models.predict - INFO - Prediction date range: 2025-12-11 to 2025-12-17
2025-12-10 16:27:43,250 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-10 16:27:43,250 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-10 16:27:43,250 - __main__ - INFO - Features prepared for next 7 days
2025-12-10 16:27:43,250 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-10 16:27:43,250 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:43,250 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-10 16:27:43,250 - __main__ - INFO - ======================================================================
2025-12-10 16:27:43,250 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-10 16:27:43,250 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-10 16:27:43,270 - src.models.predict - INFO - Generated 7 predictions
2025-12-10 16:27:43,271 - src.models.predict - INFO - Prediction range: 51.6 to 70.9 patients
2025-12-10 16:27:43,272 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-10 16:27:43,272 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-10 16:27:43,272 - __main__ - INFO -    Prediction range: 51.6 to 70.9 patients
2025-12-10 16:27:43,272 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:43,272 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-10 16:27:43,272 - __main__ - INFO - ======================================================================
2025-12-10 16:27:43,272 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-10 16:27:43,275 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251210_162743.csv
2025-12-10 16:27:43,275 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-10 16:27:43,275 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251210_162743.csv
2025-12-10 16:27:43,275 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:27:43,299 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:27:43,299 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:27:43,299 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:43,299 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-10 16:27:43,299 - __main__ - INFO - ======================================================================
2025-12-10 16:27:43,299 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-10 16:27:44,108 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 0be96d470e604507b44855caf145bcd8
2025-12-10 16:27:44,164 - __main__ - INFO - Logged to MLflow run: 0be96d470e604507b44855caf145bcd8
2025-12-10 16:27:44,165 - __main__ - INFO - 
======================================================================
2025-12-10 16:27:44,165 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-10 16:27:44,165 - __main__ - INFO - ======================================================================
2025-12-10 16:27:44,165 - __main__ - INFO - Average prediction: 63.1 patients
2025-12-10 16:27:44,165 - __main__ - INFO - Average interval width: 37.507799975995844
2025-12-10 16:27:44,165 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-10 16:27:44,167 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-10 16:31:45,235 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-10 16:31:45,236 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-10 16:31:45,236 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-10 16:31:45,236 - __main__ - INFO - ======================================================================
2025-12-10 16:31:45,236 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-10 16:31:45,236 - __main__ - INFO - ======================================================================
2025-12-10 16:31:45,236 - __main__ - INFO - Prediction base date: 2025-12-10
2025-12-10 16:31:45,236 - __main__ - INFO - Output path: data/predictions/
2025-12-10 16:31:45,236 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:45,236 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-10 16:31:45,236 - __main__ - INFO - ======================================================================
2025-12-10 16:31:45,236 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-10 16:31:45,237 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-10 16:31:46,936 - src.data.preprocessing - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:31:46,971 - __main__ - INFO - Successfully loaded 277,534 rows from database
2025-12-10 16:31:46,972 - src.data.preprocessing - INFO - Removing duplicates from 277,534 rows
2025-12-10 16:31:46,989 - src.data.preprocessing - WARNING - Found 200,196 duplicate rows (72.13%)
2025-12-10 16:31:46,992 - src.data.preprocessing - INFO - After removing duplicates: 77,338 rows remain
2025-12-10 16:31:46,994 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-10 16:31:47,056 - src.data.preprocessing - INFO - Aggregated to 1,287 days
2025-12-10 16:31:47,056 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-10 00:00:00
2025-12-10 16:31:47,057 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-10 16:31:47,057 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-10 16:31:47,057 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-10 16:31:47,058 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-10 16:31:47,060 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-10 16:31:47,063 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-10 16:31:47,064 - src.data.preprocessing - INFO - Final time series: 1,297 days from 2022-05-24 to 2025-12-10
2025-12-10 16:31:47,064 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-10 16:31:47,064 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-10 16:31:47,064 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-10 16:31:47,065 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-10 16:31:47,065 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-10 16:31:47,065 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-10 16:31:47,066 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-10 16:31:47,066 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-10 16:31:47,066 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-10 16:31:47,066 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-10 16:31:47,067 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-10 16:31:47,067 - __main__ - INFO - Loaded data: 1297 days up to 2025-12-10
2025-12-10 16:31:47,067 - __main__ - INFO - Data validation passed: 1297 rows, most recent date 2025-12-10 (0 days ago)
2025-12-10 16:31:47,067 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:47,067 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-10 16:31:47,067 - __main__ - INFO - ======================================================================
2025-12-10 16:31:47,067 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-10
2025-12-10 16:31:47,067 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:31:47,244 - src.data.weather_integration - INFO - Successfully fetched weather data: 1297 days
2025-12-10 16:31:47,245 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-10 16:31:47,247 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-10
2025-12-10 16:31:47,247 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-10
2025-12-10 16:31:47,248 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-10 16:31:47,248 - __main__ - INFO - Historical weather data: 1297 days
2025-12-10 16:31:47,248 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-10 16:31:47,248 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-10 16:31:47,373 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-10 16:31:47,374 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-10 16:31:47,374 - __main__ - INFO - Forecast date range: 2025-12-10 to 2025-12-17
2025-12-10 16:31:47,374 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:47,374 - __main__ - INFO - STEP 3: Engineering Features
2025-12-10 16:31:47,374 - __main__ - INFO - ======================================================================
2025-12-10 16:31:47,374 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-10 16:31:47,374 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-10 16:31:47,378 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-10 16:31:47,378 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-10 16:31:47,379 - src.data.feature_engineering - INFO - Weekend days: 370/1297 (28.5%)
2025-12-10 16:31:47,379 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-10 16:31:47,381 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-10 16:31:47,381 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-10 16:31:47,382 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-10 16:31:47,382 - src.data.feature_engineering - INFO - Adding change features
2025-12-10 16:31:47,382 - src.data.feature_engineering - INFO - Added change features
2025-12-10 16:31:47,382 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-10 16:31:47,382 - src.data.feature_engineering - INFO - Final shape: (1297, 35)
2025-12-10 16:31:47,382 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-10 16:31:47,383 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-10 16:31:47,383 - src.data.feature_engineering - INFO - Rows with NaN: 28/1297 (2.2%)
2025-12-10 16:31:47,384 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-10 16:31:47,384 - src.data.feature_engineering - INFO - Remaining rows: 1269
2025-12-10 16:31:47,384 - __main__ - INFO - Features engineered: (1269, 35)
2025-12-10 16:31:47,384 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:47,384 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-10 16:31:47,384 - __main__ - INFO - ======================================================================
2025-12-10 16:31:47,384 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-10 16:31:47,384 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-10 16:31:47,449 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-10 16:31:47,762 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-10 16:31:47,883 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-10 16:31:47,883 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v12
2025-12-10 16:31:47,883 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-10 16:31:47,883 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-10 16:31:47,937 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-10 16:31:48,104 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-10 16:31:48,104 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v12
2025-12-10 16:31:48,104 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-10 16:31:48,104 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-10 16:31:48,198 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-10 16:31:48,363 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-10 16:31:48,363 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v12
2025-12-10 16:31:48,363 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-10 16:31:48,363 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-10 16:31:48,456 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-10 16:31:48,620 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-10 16:31:48,621 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v12
2025-12-10 16:31:48,621 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-10 16:31:48,621 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-10 16:31:48,714 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-10 16:31:48,896 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-10 16:31:48,896 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v12
2025-12-10 16:31:48,896 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-10 16:31:48,896 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-10 16:31:48,950 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-10 16:31:49,117 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-10 16:31:49,117 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v12
2025-12-10 16:31:49,117 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-10 16:31:49,117 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-10 16:31:49,210 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-10 16:31:49,376 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-10 16:31:49,376 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v12
2025-12-10 16:31:49,376 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-10 16:31:49,376 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-10 16:31:49,376 - __main__ - INFO - Loaded 7 production models
2025-12-10 16:31:49,376 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:49,376 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-10 16:31:49,376 - __main__ - INFO - ======================================================================
2025-12-10 16:31:49,376 - src.models.predict - INFO - Preparing features for prediction
2025-12-10 16:31:49,376 - src.models.predict - INFO - Base date for predictions: 2025-12-10
2025-12-10 16:31:49,384 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-10 16:31:49,384 - src.models.predict - INFO - Prediction date range: 2025-12-11 to 2025-12-17
2025-12-10 16:31:49,384 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-10 16:31:49,385 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-10 16:31:49,385 - __main__ - INFO - Features prepared for next 7 days
2025-12-10 16:31:49,385 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-10 16:31:49,385 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:49,385 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-10 16:31:49,385 - __main__ - INFO - ======================================================================
2025-12-10 16:31:49,385 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-10 16:31:49,385 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-10 16:31:49,405 - src.models.predict - INFO - Generated 7 predictions
2025-12-10 16:31:49,405 - src.models.predict - INFO - Prediction range: 51.6 to 70.9 patients
2025-12-10 16:31:49,406 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-10 16:31:49,406 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-10 16:31:49,407 - __main__ - INFO -    Prediction range: 51.6 to 70.9 patients
2025-12-10 16:31:49,407 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:49,407 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-10 16:31:49,407 - __main__ - INFO - ======================================================================
2025-12-10 16:31:49,407 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-10 16:31:49,410 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251210_163149.csv
2025-12-10 16:31:49,410 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-10 16:31:49,410 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251210_163149.csv
2025-12-10 16:31:49,410 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:31:49,430 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:31:49,431 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-10 16:31:49,431 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:49,431 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-10 16:31:49,431 - __main__ - INFO - ======================================================================
2025-12-10 16:31:49,431 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-10 16:31:50,188 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: fe4a503830984d8cad91dc1b3c0c0b35
2025-12-10 16:31:50,241 - __main__ - INFO - Logged to MLflow run: fe4a503830984d8cad91dc1b3c0c0b35
2025-12-10 16:31:50,242 - __main__ - INFO - 
======================================================================
2025-12-10 16:31:50,242 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-10 16:31:50,242 - __main__ - INFO - ======================================================================
2025-12-10 16:31:50,242 - __main__ - INFO - Average prediction: 63.1 patients
2025-12-10 16:31:50,242 - __main__ - INFO - Average interval width: 37.507799975995844
2025-12-10 16:31:50,242 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-10 16:31:50,244 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-11 14:30:05,639 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-11 14:30:05,640 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-11 14:30:05,640 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-11 14:30:05,640 - __main__ - INFO - ======================================================================
2025-12-11 14:30:05,640 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-11 14:30:05,640 - __main__ - INFO - ======================================================================
2025-12-11 14:30:05,640 - __main__ - INFO - Prediction base date: 2025-12-11
2025-12-11 14:30:05,640 - __main__ - INFO - Output path: data/predictions/
2025-12-11 14:30:05,640 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:05,640 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-11 14:30:05,640 - __main__ - INFO - ======================================================================
2025-12-11 14:30:05,640 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-11 14:30:05,641 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-11 14:30:07,467 - src.data.preprocessing - INFO - Successfully loaded 277,688 rows from database
2025-12-11 14:30:07,505 - __main__ - INFO - Successfully loaded 277,688 rows from database
2025-12-11 14:30:07,506 - src.data.preprocessing - INFO - Removing duplicates from 277,688 rows
2025-12-11 14:30:07,527 - src.data.preprocessing - WARNING - Found 200,295 duplicate rows (72.13%)
2025-12-11 14:30:07,530 - src.data.preprocessing - INFO - After removing duplicates: 77,393 rows remain
2025-12-11 14:30:07,532 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-11 14:30:07,594 - src.data.preprocessing - INFO - Aggregated to 1,288 days
2025-12-11 14:30:07,595 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-11 00:00:00
2025-12-11 14:30:07,595 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-11 14:30:07,595 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-11 14:30:07,595 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-11 14:30:07,597 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-11 14:30:07,598 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-11 14:30:07,601 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-11 14:30:07,602 - src.data.preprocessing - INFO - Final time series: 1,298 days from 2022-05-24 to 2025-12-11
2025-12-11 14:30:07,602 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-11 14:30:07,602 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-11 14:30:07,602 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-11 14:30:07,603 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-11 14:30:07,603 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-11 14:30:07,603 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-11 14:30:07,603 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-11 14:30:07,604 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-11 14:30:07,604 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-11 14:30:07,604 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-11 14:30:07,605 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-11 14:30:07,605 - __main__ - INFO - Loaded data: 1298 days up to 2025-12-11
2025-12-11 14:30:07,605 - __main__ - INFO - Data validation passed: 1298 rows, most recent date 2025-12-11 (0 days ago)
2025-12-11 14:30:07,605 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:07,605 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-11 14:30:07,605 - __main__ - INFO - ======================================================================
2025-12-11 14:30:07,605 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-11
2025-12-11 14:30:07,605 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-11 14:30:07,994 - src.data.weather_integration - INFO - Successfully fetched weather data: 1298 days
2025-12-11 14:30:07,995 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-11 14:30:07,997 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-11
2025-12-11 14:30:07,997 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-11
2025-12-11 14:30:07,998 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-11 14:30:07,998 - __main__ - INFO - Historical weather data: 1298 days
2025-12-11 14:30:07,998 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-11 14:30:07,998 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-11 14:30:08,520 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-11 14:30:08,521 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-11 14:30:08,521 - __main__ - INFO - Forecast date range: 2025-12-11 to 2025-12-18
2025-12-11 14:30:08,521 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:08,521 - __main__ - INFO - STEP 3: Engineering Features
2025-12-11 14:30:08,521 - __main__ - INFO - ======================================================================
2025-12-11 14:30:08,521 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-11 14:30:08,521 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-11 14:30:08,524 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-11 14:30:08,524 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-11 14:30:08,525 - src.data.feature_engineering - INFO - Weekend days: 370/1298 (28.5%)
2025-12-11 14:30:08,525 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-11 14:30:08,527 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-11 14:30:08,527 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-11 14:30:08,528 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-11 14:30:08,528 - src.data.feature_engineering - INFO - Adding change features
2025-12-11 14:30:08,529 - src.data.feature_engineering - INFO - Added change features
2025-12-11 14:30:08,529 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-11 14:30:08,529 - src.data.feature_engineering - INFO - Final shape: (1298, 35)
2025-12-11 14:30:08,529 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-11 14:30:08,529 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-11 14:30:08,530 - src.data.feature_engineering - INFO - Rows with NaN: 28/1298 (2.2%)
2025-12-11 14:30:08,530 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-11 14:30:08,530 - src.data.feature_engineering - INFO - Remaining rows: 1270
2025-12-11 14:30:08,530 - __main__ - INFO - Features engineered: (1270, 35)
2025-12-11 14:30:08,530 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:08,530 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-11 14:30:08,530 - __main__ - INFO - ======================================================================
2025-12-11 14:30:08,530 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-11 14:30:08,530 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-11 14:30:08,595 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-11 14:30:08,909 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-11 14:30:09,030 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-11 14:30:09,030 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v12
2025-12-11 14:30:09,030 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-11 14:30:09,030 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-11 14:30:09,082 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-11 14:30:09,248 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-11 14:30:09,248 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v12
2025-12-11 14:30:09,248 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-11 14:30:09,248 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-11 14:30:09,342 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-11 14:30:09,507 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-11 14:30:09,507 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v12
2025-12-11 14:30:09,507 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-11 14:30:09,507 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-11 14:30:09,601 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-11 14:30:09,765 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-11 14:30:09,765 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v12
2025-12-11 14:30:09,765 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-11 14:30:09,765 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-11 14:30:09,860 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-11 14:30:10,026 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-11 14:30:10,026 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v12
2025-12-11 14:30:10,026 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-11 14:30:10,026 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-11 14:30:10,120 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-11 14:30:10,286 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-11 14:30:10,286 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v12
2025-12-11 14:30:10,286 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-11 14:30:10,286 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-11 14:30:10,379 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-11 14:30:10,545 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-11 14:30:10,545 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v12
2025-12-11 14:30:10,545 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-11 14:30:10,545 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-11 14:30:10,545 - __main__ - INFO - Loaded 7 production models
2025-12-11 14:30:10,545 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:10,545 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-11 14:30:10,545 - __main__ - INFO - ======================================================================
2025-12-11 14:30:10,545 - src.models.predict - INFO - Preparing features for prediction
2025-12-11 14:30:10,545 - src.models.predict - INFO - Base date for predictions: 2025-12-11
2025-12-11 14:30:10,554 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-11 14:30:10,554 - src.models.predict - INFO - Prediction date range: 2025-12-12 to 2025-12-18
2025-12-11 14:30:10,554 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-11 14:30:10,554 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-11 14:30:10,554 - __main__ - INFO - Features prepared for next 7 days
2025-12-11 14:30:10,554 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-11 14:30:10,554 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:10,554 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-11 14:30:10,554 - __main__ - INFO - ======================================================================
2025-12-11 14:30:10,554 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-11 14:30:10,554 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-11 14:30:10,574 - src.models.predict - INFO - Generated 7 predictions
2025-12-11 14:30:10,574 - src.models.predict - INFO - Prediction range: 53.0 to 70.1 patients
2025-12-11 14:30:10,576 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-11 14:30:10,576 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-11 14:30:10,576 - __main__ - INFO -    Prediction range: 53.0 to 70.1 patients
2025-12-11 14:30:10,576 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:10,576 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-11 14:30:10,576 - __main__ - INFO - ======================================================================
2025-12-11 14:30:10,576 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-11 14:30:10,579 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251211_143010.csv
2025-12-11 14:30:10,579 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-11 14:30:10,579 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251211_143010.csv
2025-12-11 14:30:10,579 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-11 14:30:10,601 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-11 14:30:10,602 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-11 14:30:10,602 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:10,602 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-11 14:30:10,602 - __main__ - INFO - ======================================================================
2025-12-11 14:30:10,602 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-11 14:30:11,287 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: a49d52430f254fba8933110d193c6a93
2025-12-11 14:30:11,342 - __main__ - INFO - Logged to MLflow run: a49d52430f254fba8933110d193c6a93
2025-12-11 14:30:11,343 - __main__ - INFO - 
======================================================================
2025-12-11 14:30:11,343 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-11 14:30:11,343 - __main__ - INFO - ======================================================================
2025-12-11 14:30:11,343 - __main__ - INFO - Average prediction: 63.4 patients
2025-12-11 14:30:11,343 - __main__ - INFO - Average interval width: 40.05558098655823
2025-12-11 14:30:11,343 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-11 14:30:11,344 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-12 02:00:05,636 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-12 02:00:05,636 - src.utils.mlflow_utils - INFO - AWS credentials configured for MinIO
2025-12-12 02:00:05,636 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-12 02:00:05,636 - __main__ - INFO - ======================================================================
2025-12-12 02:00:05,636 - __main__ - INFO - STARTING ER PATIENT FORECAST PREDICTION FLOW
2025-12-12 02:00:05,636 - __main__ - INFO - ======================================================================
2025-12-12 02:00:05,636 - __main__ - INFO - Prediction base date: 2025-12-12
2025-12-12 02:00:05,636 - __main__ - INFO - Output path: data/predictions/
2025-12-12 02:00:05,636 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:05,636 - __main__ - INFO - STEP 1: Loading Latest Patient Data
2025-12-12 02:00:05,636 - __main__ - INFO - ======================================================================
2025-12-12 02:00:05,636 - __main__ - INFO - Loading data from SQL Server database using stored procedure
2025-12-12 02:00:05,637 - src.data.preprocessing - INFO - Loading data from SQL Server using stored procedure: [getVPB_Data]
2025-12-12 02:00:07,514 - src.data.preprocessing - INFO - Successfully loaded 277,788 rows from database
2025-12-12 02:00:07,548 - __main__ - INFO - Successfully loaded 277,788 rows from database
2025-12-12 02:00:07,548 - src.data.preprocessing - INFO - Removing duplicates from 277,788 rows
2025-12-12 02:00:07,565 - src.data.preprocessing - WARNING - Found 200,364 duplicate rows (72.13%)
2025-12-12 02:00:07,568 - src.data.preprocessing - INFO - After removing duplicates: 77,424 rows remain
2025-12-12 02:00:07,570 - src.data.preprocessing - INFO - Aggregating patient visits to daily counts
2025-12-12 02:00:07,633 - src.data.preprocessing - INFO - Aggregated to 1,288 days
2025-12-12 02:00:07,633 - src.data.preprocessing - INFO - Date range: 2022-05-24 00:00:00 to 2025-12-11 00:00:00
2025-12-12 02:00:07,633 - src.data.preprocessing - INFO - Average patients per day: 60.1
2025-12-12 02:00:07,633 - src.data.preprocessing - INFO - Min patients per day: 3
2025-12-12 02:00:07,633 - src.data.preprocessing - INFO - Max patients per day: 104
2025-12-12 02:00:07,635 - src.data.preprocessing - INFO - Checking for missing dates in time series
2025-12-12 02:00:07,637 - src.data.preprocessing - WARNING - Found 10 missing dates (0.77%)
2025-12-12 02:00:07,640 - src.data.preprocessing - INFO - Filled 10 missing dates with weekday median patient counts
2025-12-12 02:00:07,640 - src.data.preprocessing - INFO - Final time series: 1,298 days from 2022-05-24 to 2025-12-11
2025-12-12 02:00:07,640 - src.data.preprocessing - INFO - Detecting outliers using iqr method
2025-12-12 02:00:07,641 - src.data.preprocessing - INFO - Outlier bounds: [18, 103] patients
2025-12-12 02:00:07,641 - src.data.preprocessing - INFO - Found 4 outliers (0.31%)
2025-12-12 02:00:07,641 - src.data.preprocessing - WARNING - Outlier summary:
2025-12-12 02:00:07,641 - src.data.preprocessing - WARNING -   Below 18: 3 days
2025-12-12 02:00:07,641 - src.data.preprocessing - WARNING -   Above 103: 1 days
2025-12-12 02:00:07,642 - src.data.preprocessing - WARNING -   High: 2024-12-16 = 104 patients
2025-12-12 02:00:07,643 - src.data.preprocessing - WARNING -   Low: 2025-11-08 = 3 patients
2025-12-12 02:00:07,643 - src.data.preprocessing - WARNING -   Low: 2025-11-09 = 4 patients
2025-12-12 02:00:07,643 - src.data.preprocessing - WARNING -   Low: 2025-12-06 = 9 patients
2025-12-12 02:00:07,643 - src.data.preprocessing - INFO - Capped 4 outliers to bounds [18, 103]
2025-12-12 02:00:07,643 - __main__ - INFO - Loaded data: 1298 days up to 2025-12-11
2025-12-12 02:00:07,643 - __main__ - INFO - Data validation passed: 1298 rows, most recent date 2025-12-11 (1 days ago)
2025-12-12 02:00:07,643 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:07,644 - __main__ - INFO - STEP 2: Fetching Weather Data (Historical + Forecast)
2025-12-12 02:00:07,644 - __main__ - INFO - ======================================================================
2025-12-12 02:00:07,644 - src.data.weather_integration - INFO - Fetching weather data from 2022-05-24 to 2025-12-12
2025-12-12 02:00:07,644 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-12 02:00:08,023 - src.data.weather_integration - INFO - Successfully fetched weather data: 1299 days
2025-12-12 02:00:08,024 - src.data.weather_integration - INFO - Merging weather data with patient visit data
2025-12-12 02:00:08,026 - src.data.weather_integration - INFO - Patient data range: 2022-05-24 to 2025-12-11
2025-12-12 02:00:08,026 - src.data.weather_integration - INFO - Weather data range: 2022-05-24 to 2025-12-12
2025-12-12 02:00:08,027 - src.data.weather_integration - INFO - No missing weather data - perfect merge!
2025-12-12 02:00:08,027 - __main__ - INFO - Historical weather data: 1299 days
2025-12-12 02:00:08,027 - src.data.weather_integration - INFO - Fetching weather forecast for next 8 days
2025-12-12 02:00:08,027 - src.data.weather_integration - INFO - Location: lat=59.6099, lon=16.5448
2025-12-12 02:00:09,768 - src.data.weather_integration - INFO - Successfully fetched weather forecast: 8 days
2025-12-12 02:00:09,769 - __main__ - INFO - Weather forecast fetched: 8 days
2025-12-12 02:00:09,769 - __main__ - INFO - Forecast date range: 2025-12-12 to 2025-12-19
2025-12-12 02:00:09,769 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:09,769 - __main__ - INFO - STEP 3: Engineering Features
2025-12-12 02:00:09,769 - __main__ - INFO - ======================================================================
2025-12-12 02:00:09,769 - src.data.feature_engineering - INFO - Starting comprehensive feature engineering pipeline
2025-12-12 02:00:09,769 - src.data.feature_engineering - INFO - Adding date and time features with cyclic encoding
2025-12-12 02:00:09,773 - src.data.feature_engineering - INFO - Added 12 date/time features
2025-12-12 02:00:09,773 - src.data.feature_engineering - INFO - Adding weekend indicator
2025-12-12 02:00:09,774 - src.data.feature_engineering - INFO - Weekend days: 370/1298 (28.5%)
2025-12-12 02:00:09,774 - src.data.feature_engineering - INFO - Adding rolling statistics for windows: [3, 14, 30]
2025-12-12 02:00:09,776 - src.data.feature_engineering - INFO - Added 6 rolling statistics features
2025-12-12 02:00:09,776 - src.data.feature_engineering - INFO - Adding lag features: [1, 2, 3, 7, 14, 21, 28]
2025-12-12 02:00:09,777 - src.data.feature_engineering - INFO - Added 7 lag features
2025-12-12 02:00:09,777 - src.data.feature_engineering - INFO - Adding change features
2025-12-12 02:00:09,777 - src.data.feature_engineering - INFO - Added change features
2025-12-12 02:00:09,777 - src.data.feature_engineering - INFO - Feature engineering complete: added 28 features
2025-12-12 02:00:09,777 - src.data.feature_engineering - INFO - Final shape: (1298, 35)
2025-12-12 02:00:09,777 - src.data.feature_engineering - INFO - Removing rows with NaN values from feature engineering
2025-12-12 02:00:09,778 - src.data.feature_engineering - INFO - Found NaN values in 15 columns: ['patients_3d_avg', 'patients_3d_std', 'patients_14d_avg', 'patients_14d_std', 'patients_30d_avg']...
2025-12-12 02:00:09,778 - src.data.feature_engineering - INFO - Rows with NaN: 28/1298 (2.2%)
2025-12-12 02:00:09,779 - src.data.feature_engineering - INFO - Removed 28 rows with NaN values
2025-12-12 02:00:09,779 - src.data.feature_engineering - INFO - Remaining rows: 1270
2025-12-12 02:00:09,779 - __main__ - INFO - Features engineered: (1270, 35)
2025-12-12 02:00:09,779 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:09,779 - __main__ - INFO - STEP 4: Loading Production Models from MLflow
2025-12-12 02:00:09,779 - __main__ - INFO - ======================================================================
2025-12-12 02:00:09,779 - src.models.predict - INFO - Loading production models from MLflow Model Registry
2025-12-12 02:00:09,779 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_1
2025-12-12 02:00:09,843 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-12 02:00:10,157 - botocore.credentials - INFO - Found credentials in environment variables.
2025-12-12 02:00:10,278 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=1 days
2025-12-12 02:00:10,278 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_1 v12
2025-12-12 02:00:10,278 - src.models.predict - INFO - Loaded model for horizon 1
2025-12-12 02:00:10,278 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_2
2025-12-12 02:00:10,329 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-12 02:00:10,495 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=2 days
2025-12-12 02:00:10,495 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_2 v12
2025-12-12 02:00:10,495 - src.models.predict - INFO - Loaded model for horizon 2
2025-12-12 02:00:10,496 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_3
2025-12-12 02:00:10,589 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-12 02:00:10,755 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=3 days
2025-12-12 02:00:10,755 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_3 v12
2025-12-12 02:00:10,755 - src.models.predict - INFO - Loaded model for horizon 3
2025-12-12 02:00:10,755 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_4
2025-12-12 02:00:10,849 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-12 02:00:11,009 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=4 days
2025-12-12 02:00:11,009 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_4 v12
2025-12-12 02:00:11,009 - src.models.predict - INFO - Loaded model for horizon 4
2025-12-12 02:00:11,009 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_5
2025-12-12 02:00:11,103 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-12 02:00:11,269 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=5 days
2025-12-12 02:00:11,269 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_5 v12
2025-12-12 02:00:11,269 - src.models.predict - INFO - Loaded model for horizon 5
2025-12-12 02:00:11,269 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_6
2025-12-12 02:00:11,362 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-12 02:00:11,527 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=6 days
2025-12-12 02:00:11,527 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_6 v12
2025-12-12 02:00:11,528 - src.models.predict - INFO - Loaded model for horizon 6
2025-12-12 02:00:11,528 - src.utils.mlflow_utils - INFO - Loading production model: er_forecast_horizon_7
2025-12-12 02:00:11,623 - src.utils.mlflow_utils - INFO - Loading model version 12 from Production stage
2025-12-12 02:00:11,791 - src.models.lightgbm_model - INFO - Initialized LightGBMForecaster for horizon=7 days
2025-12-12 02:00:11,791 - src.utils.mlflow_utils - INFO - Model loaded successfully: er_forecast_horizon_7 v12
2025-12-12 02:00:11,791 - src.models.predict - INFO - Loaded model for horizon 7
2025-12-12 02:00:11,791 - src.models.predict - INFO - Successfully loaded all 7 production models from MLflow
2025-12-12 02:00:11,791 - __main__ - INFO - Loaded 7 production models
2025-12-12 02:00:11,791 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:11,791 - __main__ - INFO - STEP 5: Preparing Prediction Features
2025-12-12 02:00:11,791 - __main__ - INFO - ======================================================================
2025-12-12 02:00:11,791 - src.models.predict - INFO - Preparing features for prediction
2025-12-12 02:00:11,792 - src.models.predict - INFO - Base date for predictions: 2025-12-12
2025-12-12 02:00:11,800 - src.models.predict - INFO - Prepared features for 7 prediction days
2025-12-12 02:00:11,800 - src.models.predict - INFO - Prediction date range: 2025-12-13 to 2025-12-19
2025-12-12 02:00:11,800 - src.models.predict - INFO - Weather forecasts applied to prediction features
2025-12-12 02:00:11,800 - src.models.predict - INFO - Total columns in prediction features: 35
2025-12-12 02:00:11,800 - __main__ - INFO - Features prepared for next 7 days
2025-12-12 02:00:11,800 - __main__ - INFO - Each horizon has weather forecast for its target date
2025-12-12 02:00:11,800 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:11,800 - __main__ - INFO - STEP 6: Generating Predictions with Confidence Intervals
2025-12-12 02:00:11,800 - __main__ - INFO - ======================================================================
2025-12-12 02:00:11,800 - src.models.predict - INFO - Generating batch predictions for next 7 days
2025-12-12 02:00:11,800 - src.models.predict - INFO - Feature columns selected: 33 features
2025-12-12 02:00:11,820 - src.models.predict - INFO - Generated 7 predictions
2025-12-12 02:00:11,820 - src.models.predict - INFO - Prediction range: 51.5 to 71.0 patients
2025-12-12 02:00:11,822 - src.monitoring.metrics_collector - INFO - Recorded prediction metrics: 7 predictions in 0.02s
2025-12-12 02:00:11,822 - __main__ - INFO - Generated 7 predictions in 0.02s
2025-12-12 02:00:11,822 - __main__ - INFO -    Prediction range: 51.5 to 71.0 patients
2025-12-12 02:00:11,822 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:11,822 - __main__ - INFO - STEP 7: Saving Predictions
2025-12-12 02:00:11,822 - __main__ - INFO - ======================================================================
2025-12-12 02:00:11,822 - src.models.prediction_output - INFO - Saving predictions to CSV
2025-12-12 02:00:11,825 - src.models.prediction_output - INFO - Predictions saved to: data/predictions/predictions_20251212_020011.csv
2025-12-12 02:00:11,825 - src.models.prediction_output - INFO - File size: 0.8 KB, Rows: 7
2025-12-12 02:00:11,825 - __main__ - INFO - Predictions saved to CSV: data/predictions/predictions_20251212_020011.csv
2025-12-12 02:00:11,825 - src.models.prediction_output - INFO - Writing predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-12 02:00:11,895 - src.models.prediction_output - INFO - Successfully wrote 7 predictions to [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-12 02:00:11,895 - __main__ - INFO - Wrote 7 predictions to database table: [LTV_STAGE].[dbo].[ER_PREDICTION]
2025-12-12 02:00:11,895 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:11,895 - __main__ - INFO - STEP 8: Logging Metadata to MLflow
2025-12-12 02:00:11,895 - __main__ - INFO - ======================================================================
2025-12-12 02:00:11,895 - src.models.prediction_output - INFO - Logging prediction metadata to MLflow
2025-12-12 02:00:12,588 - src.models.prediction_output - INFO - Prediction metadata logged to MLflow run: 25c3c925727a4df4a4cebc248a363e93
2025-12-12 02:00:12,642 - __main__ - INFO - Logged to MLflow run: 25c3c925727a4df4a4cebc248a363e93
2025-12-12 02:00:12,643 - __main__ - INFO - 
======================================================================
2025-12-12 02:00:12,643 - __main__ - INFO - PREDICTION FLOW COMPLETE! 
2025-12-12 02:00:12,643 - __main__ - INFO - ======================================================================
2025-12-12 02:00:12,643 - __main__ - INFO - Average prediction: 63.7 patients
2025-12-12 02:00:12,643 - __main__ - INFO - Average interval width: 39.53807512680163
2025-12-12 02:00:12,643 - src.monitoring.metrics_collector - INFO - Recorded flow run status: prediction_flow - success
2025-12-12 02:00:12,645 - __main__ - INFO - Prediction completed successfully: 7 predictions
2025-12-16 15:32:36,894 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-16 15:32:36,895 - src.utils.mlflow_utils - WARNING - AWS credentials not found in environment variables
2025-12-16 15:32:36,895 - src.utils.mlflow_utils - INFO - Set MLflow tracking URI: http://localhost:5011
2025-12-16 15:32:36,895 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-16 15:32:36,897 - src.data.preprocessing - INFO - Filtered out 1 row(s) from today (2025-12-16) to avoid incomplete data
2025-12-16 15:32:36,897 - flows.prediction_flow - INFO - Data validation passed: 65 rows, most recent date 2025-12-15 (1 days ago)
2025-12-16 15:32:45,284 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-16 15:32:45,284 - src.utils.mlflow_utils - WARNING - AWS credentials not found in environment variables
2025-12-16 15:32:45,284 - src.utils.mlflow_utils - INFO - Set MLflow tracking URI: http://localhost:5011
2025-12-16 15:32:45,284 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-16 15:32:45,309 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-16 15:32:45,309 - src.utils.mlflow_utils - WARNING - AWS credentials not found in environment variables
2025-12-16 15:32:45,309 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-16 15:34:47,719 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-16 15:34:47,719 - src.utils.mlflow_utils - WARNING - AWS credentials not found in environment variables
2025-12-16 15:34:47,719 - src.utils.mlflow_utils - INFO - Set MLflow tracking URI: http://localhost:5011
2025-12-16 15:34:47,719 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
2025-12-16 15:34:47,737 - src.utils.mlflow_utils - INFO - Configuring MLflow S3 backend for MinIO
2025-12-16 15:34:47,737 - src.utils.mlflow_utils - WARNING - AWS credentials not found in environment variables
2025-12-16 15:34:47,737 - src.utils.mlflow_utils - INFO - MLflow S3 backend configuration completed
